var VVVV_ENV="production";$.ajaxPrefilter(function(a,b,h){if("script"==a.dataType||"script"==b.dataType)a.cache=!0});window.console||(window.console={log:function(a){}});VVVV={Config:{}};VVVV.Config.auto_undo=!1;VVVV.Nodes={};VVVV.PinTypes={};VVVV.NodeLibrary={};VVVV.NodeNames=[];VVVV.onNotImplemented=function(a){console.log("Warning: "+a+" is not implemented.")};VVVV.loadCounter=0;
VVVV.loadScript=function(a,b){var h=document.getElementsByTagName("head")[0],g=document.createElement("script");g.async=!1;g.src=VVVV.Root+"/"+a;b&&g.addEventListener("load",b);VVVV.loadCounter++;h.appendChild(g)};
VVVV.init=function(a,b,h){function g(){var d=new VVVV.Core.Patch("");_(VVVV.Nodes).each(function(c){var k=new c(0,d);"development"==VVVV_ENV&&console.log("Registering "+k.nodename);VVVV.NodeLibrary[k.nodename.toLowerCase()]=c;VVVV.NodeNames.push(k.nodename)});"development"==VVVV_ENV&&console.log("done ...");VVVV.Patches=[];VVVV.MainLoops=[];$("script[language='VVVV']").each(function(){var c=new VVVV.Core.Patch($(this).attr("src"),function(){var c=new VVVV.Core.MainLoop(this);VVVV.MainLoops.push(c)});
VVVV.Patches.push(c)});"function"===typeof h&&h.call()}VVVV.Root=a||"./";"development"==VVVV_ENV&&console.log("loading vvvv.js ...");if("development"==VVVV_ENV){document.getElementsByTagName("head");var e=function(d){d.target.removeEventListener("load",e);0>=--VVVV.loadCounter&&g()};0==$("script[src*=thirdparty]").length&&VVVV.loadScript("thirdparty.js",e);0==$("script[src*=underscore]").length&&VVVV.loadScript("lib/underscore/underscore-min.js",e);0!=$('script[src*="d3.js"]').length||"full"!=b&&
"vvvviewer"!=b||VVVV.loadScript("lib/d3-v3/d3.v3.min.js",e);0!=$("script[src*=glMatrix]").length||"full"!=b&&"run"!=b||VVVV.loadScript("lib/glMatrix-0.9.5.min.js",e);if(0==$('script[src*="vvvv.core.js"]').length){VVVV.loadScript("core/vvvv.core.js",e);VVVV.loadScript("core/vvvv.core.vvvvconnector.js",e);if("run"==b||"full"==b)VVVV.loadScript("mainloop/vvvv.mainloop.js",e),VVVV.loadScript("mainloop/vvvv.dominterface.js",e),VVVV.loadScript("nodes/vvvv.nodes.value.js",e),VVVV.loadScript("nodes/vvvv.nodes.string.js",
e),VVVV.loadScript("nodes/vvvv.nodes.boolean.js",e),VVVV.loadScript("nodes/vvvv.nodes.color.js",e),VVVV.loadScript("nodes/vvvv.nodes.spreads.js",e),VVVV.loadScript("nodes/vvvv.nodes.spectral.js",e),VVVV.loadScript("nodes/vvvv.nodes.animation.js",e),VVVV.loadScript("nodes/vvvv.nodes.network.js",e),VVVV.loadScript("nodes/vvvv.nodes.system.js",e),VVVV.loadScript("nodes/vvvv.nodes.canvas.js",e),VVVV.loadScript("nodes/vvvv.nodes.html5.js",e),VVVV.loadScript("nodes/vvvv.nodes.transform.js",e),VVVV.loadScript("nodes/vvvv.nodes.vectors.js",
e),VVVV.loadScript("nodes/vvvv.nodes.webgl.js",e),VVVV.loadScript("nodes/vvvv.nodes.complex.js",e),VVVV.loadScript("nodes/vvvv.nodes.enumerations.js",e),VVVV.loadScript("nodes/vvvv.nodes.2d.js",e),VVVV.loadScript("nodes/vvvv.nodes.3d.js",e),VVVV.loadScript("nodes/vvvv.nodes.node.js",e),VVVV.loadScript("nodes/vvvv.nodes.astronomy.js",e),VVVV.loadScript("nodes/vvvv.nodes.xml.js",e);"vvvviewer"!=b&&"full"!=b||VVVV.loadScript("vvvviewer/vvvv.vvvviewer.js",e);VVVV.loadScript("editors/vvvv.editors.browser_editor.js",
e)}}"production"==VVVV_ENV&&g()};VVVV.Types={};VVVV.MousePositions={_all:{x:0,y:0,wheel:0,lb:0,mb:0,rb:0}};VVVV.Types.Color=function(a,b,h,g){this.rgba=[a,b,h,g];this.toString=function(){return"r="+100*a+"% g="+100*b+"% b="+100*h+"% a="+100*g+"%"}};var PinDirection={Input:0,Output:1,Configuration:2};VVVV.PinTypes.Generic={typeName:"Generic",defaultValue:function(){return"0"}};VVVV.PinTypes.Enum={typeName:"Enum",reset_on_disconnect:!1,defaultValue:function(){return""}};
VVVV.translateOperators=function(a){a=a.replace("Add","+");a=a.replace("Subtract","-");a=a.replace("Multiply","*");a=a.replace("Divide","/");return a=a.replace("EQ","=")};
VVVV.Core={Pin:function(a,b,h,g,e,d){this.direction=b;this.pinname=a;this.links=[];this.values=[];this.node=g;this.changed=!0;this.active=!1;this.reset_on_disconnect=e||!1;this.masterPin=this.slavePin=void 0;this.connectionChangedHandlers={};this.enumOptions=[];this.getValue=function(c,d){if(!d||1==d)return this.values[c%this.values.length];for(var e=[],g=0;g<d;g++)e.push(this.values[(c*d+g)%this.values.length]);return e};this.setValue=function(c,d){this.values[c]=d;this.changed=!0;this.node.dirty=
!0;if(this.direction==PinDirection.Output)for(var e=this.links.length,g=0;g<e;g++)this.links[g].toPin.setValue(c,d);this.slavePin&&this.slavePin.setValue(c,d);this.node.isIOBox&&"Descriptive Name"==this.pinname&&(this.node.parentPatch.domInterface?this.node.parentPatch.domInterface.connect(this.node):this.node.parentPatch.parentPatch&&this.node.registerInterfacePin())};this.markPinAsChanged=function(){this.changed=!0;this.node.dirty=!0;if(this.direction==PinDirection.Output)for(var c=this.links.length,
d=0;d<c;d++)this.links[d].toPin.markPinAsChanged();this.slavePin&&this.slavePin.markPinAsChanged()};this.pinIsChanged=function(){var c=this.changed;this.changed=!1;return c};this.isConnected=function(){return 0<this.links.length||this.masterPin&&this.masterPin.isConnected()};this.getSliceCount=function(){return this.values.length};this.setSliceCount=function(c){if(this.values.length!=c){this.values.length=c;this.changed=!0;this.node.dirty=!0;if(this.direction==PinDirection.Output)for(var d=this.links.length,
e=0;e<d;e++)this.links[e].toPin.setSliceCount(c);this.slavePin&&this.slavePin.setSliceCount(c)}};this.setType=function(c){if(c.typeName!=this.typeName){var d=this;delete this.connectionChangedHandlers.nodepin;delete this.connectionChangedHandlers.webglresource;_(c.connectionChangedHandlers).each(function(e,g){d.connectionChangedHandlers[g]=c.connectionChangedHandlers[g]});this.typeName=c.typeName;this.defaultValue=c.defaultValue;this.direction==PinDirection.Input&&this.defaultValue&&(this.setValue(0,
this.defaultValue()),this.setSliceCount(1));void 0!=c.reset_on_disconnect&&(this.reset_on_disconnect=c.reset_on_disconnect)}};void 0==d&&(d=VVVV.PinTypes.Generic);this.setType(d);h&&0<h.length&&(this.values=h.slice(0));this.reset=function(){console.log("resetting "+this.pinname);this.defaultValue?(this.setValue(0,this.defaultValue()),this.setSliceCount(1)):this.values=h.slice(0);this.markPinAsChanged()};this.connectionChanged=function(){var c=this;_(this.connectionChangedHandlers).each(function(d){c.f=
d;c.f()})}},Node:function(a,b,h){this.nodename=b;this.id=a;this.height=this.width=this.y=this.x=0;this.isShader=this.isIOBox=!1;this.resourcesPending=0;this.auto_nil=!0;this.setupObject=function(){this.inputPins={};this.outputPins={};this.invisiblePins={};this.defaultPinValues={}};this.setupObject();this.delays_output=this.auto_evaluate=!1;this.dirty=!0;(this.parentPatch=h)&&(this.parentPatch.nodeMap[a]=this);this.addDefault=function(g,e){this.defaultPinValues[g]=e};this.addInputPin=function(g,e,
d,c,k){e=new VVVV.Core.Pin(g,PinDirection.Input,e,this,c,k);this.inputPins[g]=e;this.parentPatch&&(this.parentPatch.pinMap[this.id+"_in_"+g]=e);this.applyPinValuesFromXML(g);return e};this.addOutputPin=function(g,e,d,c){e=new VVVV.Core.Pin(g,PinDirection.Output,e,this,!1,c);this.outputPins[g]=e;this.parentPatch&&(this.parentPatch.pinMap[this.id+"_out_"+g]=e);return e};this.removeInputPin=function(g){if(this.inputPins[g]){var e=this.inputPins[g].links[0];e&&(e.fromPin.connectionChanged(),e.destroy());
delete this.inputPins[g];this.dirty=!0}};this.removeOutputPin=function(g){if(this.outputPins[g]){for(var e=this.outputPins[g].links.length,d=0;d<e;d++){var c=this.outputPins[g].links[d];c.toPin.connectionChanged();c.destroy()}delete this.outputPins[g];this.dirty=!0}};this.addInvisiblePin=function(g,e,d,c){e=new VVVV.Core.Pin(g,PinDirection.Configuration,e,this,!1,c);this.invisiblePins[g]=e;this.parentPatch.pinMap[this.id+"_inv_"+g]=e;void 0!=this.defaultPinValues[g]&&(e.values=this.defaultPinValues[g]);
return e};this.IOBoxType=function(){var g=/^IOBox \((.*)\)/.exec(this.nodename);return g&&1<g.length?g[1]:""};this.IOBoxInputPin=function(){switch(this.IOBoxType()){case "Value Advanced":return this.inputPins["Y Input Value"];case "String":return this.inputPins["Input String"];case "Color":return this.inputPins["Color Input"];case "Node":return this.inputPins["Input Node"]}};this.IOBoxOutputPin=function(){switch(this.IOBoxType()){case "Value Advanced":return this.outputPins["Y Output Value"];case "String":return this.outputPins["Output String"];
case "Color":return this.outputPins["Color Output"];case "Node":return this.outputPins["Output Node"]}};this.IOBoxRows=function(){return this.invisiblePins.Rows?this.invisiblePins.Rows.getValue(0):1};this.isComment=function(){return this.isIOBox&&0==_(this.outputPins).size()};this.label=function(){if(this.isIOBox)return this.IOBoxInputPin().getValue(0)?this.IOBoxInputPin().getValue(0).toString():"";if(this.isSubpatch)return"||"+this.nodename.match(/(.+)\.v4p$/)[1];var g=this.nodename.replace(/\s\(.+\)/,
"");return g=VVVV.translateOperators(g)};this.getWidth=function(){var g;g=100==this.width||0==this.width?this.isIOBox?60:Math.max(18,6*(this.label().length+2)):this.width/15;return g=Math.max(g,12*(_(this.inputPins).size()-1)+4)};this.getHeight=function(){return this.isIOBox&&100==this.height?18*this.IOBoxRows():100==this.height||this.isSubpatch?18:Math.max(18,this.height/15)};this.getUpstreamNodes=function(){var g=[];_(this.inputPins).each(function(e){0<e.links.length&&g.push(e.links[0].fromPin.node)});
return g};this.getDownstreamNodes=function(){var g=[];_(this.outputPins).each(function(e){for(var d=0;d<e.links.length;d++)g.push(e.links[d].toPin.node)});return g};this.findDownstreamNodes=function(g){var e=[];_(this.outputPins).each(function(d){for(var c=0;c<d.links.length;c++)d.links[c].toPin.node.nodename==g?e.push(d.links[c].toPin.node):e=d.links[c].toPin.slavePin?e.concat(d.links[c].toPin.slavePin.node.findDownstreamNodes(g)):d.links[c].toPin.node.isIOBox&&d.links[c].toPin.node.IOBoxOutputPin().slavePin?
e.concat(d.links[c].toPin.node.IOBoxOutputPin().slavePin.node.findDownstreamNodes(g)):e.concat(d.links[c].toPin.node.findDownstreamNodes(g))});return e};this.hasNilInputs=function(){var g=!1;_(this.inputPins).each(function(e){0==e.getSliceCount()&&(g=!0)});return g};this.getMaxInputSliceCount=function(){var g=0;_(this.inputPins).each(function(e){e.getSliceCount()>g&&(g=e.values.length)});return g};this.applyPinValuesFromXML=function(g){if(this.inputPins[g]){var e=this.inputPins[g];g=this.defaultPinValues[g];
if(void 0!=g&&(!e.reset_on_disconnect||1<g.length||""!=g[0])){for(var d=0;d<g.length;d++)e.values[d]!=g[d]&&e.setValue(d,g[d]);e.setSliceCount(g.length)}}};this.registerInterfacePin=function(){var g=this;if(this.isIOBox&&this.parentPatch.parentPatch&&""!=this.invisiblePins["Descriptive Name"].getValue(0)){var e=this.invisiblePins["Descriptive Name"].getValue(0);this.IOBoxInputPin().connectionChangedHandlers.subpatchpins=function(){if(0<this.links.length&&this.masterPin){"development"==VVVV_ENV&&console.log("deleting "+
e+" input pin because node has input connection...");for(var d=0;d<this.masterPin.links.length;d++)this.masterPin.links[d].destroy();g.parentPatch.removeInputPin(e);this.masterPin=void 0}g.IOBoxOutputPin().slavePin?g.IOBoxOutputPin().slavePin.pinname!=e&&("development"==VVVV_ENV&&console.log("renaming "+g.IOBoxOutputPin().slavePin.pinname+" to "+e),g.parentPatch.outputPins[e]=g.parentPatch.outputPins[g.IOBoxOutputPin().slavePin.pinname],g.parentPatch.removeOutputPin(g.IOBoxOutputPin().slavePin.pinname),
g.IOBoxOutputPin().slavePin.pinname=e):("development"==VVVV_ENV&&console.log("interfacing output pin detected: "+e),d=g.parentPatch.outputPins[e],void 0==d&&(d=g.parentPatch.addOutputPin(e,g.IOBoxOutputPin().values)),g.IOBoxOutputPin().slavePin=d,d.masterPin=g.IOBoxOutputPin())};this.IOBoxInputPin().connectionChanged();this.IOBoxOutputPin().connectionChangedHandlers.subpatchpins=function(){if(0<this.links.length&&this.slavePin){"development"==VVVV_ENV&&console.log("deleting "+e+" output pin because node "+
g.id+" has output connection...");for(var d=0;d<this.slavePin.links.length;d++)this.slavePin.links[d].destroy();g.parentPatch.removeOutputPin(e);this.slavePin=void 0}if(g.IOBoxInputPin().masterPin)g.IOBoxInputPin().masterPin.pinname!=e&&(console.log("renaming "+g.IOBoxInputPin().masterPin.pinname+" to "+e),g.parentPatch.inputPins[e]=g.parentPatch.inputPins[g.IOBoxInputPin().masterPin.pinname],g.parentPatch.removeInputPin(g.IOBoxInputPin().masterPin.pinname),g.IOBoxInputPin().masterPin.pinname=e);
else{"development"==VVVV_ENV&&console.log("interfacing input pin detected: "+e);var c=g.parentPatch.inputPins[e];if(void 0==c)"development"==VVVV_ENV&&console.log("creating new input pin at parent patch, using IOBox values"),c=g.parentPatch.addInputPin(e,g.IOBoxInputPin().values,null,!1);else{slicecount=c.getSliceCount();for(d=0;d<slicecount;d++)g.IOBoxInputPin().setValue(d,c.getValue(d));0<slicecount&&g.IOBoxInputPin().setSliceCount(c.getSliceCount())}c.slavePin=g.IOBoxInputPin();g.IOBoxInputPin().masterPin=
c}};this.IOBoxOutputPin().connectionChanged()}};this.setup=function(){this.addInvisiblePin("Descriptive Name",[""])};this.initialize=function(){};this.evaluate=function(){_(this.outputPins).each(function(g){g.setValue(0,"not calculated")})};this.serialize=function(){var g=$("<NODE>");g.attr("id",this.id);g.attr("nodename",this.nodename);g.attr("systemname",this.nodename);this.shaderFile&&g.attr("filename",this.shaderFile.replace(".vvvvjs.fx",".fx").replace("%VVVV%/effects","%VVVV%/lib/nodes/effects"));
this.isSubpatch&&(g.attr("filename",this.nodename),g.attr("systemname",this.nodename.match("(.*).v4p$")[1]));this.isIOBox?g.attr("componentmode","InABox"):g.attr("componentmode","Hidden");var e=$("<BOUNDS>");this.isIOBox?e.attr("type","Box"):e.attr("type","Node");e.attr("left",parseInt(15*this.x));e.attr("top",parseInt(15*this.y));e.attr("width",parseInt(this.width));e.attr("height",parseInt(this.height));g.append(e);_(this.inputPins).each(function(d){var c=$("<PIN>");c.attr("pinname",d.pinname);
c.attr("visible","1");!d.isConnected()&&0<=["Color","Generic","Enum"].indexOf(d.typeName)&&c.attr("values",_(d.values).map(function(c){return"|"+c+"|"}).join(","));g.append(c)});_(this.invisiblePins).each(function(d){var c=$("<PIN>");c.attr("pinname",d.pinname);c.attr("visible","0");0<=["Color","Generic","Enum"].indexOf(d.typeName)&&c.attr("values",_(d.values).map(function(c){return"|"+c+"|"}).join(","));g.append(c)});return g}},Link:function(a,b){this.fromPin=a;this.toPin=b;this.fromPin.links.push(this);
this.toPin.links.push(this);this.destroy=function(){this.fromPin.links.splice(this.fromPin.links.indexOf(this),1);this.toPin.links.splice(this.toPin.links.indexOf(this),1);this.fromPin.node.parentPatch.linkList.splice(this.fromPin.node.parentPatch.linkList.indexOf(this),1)};this.serialize=function(){$link=$("<LONK>");$link.attr("srcnodeid",this.fromPin.node.id);$link.attr("srcpinname",this.fromPin.pinname);$link.attr("dstnodeid",this.toPin.node.id);$link.attr("dstpinname",this.toPin.pinname);return $link}},
Patch:function(a,b,h){function g(c){if(void 0==c)return[];if("45_26">=this.vvvv_version)return separator=/\|/.test(c)?"|":",",c.split(separator).filter(function(c,d){return""!=c});for(var d=[],e="",k=!1,g=c.length,h=0;h<g;h++)","!=c[h]||k?"|"==c[h]?k=!k:e+=c[h]:(d.push(e),e="");d.push(e);return d}function e(){VVVV.Editors.Connector.isConnected()||window.location.hash!="#sync/"+l.ressource&&window.location.hash!="#syncandview/"+l.ressource||(console.log("enabling devel env"),VVVV.Editors.Connector.disable(),
VVVV.Editors.Connector.host="ws://localhost",VVVV.Editors.Connector.enable(l));l.vvvviewer||window.location.hash!="#view/"+l.ressource&&window.location.hash!="#syncandview/"+l.ressource||(l.vvvviewer=new VVVV.VVVViewer(l));window.location.hash=="#edit/"+l.ressource&&(console.log("launching editor ..."),VVVV.Editors.edit.enable(l))}this.ressource=a;this.vvvv_version="45_26.1";this.boundingBox={width:0,height:0};this.height=this.width=500;this.pinMap={};this.nodeMap={};this.nodeList=[];this.linkList=
[];this.success=b;this.error=h;this.XMLCode="";this.editor=void 0;var d=!1;if("45_26">=this.vvvv_version)var c={},k={},p={},m={};var l=this;this.doLoad=function(d,e){function h(d){"complete"==b&&(k={});$(d).find('link[deleteme="pronto"]').each(function(){for(var c=!1,d=0;d<l.linkList.length;d++)l.linkList[d].fromPin.node.id==$(this).attr("srcnodeid")&&(l.linkList[d].fromPin.pinname==$(this).attr("srcpinname")&&l.linkList[d].toPin.node.id==$(this).attr("dstnodeid")&&l.linkList[d].toPin.pinname==$(this).attr("dstpinname"))&&
(c=l.linkList[d]);if(c){"development"==VVVV_ENV&&console.log("removing "+c.fromPin.pinname+" -> "+c.toPin.pinname);var d=c.fromPin,e=c.toPin;c.destroy();d.connectionChanged();e.connectionChanged();e.markPinAsChanged();e.reset_on_disconnect&&e.reset()}});$(d).find('link[deleteme!="pronto"]').each(function(){var c=l.pinMap[$(this).attr("srcnodeid")+"_out_"+$(this).attr("srcpinname")],d=l.pinMap[$(this).attr("dstnodeid")+"_in_"+$(this).attr("dstpinname")];void 0==c&&l.nodeMap[$(this).attr("srcnodeid")]&&
(c=l.nodeMap[$(this).attr("srcnodeid")].addOutputPin($(this).attr("srcpinname"),void 0));void 0==d&&l.nodeMap[$(this).attr("dstnodeid")]&&(d=l.nodeMap[$(this).attr("dstnodeid")].addInputPin($(this).attr("dstpinname"),void 0));if(c&&d){for(var e=!1,g=0;g<l.linkList.length;g++)l.linkList[g].fromPin.node.id==c.node.id&&(l.linkList[g].fromPin.pinname==c.pinname&&l.linkList[g].toPin.node.id==d.node.id&&l.linkList[g].toPin.pinname==d.pinname)&&(e=l.linkList[g]);if(!e){e=new VVVV.Core.Link(c,d);c.connectionChanged();
d.connectionChanged();l.linkList.push(e);for(g=0;g<c.values.length;g++)d.setValue(g,c.getValue(g));d.setSliceCount(c.getSliceCount())}"complete"==b&&(k[c.node.id+"_"+c.pinname+"-"+d.node.id+"_"+d.pinname]=e)}});"complete"==b&&(_(c).each(function(c,d){if(void 0==k[d]){"development"==VVVV_ENV&&console.log("removing "+c.fromPin.pinname+" -> "+c.toPin.pinname);var e=c.fromPin,g=c.toPin;c.destroy();e.connectionChanged();g.connectionChanged();g.markPinAsChanged();g.reset_on_disconnect&&g.reset()}}),c={},
_(k).each(function(d,e){c[e]=d}))}var a=this;do a.dirty=!0;while(a=a.parentPatch);if(a=/^<!DOCTYPE\s+PATCH\s+SYSTEM\s+"(.+)\\(.+)\.dtd/.exec(d))l.vvvv_version=a[2].replace(/[a-zA-Z]+/,"_");var b="diff";if(/\s<PATCH/.test(d)||"45_26">=l.vvvv_version)b="complete","development"==VVVV_ENV&&console.log("complete: "+this.nodename),l.XMLCode=d;$windowBounds=$(d).find('bounds[type="Window"]').first();0<$windowBounds.length&&(l.width=$windowBounds.attr("width")/15,l.height=$windowBounds.attr("height")/15);
"complete"==b&&(m={});var s=0;$(d).find("node").each(function(){if("pronto"==$(this).attr("createme")&&void 0!=l.nodeMap[$(this).attr("id")]){var c=l.nodeMap[$(this).attr("id")];"development"==VVVV_ENV&&console.log("node renamed, so deleting node "+c.id+" / "+c.nodename);_(c.inputPins).each(function(c){_(c.links).each(function(c){c.destroy();c.fromPin.connectionChanged()})});_(c.outputPins).each(function(c){_(c.links).each(function(c){c.destroy();c.toPin.connectionChanged();c.toPin.markPinAsChanged();
c.toPin.reset_on_disconnect&&c.toPin.reset()})});l.nodeList.splice(l.nodeList.indexOf(c),1);delete l.nodeMap[c.id]}$bounds="InABox"==$(this).attr("componentmode")?$(this).find('bounds[type="Box"]').first():$(this).find('bounds[type="Node"]').first();var k=void 0!=l.nodeMap[$(this).attr("id")];if(k)c=l.nodeMap[$(this).attr("id")];else{nodename=""!=$(this).attr("systemname")?$(this).attr("systemname"):$(this).attr("nodename");if(void 0==nodename)return;if(void 0!=VVVV.NodeLibrary[nodename.toLowerCase()])c=
new (VVVV.NodeLibrary[nodename.toLowerCase()])($(this).attr("id"),l),VVVV.NodeLibrary[nodename.toLowerCase()].requirements&&(l.resourcesPending++,_(VVVV.NodeLibrary[nodename.toLowerCase()].requirements).each(function(c){void 0===VVVV.LoadedLibs[c]&&VVVV.loadScript(VVVV.ThirdPartyLibs[c],function(){l.resourcesPending--})}));else if(/.fx$/.test($(this).attr("filename")))c=new VVVV.Nodes.GenericShader($(this).attr("id"),l),c.isShader=!0,c.shaderFile=$(this).attr("filename").replace(/\\/g,"/").replace(/\.fx$/,
".vvvvjs.fx").replace("lib/nodes/",""),c.nodename=nodename;else if(/.v4p$/.test($(this).attr("filename"))){l.resourcesPending++;s++;var p=this,c=new VVVV.Core.Patch($(this).attr("filename"),function(){c.id=$(p).attr("id");c.parentPatch=l;l.resourcesPending--;s--;"development"==VVVV_ENV&&console.log(c.nodename+"invoking update links");h(d);l.editor&&l.editor.addPatch(c);if(c.auto_evaluate){var k=l;do k.auto_evaluate=!0;while(k=k.parentPatch)}l.afterUpdate();0>=l.resourcesPending&&e&&e()},function(){c.not_implemented=
!0;VVVV.onNotImplemented(nodename)});c.setupObject();c.isSubpatch=!0;c.parentPatch=l;c.id=$(this).attr("id");l.nodeMap[c.id]=c}else c=new VVVV.Core.Node($(this).attr("id"),nodename,l),c.not_implemented=!0,"diff"==b&&!0==VVVV.Config.auto_undo&&l.editor.sendUndo(),VVVV.onNotImplemented(nodename);"development"==VVVV_ENV&&"complete"!=b&&console.log(l.nodename+": inserted new node "+c.nodename)}if(c.auto_evaluate){var a=l;do a.auto_evaluate=!0;while(a=a.parentPatch)}"pronto"==$(this).attr("deleteme")&&
("development"==VVVV_ENV&&console.log("removing node "+c.id),l.nodeList.splice(l.nodeList.indexOf(c),1),delete l.nodeMap[c.id]);0<$bounds.length&&($bounds.attr("left")&&(c.x=$bounds.attr("left")/15,c.y=$bounds.attr("top")/15,l.boundingBox.width=Math.max(l.boundingBox.width,c.x+100),l.boundingBox.height=Math.max(l.boundingBox.height,c.y+100)),$bounds.attr("width")&&(c.width=$bounds.attr("width"),c.height=$bounds.attr("height")));/^iobox/.test(c.nodename.toLowerCase())&&(c.isIOBox=!0);k||c.setup();
p=this;$(this).find("pin").each(function(){var e=$(this).attr("pinname"),k=g($(this).attr("values"));void 0!=k&&0<k.length&&c.addDefault(e,k);if(void 0==c.outputPins[e])if(void 0!=c.inputPins[e])c.inputPins[e].isConnected()||c.applyPinValuesFromXML(e);else if(void 0!=c.invisiblePins[e]){if(void 0!=k){for(var h=0;h<k.length;h++)c.invisiblePins[e].values[h]!=k[h]&&c.invisiblePins[e].setValue(h,k[h]);c.invisiblePins[e].setSliceCount(k.length)}}else 1==$(this).attr("visible")&&"Configuration"!=$(this).attr("pintype")||
c.isSubpatch?"Output"==$(this).attr("pintype")||0<$(d).find("link[srcnodeid="+c.id+"]").filter("link[srcpinname='"+e.replace(/[\[\]]/,"")+"']").length?void 0==c.outputPins[e]&&c.addOutputPin(e,k):void 0==c.inputPins[e]&&void 0==c.invisiblePins[e]&&c.addInputPin(e,k):void 0==c.inputPins[e]&&void 0==c.invisiblePins[e]&&c.addInvisiblePin(e,k)});k||(c.initialize(),l.nodeList.push(c));"complete"==b&&(m[c.id]=c)});"complete"==b&&(_(p).each(function(c,d){void 0==m[d]&&("development"==VVVV_ENV&&console.log("removing node "+
c.id),l.nodeList.splice(l.nodeList.indexOf(c),1),delete l.nodeMap[c.id])}),p={},_(m).each(function(c,d){p[d]=c}));0===s&&h(d);0>=this.resourcesPending&&e&&e()};this.getSubPatches=function(){for(var c=[],d=0;d<this.nodeList.length;d++)this.nodeList[d].isSubpatch&&(c.push(this.nodeList[d]),c=c.concat(this.nodeList[d].getSubPatches()));return c};this.afterEvaluate=function(){};this.afterUpdate=function(){};this.toXML=function(){var c=$("<PATCH>");$bounds=$("<BOUNDS>");$bounds.attr("type","Window");$bounds.attr("width",
parseInt(15*this.width));$bounds.attr("height",parseInt(15*this.height));c.append($bounds);for(var d=0;d<this.nodeList.length;d++)c.append(this.nodeList[d].serialize());for(d=0;d<this.linkList.length;d++)c.append(this.linkList[d].serialize());c='<!DOCTYPE PATCH  SYSTEM "http://vvvv.org/versions/vvvv45beta28.1.dtd" >\r\n  '+c.wrapAll("<d></d>").parent().html();c=c.replace(/<patch/g,"<PATCH");c=c.replace(/<\/patch>/g,"\n  </PATCH>");c=c.replace(/<node/g,"\n  <NODE");c=c.replace(/<\/node>/g,"\n  </NODE>");
c=c.replace(/<bounds/g,"\n  <BOUNDS");c=c.replace(/<\/bounds>/g,"\n  </BOUNDS>");c=c.replace(/<pin/g,"\n  <PIN");c=c.replace(/<\/pin>/g,"\n  </PIN>");c=c.replace(/<lonk/g,"\n  <LINK");return c=c.replace(/<\/lonk>/g,"\n  </LINK>")};this.evaluate=function(){function c(e){upstreamNodes=e.getUpstreamNodes();_(upstreamNodes).each(function(d){void 0==k[d.id]||d.delays_output||c(d)});if(e.dirty||e.auto_evaluate||e.isSubpatch){if(d)var g=(new Date).getTime();e.auto_nil&&!e.isSubpatch&&e.hasNilInputs()?_(e.outputPins).each(function(c){c.setSliceCount(0)}):
(e.evaluate(),d&&console.log(e.nodename+" / "+e.id+": "+((new Date).getTime()-g)+"ms"),e.dirty=!1,_(e.inputPins).each(function(c){c.changed=!1}))}delete k[e.id];return!0}if(!(0<this.resourcesPending)){if(d)var e=(new Date).getTime();for(var k={},g={},h=0;h<this.nodeList.length;h++){if(0==this.nodeList[h].getDownstreamNodes().length||this.nodeList[h].auto_evaluate||this.nodeList[h].delays_output)g[this.nodeList[h].id]=this.nodeList[h];k[this.nodeList[h].id]=this.nodeList[h]}d&&console.log("building node maps: "+
((new Date).getTime()-e)+"ms");_(g).each(function(d,e,g){void 0!=k[d.id]&&c(d)});d&&(e=(new Date).getTime());this.afterEvaluate();d&&console.log("patch rendering: "+((new Date).getTime()-e)+"ms");d=!1}};$(window).keydown(function(c){84==c.which&&(c.altKey&&c.ctrlKey)&&(d=!0)});if(/\.v4p[^<>\s]*$/.test(a)){this.nodename=a;var s=this;$.ajax({url:a,type:"get",dataType:"text",success:function(c){s.doLoad(c,function(){s.success&&s.success();s.afterUpdate()})}})}else/^ws:\/\//.test(a)?(s=this,VVVV.Editors.Connector.host=
a,VVVV.Editors.Connector.enable(this,{success:function(){s.success&&s.success()},error:function(){s.error&&s.error()}})):this.doLoad(a,function(){this.success&&this.success()});e();$(window).bind("hashchange",function(){e()})}};VVVV.Core.Patch.prototype=new VVVV.Core.Node;if(!WebSocket&&MozWebSocket)var WebSocket=MozWebSocket;
VVVV.Core.VVVVConnector=function(){this.patches=[];this.patchMap={};var a=this.host=!1,b=[],h=this;this.enable=function(g,e){e=e||{};if(this.host){a=new WebSocket(this.host+":4444","vvvvjs");window.setInterval(function(){(message=b.shift())&&a.send(message)},300);var d=!1;a.onopen=function(){function c(d){k[d]&&(h.addPatch(k[d]),window.setTimeout(function(){c(d+1)},2E3))}d=!0;console.log("connected to VVVV ...");h.addPatch(g);var k=g.getSubPatches();window.setTimeout(function(){c(0)},2E3);e.success&&
e.success()};a.onclose=function(){!d&&e.error&&e.error();d=!1};a.onmessage=function(c){c=c.data.split("UPDATE");for(var d=0;d<c.length;d++){var e=("UPDATE"+c[d]).match(/^UPDATE\/([^/]+)\/([\s\S]*)/);if(e&&(h.patchMap[e[1]+".v4p"]&&_(h.patchMap[e[1]+".v4p"]).each(function(c){c.doLoad(e[2]);c.afterUpdate()}),"*"==e[1])){var g=h.patchMap[Object.keys(h.patchMap)[0]][0];g.doLoad(e[2]);g.afterUpdate()}}};$(window).unload(function(){console.log("closing socket ...");a.close()})}};this.addPatch=function(g){for(var e=
0;e<this.patches.length;e++)if(this.patches[e].id==g.id)return;console.log("adding patch "+g.nodename+" to Connector");this.patches.push(g);this.patchMap[g.nodename]||(this.patchMap[g.nodename]=[]);this.patchMap[g.nodename].push(g);g.VVVVConnector=this;h.pushCompletePatch(g);window.setTimeout(function(){h.pullCompletePatch(g)},1E3)};this.disable=function(){this.patch&&(this.patch=this.patch.VVVVConnector=void 0,a&&a.close(),a.onmessage=null,a.onopen=null,a=!1)};this.pullCompletePatch=function(g){console.log("pulling patch..."+
g.nodename);b.push("PULL/"+g.nodename)};this.pushCompletePatch=function(g){console.log("pushing patch ..."+g.nodename);b.push("PUSH/"+g.nodename+"/"+g.XMLCode)};this.sendUndo=function(){a&&(console.log("forcing Undo ..."),b.push("UNDO"))};this.isConnected=function(){return!1!==a}};VVVV.Editors={};VVVV.Editors.Connector=new VVVV.Core.VVVVConnector;VVVV.Nodes.VVVVJsConnector=function(a,b){this.constructor(a,"VVVVJsConnector (VVVVjs)",b)};VVVV.Nodes.VVVVJsConnector.prototype=new VVVV.Core.Node;VVVV.Core.DOMInterface=function(a){function b(d){if("event"==d.property_class){var c=d.selector;"window"==c&&(c=window);"document"==c&&(c=document);$(c).each(function(c){d.values[c]=0;$(this).bind(d.property,function(){d.values[c]=1;return!1})})}}var h={},g={};a.domInterface=this;this.connect=function(d){_(h).each(function(c,e){c.node.id==d.id&&("event"==c.property_class&&$(c.selector).unbind(c.property),delete h[e])});_(g).each(function(c,e){c.node.id==d.id&&delete g[e]});var c=/([^\/]+)(\/(event|attribute|style)\/(.+))?/.exec(d.invisiblePins["Descriptive Name"].getValue(0));
if(null!=c){var e={selector:c[1],property_class:c[3],property:c[4],values:[],node:d};0==d.getUpstreamNodes().length?h[c[0]]=e:0==d.getDownstreamNodes().length&&(g[c[0]]=e);b(e)}};var e=this;_(a.nodeList).each(function(d){d.isIOBox&&void 0!=d.invisiblePins["Descriptive Name"]&&(e.connect(d),d.IOBoxInputPin().connectionChanged=function(){e.connect(d)})});this.populateInputConnectors=function(){var d=this;_(h).each(function(c){switch(c.property_class){case "event":c.values.length!=c.node.IOBoxInputPin().values.length&&
c.node.IOBoxInputPin().setSliceCount(c.values.length);for(var e=0;e<c.values.length;e++)void 0!=c.node.IOBoxInputPin().values[e]&&c.values[e]==c.node.IOBoxInputPin().values[e]||c.node.IOBoxInputPin().setValue(e,c.values[e]);break;default:for(d.fetchValuesFromDOM(c),c.values.length!=c.node.IOBoxInputPin().values.length&&c.node.IOBoxInputPin().setSliceCount(c.values.length),e=0;e<c.values.length;e++)c.node.IOBoxInputPin().getValue(e)!=c.values[e]&&c.node.IOBoxInputPin().setValue(e,c.values[e])}})};
this.processOutputConnectors=function(){var d=this;_(g).each(function(c){switch(c.property_class){default:d.setDOMByIOBox(c)}});_(h).each(function(c){if("event"==c.property_class)for(var d=0;d<c.values.length;d++)c.values[d]=0})};this.fetchValuesFromDOM=function(d){d.values.length=0;$(d.selector).each(function(c){var e;if(void 0==d.property_class)switch(this.nodeName){case "INPUT":"text"==$(this).attr("type")&&(e=$(this).val());"checkbox"==$(this).attr("type")&&(e=$(this).attr("checked")?1:0);break;
default:e=$(this).text()}"attribute"==d.property_class&&(e=$(this).attr(d.property));"style"==d.property_class&&(e=$(this).css(d.property));d.values[c]=e})};this.setDOMByIOBox=function(d){if(d.node.IOBoxOutputPin().pinIsChanged()){var c=d.node.IOBoxInputPin().values,e=$(d.selector).length;void 0==d.property_class&&($(d.selector).empty(),$(d.selector).val(""));for(var g=0;g<Math.max(c.length,e);g++){var h=g%e,l=g%c.length,a=$(d.selector).eq(h);if(0!=a.length){if(void 0==d.property_class)switch(a[0].nodeName){case "INPUT":a.val($(d.selector).eq(h).val()+
c[l]);break;default:a.html($(d.selector).eq(h).html()+c[l])}"attribute"==d.property_class&&a.attr(d.property,c[l]);"style"==d.property_class&&a.css(d.property,c[l])}}}}};VVVV.fps=60;
VVVV.Core.MainLoop=function(a,b){function h(){if(0==a.resourcesPending){g++;var p=(new Date).getTime();e.populateInputConnectors();a.evaluate();e.processOutputConnectors();var b=(new Date).getTime()-p;0==g%10&&(k&&(console.log(1/((p-c)/1E4)+"fps"),k=!1),c=p)}d&&window.setTimeout(h,Math.max(0,Math.round(1E3/VVVV.fps-b)))}VVVV.fps=b||60;var g=0,e=new VVVV.Core.DOMInterface(a),d=!0,c=0,k=!1;this.stop=function(){d=!1};this.start=function(){d||(d=!0,h())};this.isRunning=function(){return d};h();$(window).keydown(function(c){(102==
c.which||70==c.which)&&(c.altKey&&c.ctrlKey)&&(k=!0)})};VVVV.Nodes.Cross2d=function(a,b){this.constructor(a,"Cross (2d)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};this.auto_evaluate=!1;var h=this.addInputPin("X In",[0],this),g=this.addInputPin("Y In",[0],this),e=this.addInputPin("Include Upper",[1],this),d=this.addInputPin("Include Lower",[1],this),c=this.addInputPin("Include Equal",[1],this),k=this.addOutputPin("X Out",[0],this),p=this.addOutputPin("Y Out",[0],this);this.evaluate=function(){for(var a=
0,l=0;l<g.getSliceCount();l++)for(var b=0;b<h.getSliceCount();b++)0.5>e.getValue(0)&&l>b||(0.5>d.getValue(0)&&l<b||0.5>c.getValue(0)&&l==b)||(k.setValue(a,h.getValue(b)),p.setValue(a,g.getValue(l)),a++);k.setSliceCount(a);p.setSliceCount(a)}};VVVV.Nodes.Cross2d.prototype=new VVVV.Core.Node;
VVVV.Nodes.Polar2d=function(a,b){this.constructor(a,"Polar (2d)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};this.auto_evaluate=!1;var h=this.addInputPin("X",[1],this),g=this.addInputPin("Y",[0],this),e=this.addOutputPin("Angle",[0],this),d=this.addOutputPin("Length",[1],this);this.initialize=function(){};this.evaluate=function(){for(var c=this.getMaxInputSliceCount(),k=0;k<c;k++){var a=h.getValue(k),b=g.getValue(k);e.setValue(k,Math.atan2(b,
a)/(2*Math.PI));d.setValue(k,Math.sqrt(a*a+b*b))}e.setSliceCount(c);d.setSliceCount(c)}};VVVV.Nodes.Polar2d.prototype=new VVVV.Core.Node;
VVVV.Nodes.Cartesian2d=function(a,b){this.constructor(a,"Cartesian (2d)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};this.auto_evaluate=!1;var h=this.addInputPin("Angle",[0],this),g=this.addInputPin("Length",[1],this),e=this.addOutputPin("X",[1],this),d=this.addOutputPin("Y",[0],this);this.evaluate=function(){for(var c=this.getMaxInputSliceCount(),k=0;k<c;k++){var a=h.getValue(k),b=g.getValue(k);e.setValue(k,b*Math.cos(2*a*Math.PI));
d.setValue(k,b*Math.sin(2*a*Math.PI))}e.setSliceCount(c);d.setSliceCount(c)}};VVVV.Nodes.Cartesian2d.prototype=new VVVV.Core.Node;
VVVV.Nodes.Points2Vector2d=function(a,b){this.constructor(a,"Points2Vector (2d)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};this.auto_evaluate=!1;var h=this.addInputPin("X1",[0],this),g=this.addInputPin("Y1",[0],this),e=this.addInputPin("X2",[1],this),d=this.addInputPin("Y2",[0],this),c=this.addOutputPin("X",[0],this),k=this.addOutputPin("Y",[0],this),p=this.addOutputPin("Length",[1],this),m=this.addOutputPin("Angle",[0],this);this.evaluate=
function(){for(var l=this.getMaxInputSliceCount(),a=0;a<l;a++){var b=parseFloat(h.getValue(a)),n=parseFloat(g.getValue(a)),t=parseFloat(e.getValue(a)),v=parseFloat(d.getValue(a)),t=t-b,v=v-n;c.setValue(a,b+t/2);k.setValue(a,n+v/2);p.setValue(a,Math.sqrt(t*t+v*v));m.setValue(a,Math.atan2(v,t)/(2*Math.PI))}c.setSliceCount(l);k.setSliceCount(l);p.setSliceCount(l);m.setSliceCount(l)}};VVVV.Nodes.Points2Vector2d.prototype=new VVVV.Core.Node;
VVVV.Nodes.Vector2Points2d=function(a,b){this.constructor(a,"Vector2Points (2d)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};this.auto_evaluate=!1;var h=this.addInputPin("X",[0],this),g=this.addInputPin("Y",[0],this),e=this.addInputPin("Length",[1],this),d=this.addInputPin("Angle",[0],this),c=this.addOutputPin("X1",[0],this),k=this.addOutputPin("Y1",[0],this),p=this.addOutputPin("X2",[0],this),m=this.addOutputPin("Y2",[0],this);this.evaluate=
function(){for(var a=this.getMaxInputSliceCount(),b=0;b<a;b++){var q=parseFloat(h.getValue(b)),n=parseFloat(g.getValue(b)),t=parseFloat(e.getValue(b)),v=2*parseFloat(d.getValue(b)-0.25)*Math.PI,w=t/2*Math.sin(v),t=-t/2*Math.cos(v);c.setValue(b,q+w);k.setValue(b,n+t);p.setValue(b,q-w);m.setValue(b,n-t)}c.setSliceCount(a);k.setSliceCount(a);p.setSliceCount(a);m.setSliceCount(a)}};VVVV.Nodes.Vector2Points2d.prototype=new VVVV.Core.Node;VVVV.Nodes.Polar3d=function(a,b){this.constructor(a,"Polar (3d)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};this.auto_evaluate=!1;var h=this.addInputPin("X",[0],this),g=this.addInputPin("Y",[0],this),e=this.addInputPin("Z",[-1],this),d=this.addOutputPin("Pitch",[0],this),c=this.addOutputPin("Yaw",[0],this),k=this.addOutputPin("Length",[1],this);this.evaluate=function(){for(var a=this.getMaxInputSliceCount(),b=0;b<a;b++){var l=h.getValue(b),
s=g.getValue(b),q=e.getValue(b),n=Math.sqrt(l*l+s*s+q*q);c.setValue(b,Math.atan2(-l,-q)/(2*Math.PI));d.setValue(b,0==n?0:Math.acos(-s/n)/(2*Math.PI)-0.25);k.setValue(b,n)}c.setSliceCount(a);d.setSliceCount(a);k.setSliceCount(a)}};VVVV.Nodes.Polar3d.prototype=new VVVV.Core.Node;
VVVV.Nodes.Cartesian3d=function(a,b){this.constructor(a,"Cartesian (3d)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};this.auto_evaluate=!1;var h=this.addInputPin("Pitch",[0],this),g=this.addInputPin("Yaw",[0],this),e=this.addInputPin("Length",[1],this),d=this.addOutputPin("X",[0],this),c=this.addOutputPin("Y",[0],this),k=this.addOutputPin("Z",[1],this);this.evaluate=function(){for(var a=this.getMaxInputSliceCount(),b=0;b<a;b++){var l=
2*(h.getValue(b)+0.25)*Math.PI,s=2*g.getValue(b)*Math.PI,q=e.getValue(b);k.setValue(b,-q*Math.cos(s)*Math.sin(l));d.setValue(b,-q*Math.sin(s)*Math.sin(l));c.setValue(b,-q*Math.cos(l))}d.setSliceCount(a);c.setSliceCount(a);k.setSliceCount(a)}};VVVV.Nodes.Cartesian3d.prototype=new VVVV.Core.Node;
VVVV.Nodes.Normalize3d=function(a,b){this.constructor(a,"Normalize (3d)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};this.auto_evaluate=!1;var h=this.addInputPin("X",[1],this),g=this.addInputPin("Y",[0],this),e=this.addInputPin("Z",[0],this),d=this.addOutputPin("NormalizedX",[1],this),c=this.addOutputPin("NormalizedY",[0],this),k=this.addOutputPin("NormalizedZ",[0],this),p=this.addOutputPin("Input Length",[0],this);this.evaluate=function(){for(var a=
this.getMaxInputSliceCount(),l=0;l<a;l++){var b=h.getValue(l),q=g.getValue(l),n=e.getValue(l),t=Math.sqrt(b*b+q*q+n*n);d.setValue(l,0==t?0:b/t);c.setValue(l,0==t?0:q/t);k.setValue(l,0==t?0:n/t);p.setValue(l,t)}d.setSliceCount(a);c.setSliceCount(a);k.setSliceCount(a);p.setSliceCount(a)}};VVVV.Nodes.Normalize3d.prototype=new VVVV.Core.Node;
VVVV.Nodes.Normalize3dVector=function(a,b){this.constructor(a,"Normalize (3d Vector)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};this.auto_evaluate=!1;var h=this.addInputPin("XYZ",[],this),g=this.addOutputPin("NormalizedXYZ",[],this),e=this.addOutputPin("Input Length",[0],this);this.evaluate=function(){for(var d=this.getMaxInputSliceCount(),c=0;c<d/3;c++){var k=h.getValue(c,3),a=Math.sqrt(k[0]*k[0]+k[1]*k[1]+k[2]*k[2]);g.setValue(3*
c,0==a?0:k[0]/a);g.setValue(3*c+1,0==a?0:k[1]/a);g.setValue(3*c+2,0==a?0:k[2]/a);e.setValue(c,a)}g.setSliceCount(3*Math.ceil(d/3));e.setSliceCount(Math.ceil(d/3))}};VVVV.Nodes.Normalize3dVector.prototype=new VVVV.Core.Node;
VVVV.Nodes.Multiply3dCross=function(a,b){this.constructor(a,"Multiply (3d Cross)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};this.auto_evaluate=!1;var h=this.addInputPin("Input1 XYZ",[],this),g=this.addInputPin("Input2 XYZ",[],this),e=this.addOutputPin("Output XYZ",[],this);this.evaluate=function(){for(var d=this.getMaxInputSliceCount(),c=0;c<d/3;c++){var k=h.getValue(c,3),a=g.getValue(c,3);e.setValue(3*c+0,k[1]*a[2]-k[2]*a[1]);e.setValue(3*
c+1,-(k[0]*a[2]-k[2]*a[0]));e.setValue(3*c+2,k[0]*a[1]-k[1]*a[0])}e.setSliceCount(3*Math.ceil(d/3))}};VVVV.Nodes.Multiply3dCross.prototype=new VVVV.Core.Node;
VVVV.Nodes.Multiply3dDot=function(a,b){this.constructor(a,"Multiply (3d Dot)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};this.auto_evaluate=!1;var h=this.addInputPin("Input1 XYZ",[],this),g=this.addInputPin("Input2 XYZ",[],this),e=this.addOutputPin("Output",[0],this);this.evaluate=function(){for(var d=this.getMaxInputSliceCount(),c=0;c<d/3;c++){var k=h.getValue(c,3),a=g.getValue(c,3);e.setValue(c,k[0]*a[0]+k[1]*a[1]+k[2]*a[2])}e.setSliceCount(Math.ceil(d/
3))}};VVVV.Nodes.Multiply3dDot.prototype=new VVVV.Core.Node;
VVVV.Nodes.Multiply3dVector=function(a,b){this.constructor(a,"Multiply (3d Vector)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};this.auto_evaluate=!1;var h=this.addInputPin("Transform",[],this,!0,VVVV.PinTypes.Transform),g=this.addInputPin("XYZ UnTransformed",[0,0,0],this),e=this.addOutputPin("XYZ Transformed",[0,0,0],this);this.evaluate=function(){for(var d=Math.max(h.getSliceCount(),g.getSliceCount()/3),c=0;c<d;c++){var k=g.getValue(3*
c,3),a=h.getValue(c);mat4.multiplyVec3(a,k);e.setValue(3*c+0,k[0]);e.setValue(3*c+1,k[1]);e.setValue(3*c+2,k[2])}e.setSliceCount(Math.ceil(3*d))}};VVVV.Nodes.Multiply3dVector.prototype=new VVVV.Core.Node;VVVV.Nodes.LFO=function(a,b){this.constructor(a,"LFO (Animation)",b);this.meta={authors:["Matthias Zauner, sebl"],original_authors:["VVVV Group"],credits:[],compatibility_issues:["Not spreadable yet"]};this.auto_evaluate=!0;var h=this.addInputPin("Period",[1],this),g=this.addInputPin("Pause",[0],this),e=this.addInputPin("Reverse",[0],this),d=this.addInputPin("Reset",[0],this),c=this.addInputPin("Phase",[0],this),k=this.addOutputPin("Output",[0],this),p=this.addOutputPin("Cycles",[0],this),m=[],l=
[],s=(new Date).getTime(),q=(new Date).getTime();this.evaluate=function(){var a=this.getMaxInputSliceCount();s=(new Date).getTime()-q;for(var b=0;b<a;b++){var v=h.getValue(b%h.values.length),w=g.getValue(b%g.values.length),y=e.getValue(b%e.values.length),r=d.getValue(b%d.values.length),u=c.getValue(b%c.values.length);void 0==m[b]&&(m[b]=0);void 0==l[b]&&(l[b]=0);0.5>w&&(0!=v&&isFinite(v))&&(dv=1/(1E3*v)*s,0<y&&(dv*=-1),m[b]+=dv,0>m[b]&&(l[b]-=Math.ceil(-m[b]),m[b]=1+m[b]),1<m[b]&&(l[b]+=Math.floor(m[b])));
q=(new Date).getTime();0.5<=r&&(m[b]=0,l[b]=0);if(0.5>w||0.5<=r)k.setValue(b,(m[b]+u)%1),p.setValue(b,l[b]);m[b]%=1}k.setSliceCount(a);p.setSliceCount(a);m.splice(a);l.splice(a)}};VVVV.Nodes.LFO.prototype=new VVVV.Core.Node;
VVVV.Nodes.LinearFilter=function(a,b){this.constructor(a,"LinearFilter (Animation)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:["Sometimes doesnt stop when target reached","Cyclic Pin not implemented","Acceleration and Velocitity Out are not set yet"]};this.auto_evaluate=!0;var h=this.addInputPin("Go To Position",[0],this),g=this.addInputPin("FilterTime",[1],this),e=this.addOutputPin("Position Out",[0],this);this.addOutputPin("Velocity Out",
[0],this);this.addOutputPin("Acceleration Out",[0],this);var d=[],c=[],k=[],p=[],m=[];this.evaluate=function(){for(var a=this.getMaxInputSliceCount(),b=h.pinIsChanged()||g.pinIsChanged(),q=0;q<a;q++){void 0==d[q]&&(d[q]=(new Date).getTime());var n=(new Date).getTime()-d[q],t=parseFloat(h.getValue(q)),v=parseFloat(g.getValue(q));void 0==c[q]&&(c[q]=t);isFinite(t)&&isFinite(v)?(b&&(p[q]=void 0,m[q]=0<=t-c[q],k[q]=0<v?(t-c[q])/(1E3*v):0),m[q]==0<=t-c[q]&&(c[q]+=k[q]*n),void 0!=p[q]&&0<=t-c[q]!=0<=p[q]&&
(k[q]=0,c[q]=t),0!=p[q]&&e.setValue(q,c[q]),p[q]=t-c[q],d[q]=(new Date).getTime()):(c[q]=void 0,e.setValue(q,void 0))}b&&e.getSliceCount()!=a&&(d.splice(a),c.splice(a),k.splice(a),p.splice(a),e.setSliceCount(a))}};VVVV.Nodes.LinearFilter.prototype=new VVVV.Core.Node;
VVVV.Nodes.Delay=function(a,b){this.constructor(a,"Delay (Animation)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:["Reset not implemented","Linear Mode not implemented"]};this.auto_evaluate=!0;var h=this.addInputPin("Input",[0],this),g=this.addInputPin("Time",[1],this),e=this.addInputPin("Insert",[1],this),d=this.addOutputPin("Output",[0],this),c=[],k=Array(1024);this.evaluate=function(){var a=this.getMaxInputSliceCount();now=(new Date).getTime();
var b=h.pinIsChanged();if(void 0==h.getValue(0))b&&d.setValue(0,void 0);else{if(1==e.getValue(0)&&(b||g.pinIsChanged()))for(k.pop(),k.unshift(now),b=0;b<a;b++){if(void 0==c[b]){c[b]=Array(1024);for(var l=1024;l--;)c[b][l]=0}1024<=c[b].length&&c[b].pop();c[b].unshift(h.getValue(b))}for(b=0;b<a;b++){for(var s=now-1E3*g.getValue(b),q=!1,l=0;1024>l;l++)if(k[l]<=s){d.values[b]!=c[b][l]&&d.setValue(b,c[b][l]);q=!0;break}q||0==d.values[b]||d.setValue(b,0)}d.setSliceCount(a);c.splice(a)}}};
VVVV.Nodes.Delay.prototype=new VVVV.Core.Node;
VVVV.Nodes.Change=function(a,b){this.constructor(a,"Change (Animation)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};this.auto_evaluate=!0;var h=this.addInputPin("Input",[0],this),g=this.addOutputPin("OnChange",[0],this),e=[];this.evaluate=function(){var d=this.getMaxInputSliceCount();if(h.pinIsChanged()){for(var c=0;c<d;c++)e[c]!=h.getValue(c)?g.setValue(c,1):1==g.getValue(c)&&g.setValue(c,0),e[c]=h.getValue(c);g.setSliceCount(d)}else{for(c=
0;c<d;c++)1==g.getValue(c)&&(g.setValue(c,0),g.setSliceCount(d));e[c]=h.getValue(c)}}};VVVV.Nodes.Change.prototype=new VVVV.Core.Node;
VVVV.Nodes.TogEdge=function(a,b){this.constructor(a,"TogEdge (Animation)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};this.auto_evaluate=!0;var h=this.addInputPin("Input",[0],this),g=this.addOutputPin("Up Edge",[0],this),e=this.addOutputPin("Down Edge",[0],this),d=[];this.evaluate=function(){for(var c=this.getMaxInputSliceCount(),k=0;k<c;k++)(0>=Math.round(d[k])||void 0==d[k])&&1<=Math.round(h.getValue(k))?g.setValue(k,1):0!=g.values[k]&&
g.setValue(k,0),1<=Math.round(d[k])&&0>=Math.round(h.getValue(k))?e.setValue(k,1):0!=e.values[k]&&e.setValue(k,0),d[k]=h.getValue(k);g.setSliceCount(c);e.setSliceCount(c)}};VVVV.Nodes.TogEdge.prototype=new VVVV.Core.Node;
VVVV.Nodes.FlipFlop=function(a,b){this.constructor(a,"FlipFlop (Animation)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};var h=this.addInputPin("Set",[0],this),g=this.addInputPin("Reset",[0],this),e=this.addOutputPin("Output",[0],this),d=this.addOutputPin("Inverse Output",[1],this),c=!1;this.evaluate=function(){var k=this.getMaxInputSliceCount(),a=e.getSliceCount();if(k>a)for(;a<k;a++)e.setValue(a,0),d.setValue(a,1);for(a=0;a<k;a++){var b=
void 0;1<=Math.round(g.getValue(a))&&(b=0);1<=Math.round(h.getValue(a))&&(b=1);void 0!=b?(e.setValue(a,b),d.setValue(a,1-b)):c||(e.setValue(a,0),d.setValue(a,1))}e.setSliceCount(k);d.setSliceCount(k);c=!0}};VVVV.Nodes.FlipFlop.prototype=new VVVV.Core.Node;
VVVV.Nodes.SampleAndHold=function(a,b){this.constructor(a,"S+H (Animation)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:["different output slice count in pure VVVV, if Set pin has only one slice"]};var h=this.addInputPin("Input",[0],this),g=this.addInputPin("Set",[0],this),e=this.addOutputPin("Output",[0],this);this.evaluate=function(){var d=this.getMaxInputSliceCount();if(g.pinIsChanged()||h.pinIsChanged()){for(var c=0;c<d;c++)void 0==
e.values[c]&&e.setValue(c,0),1<=Math.round(g.getValue(c))&&e.setValue(c,h.getValue(c));e.setSliceCount(d)}}};VVVV.Nodes.SampleAndHold.prototype=new VVVV.Core.Node;
VVVV.Nodes.FrameDelay=function(a,b){this.constructor(a,"FrameDelay (Animation)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:["no dynamice pin count"]};this.delays_output=!0;var h=this.addInputPin("Input 1",[0],this),g=this.addInputPin("Default 1",[0],this),e=this.addInputPin("Initialize",[0],this),d=this.addOutputPin("Output 1",[0],this);this.evaluate=function(){for(var c=this.getMaxInputSliceCount(),k=0;k<c;k++)0.5<e.getValue(k)?d.setValue(k,
g.getValue(k)):d.setValue(k,h.getValue(k));d.setSliceCount(c)}};VVVV.Nodes.FrameDelay.prototype=new VVVV.Core.Node;
VVVV.Nodes.Toggle=function(a,b){this.constructor(a,"Toggle (Animation)",b);this.meta={authors:["David M\u00f3r\u00e1sz (micro.D)"],original_authors:["VVVV Group"],credits:["Matthias Zauner"],compatibility_issues:[]};this.auto_evaluate=!0;var h=this.addInputPin("Input",[0],this),g=this.addInputPin("Reset",[0],this),e=this.addOutputPin("Output",[0],this),d=this.addOutputPin("Inverse Output",[1],this),c=!1;this.evaluate=function(){var k=this.getMaxInputSliceCount(),a=e.getSliceCount();if(k>a)for(;a<
k;a++)e.setValue(a,0),d.setValue(a,1);for(a=0;a<k;a++){var b=void 0;1<=Math.round(g.getValue(a))&&(b=0);1<=Math.round(h.getValue(a))&&(b=1-parseFloat(e.getValue(a)));void 0!=b&&e.getValue(a)!=b?(e.setValue(a,b),d.setValue(a,1-b)):c||(e.setValue(a,0),d.setValue(a,1))}e.setSliceCount(k);d.setSliceCount(k);c=!0}};VVVV.Nodes.Toggle.prototype=new VVVV.Core.Node;
VVVV.Nodes.Counter=function(a,b){this.constructor(a,"Counter (Animation)",b);this.meta={authors:["David M\u00f3r\u00e1sz (micro.D)","Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};this.auto_evaluate=!0;var h=this.addInputPin("Up",[0],this),g=this.addInputPin("Down",[0],this),e=this.addInputPin("Minimum",[0],this),d=this.addInputPin("Maximum",[15],this),c=this.addInputPin("Increment",[1],this),k=this.addInputPin("Default",[0],this),p=this.addInputPin("Reset",
[0],this),m=this.addInputPin("Mode",["Wrap"],this),l=this.addOutputPin("Output",[0],this),s=this.addOutputPin("Underflow",[0],this),q=this.addOutputPin("Overflow",[0],this),n=!1;this.evaluate=function(){for(var a=this.getMaxInputSliceCount(),b=e.pinIsChanged()||d.pinIsChanged()||k.pinIsChanged()||p.pinIsChanged()||m.pinIsChanged(),w=0;w<a;w++)1!=q.getValue(w)&&n||q.setValue(w,0),1!=s.getValue(w)&&n||s.setValue(w,0),n||l.setValue(w,0),b=b||0.5<=h.getValue(w)||0.5<=g.getValue(w);if(b){for(w=0;w<a;w++){var b=
parseFloat(c.getValue(w)),y=w>=l.getSliceCount()?0:parseFloat(l.getValue(w)),r=parseFloat(d.getValue(w)),u=parseFloat(e.getValue(w)),z=0;"Unlimited"==m.getValue(w)&&(z=1);"Clamp"==m.getValue(w)&&(z=2);switch(z){case 1:0.5<=h.getValue(w)&&(y+=b);0.5<=g.getValue(w)&&(y-=b);break;case 2:0.5<=h.getValue(w)&&(y+=b);0.5<=g.getValue(w)&&(y-=b);y>r&&(y=r,q.setValue(w,1));y<u&&(y=u,s.setValue(w,1));break;default:0.5<=h.getValue(w)&&(y+=b),0.5<=g.getValue(w)&&(y-=b),y>r&&(y=u,q.setValue(w,1)),y<u&&(y=r,s.setValue(w,
1))}l.getValue(w)!=y&&l.setValue(w,y);0.5<=p.getValue(w)&&l.setValue(w,k.getValue(w))}l.setSliceCount(a);s.setSliceCount(a);q.setSliceCount(a)}n=!0}};VVVV.Nodes.Counter.prototype=new VVVV.Core.Node;VVVV.Nodes.CurrentTimeAstronomy=function(a,b){this.constructor(a,"CurrentTime (Astronomy)",b);this.meta={authors:["Zauner"],original_authors:["VVVV Group"],credits:["http://javascript.about.com/library/bldst.htm"],compatibility_issues:["Time Zone index differs from classic VVVV","Time Zone Name does not work in Firefox"]};this.auto_evaluate=!0;var h=new Date,g=this.addOutputPin("GMT",[],this),e=this.addOutputPin("Time Zone",[0],this),d=this.addOutputPin("Time Zone Name",[""],this);this.addOutputPin("Daylight Saving Time",
[h.getTimezoneOffset()<function(c){var d=new Date(c.getFullYear(),0,1);c=new Date(c.getFullYear(),6,1);return Math.max(d.getTimezoneOffset(),c.getTimezoneOffset())}(h)?1:0],this);var c=this.addOutputPin("Current Time",[],this);this.evaluate=function(){var k=new Date,a=36E5*k.getTimezoneOffset(),b=k.getTime();g.setValue(0,b/1E3/60/60/24+25569);e.setValue(0,a/1E3/60/60);k.toString().match(/\((.+)\)$/)?d.setValue(0,k.toString().match(/\((.+)\)$/)[1]):d.setValue(0,"n/a");c.setValue(0,(b-a)/1E3/60/60/
24+25569)}};VVVV.Nodes.CurrentTimeAstronomy.prototype=new VVVV.Core.Node;
VVVV.Nodes.GregorianAstronomySplit=function(a,b){this.constructor(a,"Gregorian (Astronomy Split)",b);this.meta={authors:["Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};this.auto_evaluate=!1;var h=this.addInputPin("Time",[41491.4301],this),g=this.addOutputPin("Millisecond",[0],this),e=this.addOutputPin("Second",[0],this),d=this.addOutputPin("Minute",[0],this),c=this.addOutputPin("Hour",[0],this),k=this.addOutputPin("DayOfWeek",[0],this),p=this.addOutputPin("Day",[1],
this),m=this.addOutputPin("Month",[1],this),l=this.addOutputPin("Year",[2E3],this);this.evaluate=function(){for(var a=this.getMaxInputSliceCount(),b=0;b<a;b++){var n=864E5*(h.getValue(b)-25569),n=new Date(n);x=n.getMilliseconds();x!=g.values[b]&&g.setValue(b,x);x=n.getSeconds();x!=e.values[b]&&e.setValue(b,x);x=n.getMinutes();x!=d.values[b]&&d.setValue(b,x);x=n.getHours();x!=c.values[b]&&c.setValue(b,x);x=n.getDay();x!=k.values[b]&&k.setValue(b,x);x=n.getDate();x!=p.values[b]&&p.setValue(b,x);x=n.getMonth()+
1;x!=m.values[b]&&m.setValue(b,x);x=n.getYear()+1900;x!=l.values[b]&&l.setValue(b,x)}g.setSliceCount(a);e.setSliceCount(a);d.setSliceCount(a);c.setSliceCount(a);k.setSliceCount(a);p.setSliceCount(a);m.setSliceCount(a);l.setSliceCount(a)}};VVVV.Nodes.GregorianAstronomySplit.prototype=new VVVV.Core.Node;VVVV.Nodes.And=function(a,b){this.constructor(a,"AND (Boolean)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:["No dynamic pin count yet"]};var h=this.addInputPin("Input 1",[1],this),g=this.addInputPin("Input 2",[1],this),e=this.addOutputPin("Output",[1],this);this.evaluate=function(){if(h.pinIsChanged()||g.pinIsChanged()){for(var d=0;d<this.getMaxInputSliceCount();d++)1<=Math.round(h.getValue(d))&&1<=Math.round(g.getValue(d))?e.setValue(d,
1):e.setValue(d,0);e.setSliceCount(this.getMaxInputSliceCount())}}};VVVV.Nodes.And.prototype=new VVVV.Core.Node;
VVVV.Nodes.Or=function(a,b){this.constructor(a,"OR (Boolean)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:["No dynamic pin count yet"]};var h=this.addInputPin("Input 1",[1],this),g=this.addInputPin("Input 2",[1],this),e=this.addOutputPin("Output",[1],this);this.evaluate=function(){if(h.pinIsChanged()||g.pinIsChanged()){for(var d=0;d<this.getMaxInputSliceCount();d++)1<=Math.round(h.getValue(d))||1<=Math.round(g.getValue(d))?e.setValue(d,
1):e.setValue(d,0);e.setSliceCount(this.getMaxInputSliceCount())}}};VVVV.Nodes.Or.prototype=new VVVV.Core.Node;
VVVV.Nodes.Not=function(a,b){this.constructor(a,"NOT (Boolean)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};var h=this.addInputPin("Input",[1],this),g=this.addOutputPin("Output",[1],this);this.evaluate=function(){if(h.pinIsChanged()){for(var e=0;e<this.getMaxInputSliceCount();e++)g.setValue(e,1-Math.round(parseFloat(h.getValue(e))));g.setSliceCount(this.getMaxInputSliceCount())}}};VVVV.Nodes.Not.prototype=new VVVV.Core.Node;
VVVV.Nodes.OrSpectral=function(a,b){this.constructor(a,"OR (Boolean Spectral)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};var h=this.addInputPin("Input",[0],this),g=this.addInputPin("Bin Size",[-1],this),e=this.addOutputPin("Output",[0],this);this.evaluate=function(){for(var d=this.getMaxInputSliceCount(),c=0,k=0,a=!1,b=0;b<d||0<g.getValue(0)&&(0<k||0!=c%g.values.length);b++)0==k&&(a=!1),a=a||0.5<=h.getValue(b),k++,0<g.getValue(0)?
k>=g.getValue(c)&&(e.setValue(c,a?1:0),c++,k=0):e.setValue(0,a?1:0);e.setSliceCount(c+(0<k))}};VVVV.Nodes.OrSpectral.prototype=new VVVV.Core.Node;
VVVV.Nodes.AndSpectral=function(a,b){this.constructor(a,"AND (Boolean Spectral)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};var h=this.addInputPin("Input",[0],this),g=this.addInputPin("Bin Size",[-1],this),e=this.addOutputPin("Output",[0],this);this.evaluate=function(){for(var d=this.getMaxInputSliceCount(),c=0,k=0,a=!1,b=0;b<d||0<g.getValue(0)&&(0<k||0!=c%g.values.length);b++)0==k&&(a=!0),a=a&&0.5<=h.getValue(b),k++,0<g.getValue(0)?
k>=g.getValue(c)&&(e.setValue(c,a?1:0),c++,k=0):e.setValue(0,a?1:0);e.setSliceCount(c+(0<k))}};VVVV.Nodes.AndSpectral.prototype=new VVVV.Core.Node;VVVV.Types.CanvasTexture={imageObject:void 0,loaded:!1};
VVVV.Types.CanvasRenderState=function(){this.fillColor=[1,1,1,1];this.strokeColor=[0,0,0,0];this.lineWidth=1;this.capStyle="butt";this.joinStyle="miter";this.gradient={type:"none"};this.shadowBlur=this.shadowOffsetY=this.shadowOffsetX=0;this.shadowColor=[0,0,0,1];this.blendMode="source-over";this.copy_attributes=function(a){this.fillColor=a.fillColor;this.strokeColor=a.strokeColor;this.lineWidth=a.lineWidth;this.capStyle=a.capStyle;this.joinStyle=a.joinStyle;this.gradient=a.gradient;this.shadowOffsetX=
a.shadowOffsetX;this.shadowOffsetY=a.shadowOffsetY;this.shadowBlur=a.shadowBlur;this.shadowColor=a.shadowColor;this.blendMode=a.blendMode};this.apply=function(a){if("none"!=this.gradient.type){if("linear"==this.gradient.type)var b=a.createLinearGradient(this.gradient.startX,this.gradient.startY,this.gradient.endX,this.gradient.endY);for(var h=Math.max(this.gradient.colors.length,this.gradient.colorPositions.length),g=0;g<h;g++){var e=this.gradient.colors[g];b.addColorStop(this.gradient.colorPositions[g],
"rgba("+parseInt(255*e[0])+","+parseInt(255*e[1])+","+parseInt(255*e[2])+","+e[3]+")")}a.fillStyle=b}else a.fillStyle="rgba("+parseInt(255*this.fillColor[0])+","+parseInt(255*this.fillColor[1])+","+parseInt(255*this.fillColor[2])+","+this.fillColor[3]+")";a.strokeStyle="rgba("+parseInt(255*this.strokeColor[0])+","+parseInt(255*this.strokeColor[1])+","+parseInt(255*this.strokeColor[2])+","+this.strokeColor[3]+")";a.lineWidth=this.lineWidth/a.canvas.height;a.lineCap=this.capStyle;a.lineJoin=this.joinStyle;
a.shadowOffsetX=this.shadowOffsetX;a.shadowOffsetY=this.shadowOffsetY;a.shadowBlur=this.shadowBlur;a.shadowColor="rgba("+parseInt(255*this.shadowColor[0])+","+parseInt(255*this.shadowColor[1])+","+parseInt(255*this.shadowColor[2])+","+this.shadowColor[3]+")";a.globalCompositeOperation=this.blendMode}};var defaultRenderState=new VVVV.Types.CanvasRenderState,invisibleRenderState=new VVVV.Types.CanvasRenderState;invisibleRenderState.fillColor=[0,0,0,0];
VVVV.PinTypes.CanvasRenderState={typeName:"CanvasRenderState",reset_on_disconnect:!0,defaultValue:function(){return defaultRenderState}};var defaultCanvasLayer=function(){this.draw=function(){}};VVVV.PinTypes.CanvasLayer={typeName:"CanvasLayer",reset_on_disconnect:!0,defaultValue:defaultCanvasLayer};
VVVV.Nodes.FillCanvas=function(a,b){this.constructor(a,"Fill (Canvas VVVVjs RenderState)",b);this.meta={authors:["Matthias Zauner"],original_authors:[],credits:[],compatibility_issues:[]};var h=this.addInputPin("Render State In",[],this,!0,VVVV.PinTypes.CanvasRenderState),g=this.addInputPin("Color",["1.0, 1.0, 1.0, 1.0"],this,!0,VVVV.PinTypes.Color),e=this.addOutputPin("Render State Out",[],this,VVVV.PinTypes.CanvasRenderState),d=[];this.evaluate=function(){for(var c=this.getMaxInputSliceCount(),
k=0;k<c;k++)void 0==d[k]&&(d[k]=new VVVV.Types.CanvasRenderState),d[k].copy_attributes(h.getValue(k)),d[k].fillColor=g.getValue(k).split(","),e.setValue(k,d[k]);e.setSliceCount(c)}};VVVV.Nodes.FillCanvas.prototype=new VVVV.Core.Node;
VVVV.Nodes.StrokeCanvas=function(a,b){this.constructor(a,"Stroke (Canvas VVVVjs RenderState)",b);this.meta={authors:["Matthias Zauner"],original_authors:[],credits:[],compatibility_issues:[]};var h=this.addInputPin("Render State In",[],this,!0,VVVV.PinTypes.CanvasRenderState),g=this.addInputPin("Color",["1.0, 1.0, 1.0, 1.0"],this,!0,VVVV.PinTypes.Color),e=this.addInputPin("Width",[1],this),d=this.addInputPin("Cap Style",["butt"],this),c=this.addInputPin("Join Style",["miter"],this),k=this.addOutputPin("Render State Out",
[],this,VVVV.PinTypes.CanvasRenderState),p=[];this.evaluate=function(){for(var a=this.getMaxInputSliceCount(),b=0;b<a;b++)void 0==p[b]&&(p[b]=new VVVV.Types.CanvasRenderState),p[b].copy_attributes(h.getValue(b)),p[b].strokeColor=g.getValue(b).split(","),p[b].lineWidth=e.getValue(b),p[b].capStyle=d.getValue(b),p[b].joinStyle=c.getValue(b),k.setValue(b,p[b]);k.setSliceCount(a)}};VVVV.Nodes.StrokeCanvas.prototype=new VVVV.Core.Node;
VVVV.Nodes.ShadowCanvas=function(a,b){this.constructor(a,"Shadow (Canvas VVVVjs RenderState)",b);this.meta={authors:["Matthias Zauner"],original_authors:[],credits:[],compatibility_issues:[]};var h=this.addInputPin("Render State In",[],this,!0,VVVV.PinTypes.CanvasRenderState),g=this.addInputPin("Color",["0.0, 0.0, 0.0, 1.0"],this,!0,VVVV.PinTypes.Color),e=this.addInputPin("Offset X",[0],this),d=this.addInputPin("Offset Y",[0],this),c=this.addInputPin("Blur",[0],this),k=this.addOutputPin("Render State Out",
[],this,VVVV.PinTypes.CanvasRenderState),p=[];this.evaluate=function(){for(var a=this.getMaxInputSliceCount(),b=0;b<a;b++)void 0==p[b]&&(p[b]=new VVVV.Types.CanvasRenderState),p[b].copy_attributes(h.getValue(b)),p[b].shadowOffsetX=e.getValue(b),p[b].shadowOffsetY=d.getValue(b),p[b].shadowBlur=c.getValue(b),p[b].shadowColor=g.getValue(b).split(","),k.setValue(b,p[b]);k.setSliceCount(a)}};VVVV.Nodes.ShadowCanvas.prototype=new VVVV.Core.Node;
VVVV.Nodes.BlendCanvas=function(a,b){this.constructor(a,"Blend (Canvas VVVVjs RenderState)",b);this.meta={authors:["Matthias Zauner"],original_authors:[],credits:[],compatibility_issues:[]};var h=this.addInputPin("Render State In",[],this,!0,VVVV.PinTypes.CanvasRenderState),g=this.addInputPin("Mode",["source-over"],this),e=this.addOutputPin("Render State Out",[],this,VVVV.PinTypes.CanvasRenderState),d=[];this.evaluate=function(){for(var c=this.getMaxInputSliceCount(),k=0;k<c;k++)void 0==d[k]&&(d[k]=
new VVVV.Types.CanvasRenderState),d[k].copy_attributes(h.getValue(k)),d[k].blendMode=g.getValue(k),e.setValue(k,d[k]);e.setSliceCount(c)}};VVVV.Nodes.BlendCanvas.prototype=new VVVV.Core.Node;
VVVV.Nodes.LinearGradientCanvas=function(a,b){this.constructor(a,"LinearGradient (Canvas VVVVjs RenderState)",b);this.meta={authors:["Matthias Zauner"],original_authors:[],credits:[],compatibility_issues:[]};var h=this.addInputPin("Render State In",[],this,!0,VVVV.PinTypes.CanvasRenderState),g=this.addInputPin("Start X",[0],this),e=this.addInputPin("Start Y",[0],this),d=this.addInputPin("End X",[0],this),c=this.addInputPin("End Y",[0],this),k=this.addInputPin("Colors",["1.0, 1.0, 1.0, 1.0","0.0, 0.0, 0.0, 1.0"],
this),p=this.addInputPin("Color Positions",[0,1],this),m=this.addOutputPin("Render State Out",[],this,VVVV.PinTypes.CanvasRenderState),l=[];this.evaluate=function(){for(var a=Math.max(h.values.length,g.values.length),a=Math.max(a,e.values.length),a=Math.max(a,d.values.length),a=Math.max(a,c.values.length),b=0;b<a;b++){void 0==l[b]&&(l[b]=new VVVV.Types.CanvasRenderState);l[b].copy_attributes(h.getValue(b));l[b].gradient={type:"linear"};l[b].gradient.startX=g.getValue(b);l[b].gradient.startY=e.getValue(b);
l[b].gradient.endX=d.getValue(b);l[b].gradient.endY=c.getValue(b);l[b].gradient.colors=[];l[b].gradient.colorPositions=[];for(var n=Math.max(k.values.length,p.values.length),t=0;t<n;t++)l[b].gradient.colors.push(k.getValue(t).split(",")),l[b].gradient.colorPositions.push(p.getValue(t));m.setValue(b,l[b])}m.setSliceCount(a)}};VVVV.Nodes.LinearGradientCanvas.prototype=new VVVV.Core.Node;
VVVV.Nodes.ArcCanvas=function(a,b){this.constructor(a,"Arc (Canvas VVVVjs)",b);this.meta={authors:["Matthias Zauner"],original_authors:[],credits:[],compatibility_issues:[]};var h=this.addInputPin("Render State",[],this,!0,VVVV.PinTypes.CanvasRenderState),g=this.addInputPin("Transform",[],this,!0,VVVV.PinTypes.Transform),e=this.addInputPin("Clipping Layer",[],this,!0,VVVV.PinTypes.CanvasLayer),d=this.addInputPin("Radius",[1],this),c=this.addInputPin("Start Angle",[0],this),k=this.addInputPin("End Angle",
[0.5],this),p=this.addInputPin("Draw Segment",[0],this),m=this.addOutputPin("Layer",[],this,VVVV.PinTypes.CanvasLayer),l=[],s=function(){this.transform=mat4.create();mat4.identity(this.transform);this.startAngle=0;this.endAngle=0.5;this.strokeColor=[1,1,1,1];this.lineWidth=1;this.renderState=defaultRenderState;this.clippingLayer=void 0;this.drawSegment=!1;this.draw=function(c,d){c.save();this.clippingLayer&&(this.clippingLayer.draw(c,!0),c.clip());c.save();this.transform&&c.transform(this.transform[0],
this.transform[1],this.transform[4],this.transform[5],this.transform[12],this.transform[13]);c.beginPath();d?invisibleRenderState.apply(c):this.renderState.apply(c);this.drawSegment&&(c.moveTo(0,0),c.lineTo(Math.cos(this.startAngle)*this.radius,Math.sin(this.startAngle)*this.radius));c.arc(0,0,this.radius,this.startAngle,this.endAngle,!1);this.drawSegment&&(c.moveTo(Math.cos(this.endAngle)*this.radius,Math.sin(this.endAngle)*this.radius),c.lineTo(0,0));0<this.renderState.fillColor[3]&&c.fill();0<
this.renderState.strokeColor[3]&&c.stroke();c.restore();c.restore()}};this.evaluate=function(){for(var b=this.getMaxInputSliceCount(),a=0;a<b;a++)void 0==l[a]&&(l[a]=new s),l[a].transform=g.getValue(a),l[a].radius=parseFloat(d.getValue(a)),l[a].startAngle=2*parseFloat(c.getValue(a))*Math.PI,l[a].endAngle=2*parseFloat(k.getValue(a))*Math.PI,l[a].renderState=h.getValue(a),l[a].drawSegment=1==p.getValue(a),e.isConnected()&&(l[a].clippingLayer=e.getValue(a));for(a=0;a<l.length;a++)m.setValue(a,l[a]);
m.setSliceCount(b)}};VVVV.Nodes.ArcCanvas.prototype=new VVVV.Core.Node;
VVVV.Nodes.RectangleCanvas=function(a,b){this.constructor(a,"Rectangle (Canvas VVVVjs)",b);this.meta={authors:["Matthias Zauner"],original_authors:[],credits:[],compatibility_issues:[]};var h=this.addInputPin("Render State",[],this,!0,VVVV.PinTypes.CanvasRenderState),g=this.addInputPin("Transform",[],this,!0,VVVV.PinTypes.Transform),e=this.addInputPin("Clipping Layer",[],this,!0,VVVV.PinTypes.CanvasLayer),d=this.addInputPin("Width",[1],this),c=this.addInputPin("Height",[1],this),k=this.addInputPin("Corner Radius",
[0],this),p=this.addOutputPin("Layer",[],this,VVVV.PinTypes.CanvasLayer),m=[],l=function(){this.transform=mat4.create();mat4.identity(this.transform);this.renderState=defaultRenderState;this.clippingLayer=void 0;this.draw=function(c,d){c.save();this.clippingLayer&&(this.clippingLayer.draw(c,!0),c.clip());c.save();this.transform&&c.transform(this.transform[0],this.transform[1],this.transform[4],this.transform[5],this.transform[12],this.transform[13]);c.beginPath();d?invisibleRenderState.apply(c):this.renderState.apply(c);
var e=this.width/2,k=e-this.cornerRadius,g=this.height/2,a=g-this.cornerRadius,b=-e,h=-k,l=-g,p=-a;c.moveTo(h,l);c.lineTo(k,l);c.arc(k,p,this.cornerRadius,1.5*Math.PI,0,!1);c.lineTo(e,a);c.arc(k,a,this.cornerRadius,0,0.5*Math.PI,!1);c.lineTo(h,g);c.arc(h,a,this.cornerRadius,0.5*Math.PI,Math.PI,!1);c.lineTo(b,p);c.arc(h,p,this.cornerRadius,Math.PI,1.5*Math.PI,!1);c.closePath();0<this.renderState.fillColor[3]&&c.fill();0<this.renderState.strokeColor[3]&&c.stroke();c.restore();c.restore()}};this.evaluate=
function(){for(var a=this.getMaxInputSliceCount(),b=0;b<a;b++)void 0==m[b]&&(m[b]=new l),m[b].transform=g.getValue(b),m[b].width=d.getValue(b),m[b].height=c.getValue(b),m[b].cornerRadius=k.getValue(b),m[b].renderState=h.getValue(b),e.isConnected()&&(m[b].clippingLayer=e.getValue(b));for(b=0;b<m.length;b++)p.setValue(b,m[b]);p.setSliceCount(a)}};VVVV.Nodes.RectangleCanvas.prototype=new VVVV.Core.Node;
VVVV.Nodes.TextCanvas=function(a,b){this.constructor(a,"Text (Canvas VVVVjs)",b);this.meta={authors:["Matthias Zauner"],original_authors:[],credits:[],compatibility_issues:[]};var h=this.addInputPin("Render State",[],this,!0,VVVV.PinTypes.CanvasRenderState),g=this.addInputPin("Transform",[],this,!0,VVVV.PinTypes.Transform),e=this.addInputPin("Clipping Layer",[],this,!0,VVVV.PinTypes.CanvasLayer),d=this.addInputPin("Text",["VVVV.js"],this),c=this.addInputPin("Font",["10px sans-serif"],this),k=this.addInputPin("Align",
["start"],this),p=this.addInputPin("Baseline",["alphabetic"],this),m=this.addOutputPin("Layer",[],this,VVVV.PinTypes.CanvasLayer),l=[],s=function(){this.transform=mat4.create();mat4.identity(this.transform);this.text="VVVV.js";this.font="sans-serif";this.align="start";this.baseline="top";this.renderState=defaultRenderState;this.clippingLayer=void 0;this.draw=function(c,d){c.save();this.clippingLayer&&(this.clippingLayer.draw(c,!0),c.clip());c.save();this.transform&&c.transform(this.transform[0],this.transform[1],
this.transform[4],this.transform[5],this.transform[12],this.transform[13]);c.scale(0.01,-0.01);c.font="100px "+this.font;c.textAlign=this.align;c.textBaseline=this.baseline;d?invisibleRenderState.apply(c):this.renderState.apply(c);0<this.renderState.fillColor[3]&&c.fillText(this.text,0,0);0<this.renderState.strokeColor[3]&&c.strokeText(this.text,0,0);c.restore();c.restore()}};this.evaluate=function(){for(var b=this.getMaxInputSliceCount(),a=0;a<b;a++)void 0==l[a]&&(l[a]=new s),l[a].transform=g.getValue(a),
l[a].text=d.getValue(a),l[a].font=c.getValue(a),l[a].align=k.getValue(a),l[a].baseline=p.getValue(a),l[a].renderState=h.getValue(a),l[a].clippingLayer=e.getValue(a);for(a=0;a<l.length;a++)m.setValue(a,l[a]);m.setSliceCount(b)}};VVVV.Nodes.TextCanvas.prototype=new VVVV.Core.Node;
VVVV.Nodes.BezierCurveCanvas=function(a,b){function h(c,d){c.x.splice(d);c.y.splice(d);c.c1x.splice(d);c.c1y.splice(d);c.c2x.splice(d);c.c2y.splice(d)}this.constructor(a,"BezierCurve (Canvas VVVVjs)",b);this.meta={authors:["Matthias Zauner"],original_authors:[],credits:[],compatibility_issues:[]};var g=this.addInputPin("Render State",[],this,!0,VVVV.PinTypes.CanvasRenderState),e=this.addInputPin("Transform",[],this,!0,VVVV.PinTypes.Transform),d=this.addInputPin("Clipping Layer",[],this,!0,VVVV.PinTypes.CanvasLayer),
c=this.addInputPin("X",[0],this),k=this.addInputPin("Y",[0],this),p=this.addInputPin("Control 1 X",[0],this),m=this.addInputPin("Control 1 Y",[0],this),l=this.addInputPin("Control 2 X",[0],this),s=this.addInputPin("Control 2 Y",[0],this),q=this.addInputPin("BinSize",[-1],this),n=this.addOutputPin("Layer",[],this,VVVV.PinTypes.CanvasLayer),t=[],v=function(){this.transform=mat4.create();mat4.identity(this.transform);this.x=[];this.y=[];this.c1x=[];this.c1y=[];this.c2x=[];this.c2y=[];this.strokeColor=
[1,1,1,1];this.lineWidth=1;this.fillColor=[1,1,1,1];this.renderState=defaultRenderState;this.clippingLayer=void 0;this.draw=function(c,d){if(!(1>this.x.length)){c.save();this.clippingLayer&&(this.clippingLayer.draw(c,!0),c.clip());d?invisibleRenderState.apply(c):this.renderState.apply(c);c.save();this.transform&&c.transform(this.transform[0],this.transform[1],this.transform[4],this.transform[5],this.transform[12],this.transform[13]);c.beginPath();c.moveTo(this.x[0],this.y[0]);for(var e=1;e<this.x.length;e++)c.bezierCurveTo(this.c1x[e-
1]+this.x[e-1],this.c1y[e-1]+this.y[e-1],this.c2x[e]+this.x[e],this.c2y[e]+this.y[e],this.x[e],this.y[e]);0<this.renderState.fillColor[3]&&c.fill();0<this.renderState.strokeColor[3]&&c.stroke();c.restore();c.restore()}}};this.evaluate=function(){for(var a=this.getMaxInputSliceCount(),b=0,r=0,u=0;u<a||0<q.getValue(0)&&(0<r||0<b%e.getSliceCount());u++)void 0==t[b]&&(t[b]=new v),0==r&&(t[b].renderState=g.getValue(b),t[b].transform=e.getValue(b),d.isConnected()&&(t[b].clippingLayer=d.getValue(b))),t[b].x[r]=
parseFloat(c.getValue(u)),t[b].y[r]=parseFloat(k.getValue(u)),t[b].c1x[r]=parseFloat(p.getValue(u)),t[b].c1y[r]=parseFloat(m.getValue(u)),t[b].c2x[r]=parseFloat(l.getValue(u)),t[b].c2y[r]=parseFloat(s.getValue(u)),r++,0<q.getValue(0)&&r>=q.getValue(b)&&(r<t[b].x.length&&h(t[b],r),b++,r=0);0>q.getValue(0)&&r<t[b].x.length?(h(t[b],r),t.splice(1)):t.splice(b);for(a=0;a<t.length;a++)n.setValue(a,t[a]);n.setSliceCount(t.length)}};VVVV.Nodes.BezierCurveCanvas.prototype=new VVVV.Core.Node;
VVVV.Nodes.QuadCanvas=function(a,b){this.constructor(a,"Quad (Canvas VVVVjs)",b);this.meta={authors:["Matthias Zauner"],original_authors:[],credits:[],compatibility_issues:[]};var h=this.addInputPin("Transform",[],this,!0,VVVV.PinTypes.Transform),g=this.addInputPin("Clipping Layer",[],this,!0,VVVV.PinTypes.CanvasLayer),e=this.addInputPin("Texture",[],this,!0,VVVV.PinTypes.HTML5Texture),d=this.addInputPin("Color",["1.0, 1.0, 1.0, 1.0"],this,!0,VVVV.PinTypes.Color),c=this.addOutputPin("Layer",[],this,
VVVV.PinTypes.CanvasLayer),k=[],p=function(){this.transform=mat4.create();this.clippingLayer=void 0;mat4.identity(this.transform);this.texture=VVVV.PinTypes.HTML5Texture.defaultValue();this.color=[1,1,1,1];this.draw=function(c,d){c.save();this.clippingLayer&&(this.clippingLayer.draw(c,!0),c.clip());c.save();this.transform&&c.transform(this.transform[0],this.transform[1],this.transform[4],this.transform[5],this.transform[12],this.transform[13]);"Empty Texture"!=this.texture?this.texture.loaded&&(c.globalAlpha=
this.color[3],c.save(),c.translate(-0.5,0.5),this.texture.videoWidth?c.scale(1/this.texture.videoWidth,-1/this.texture.videoHeight):c.scale(1/this.texture.width,-1/this.texture.height),c.drawImage(this.texture,0,0),c.restore(),c.fillStyle="rgba(0, 0, 0, .001)",c.fillRect(-0.5,-0.5,1,1),c.globalAlpha=1):(c.fillStyle="rgba("+parseInt(255*this.color[0])+", "+parseInt(255*this.color[1])+", "+parseInt(255*this.color[2])+", "+this.color[3]+")",c.fillRect(-0.5,-0.5,1,1));c.restore();c.restore()}};this.evaluate=
function(){for(var a=this.getMaxInputSliceCount(),b=0;b<a;b++)void 0==k[b]&&(k[b]=new p),k[b].transform=h.getValue(b),k[b].texture=e.getValue(b),k[b].color=d.getValue(b).split(","),g.isConnected()&&(k[b].clippingLayer=g.getValue(b));for(b=0;b<k.length;b++)c.setValue(b,k[b]);c.setSliceCount(a)}};VVVV.Nodes.QuadCanvas.prototype=new VVVV.Core.Node;
VVVV.Nodes.GroupCanvas=function(a,b){this.constructor(a,"Group (Canvas VVVVjs)",b);this.meta={authors:["Matthias Zauner"],original_authors:[],credits:[],compatibility_issues:[]};var h=[],g=this.addOutputPin("Layer",[],this,VVVV.PinTypes.CanvasLayer);this.initialize=function(){for(var e=0;2>e;e++)h[e]=this.addInputPin("Layer "+(e+1),[],this,!0,VVVV.PinTypes.CanvasLayer)};this.evaluate=function(){for(var e=0,d=0;2>d;d++)if(h[d].isConnected())for(var c=0;c<h[d].values.length;c++)g.setValue(e++,h[d].getValue(c));
g.setSliceCount(e)}};VVVV.Nodes.GroupCanvas.prototype=new VVVV.Core.Node;
VVVV.Nodes.RendererCanvas=function(a,b){function h(c){$(c).detach("mousemove");$(c).detach("mousedown");$(c).detach("mouseup");VVVV.MousePositions[c.id]={x:0,y:0,wheel:0,lb:0,mb:0,rb:0};$(c).mousemove(function(d){var e=2*(d.pageX-$(this).offset().left)/$(this).width()-1;d=-(2*(d.pageY-$(this).offset().top)/$(this).height()-1);VVVV.MousePositions._all.x=e;VVVV.MousePositions._all.y=d;VVVV.MousePositions[c.id].x=e;VVVV.MousePositions[c.id].y=d});$(c).bind("mousewheel",function(d){d=d.originalEvent.wheelDelta/
120;VVVV.MousePositions[c.id].wheel+=d;VVVV.MousePositions._all.wheel+=d});$(c).bind("DOMMouseScroll",function(d){d=-d.originalEvent.detail/3;VVVV.MousePositions[c.id].wheel+=d;VVVV.MousePositions._all.wheel+=d});$(c).mousedown(function(d){switch(d.which){case 1:VVVV.MousePositions._all.lb=1;VVVV.MousePositions[c.id].lb=1;break;case 2:VVVV.MousePositions._all.mb=1;VVVV.MousePositions[c.id].mb=1;break;case 3:VVVV.MousePositions._all.rb=1,VVVV.MousePositions[c.id].rb=1}});$(c).mouseup(function(d){switch(d.which){case 1:VVVV.MousePositions._all.lb=
0;VVVV.MousePositions[c.id].lb=0;break;case 2:VVVV.MousePositions._all.mb=0;VVVV.MousePositions[c.id].mb=0;break;case 3:VVVV.MousePositions._all.rb=0,VVVV.MousePositions[c.id].rb=0}})}this.constructor(a,"Renderer (Canvas VVVVjs)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};var g=this.addInputPin("Layers",[],this,!0,VVVV.PinTypes.CanvasLayer);this.addInputPin("Clear",[1],this);var e=this.addInputPin("Background Color",["0.0, 0.0, 0.0, 1.0"],
this,!0,VVVV.PinTypes.Color),d=this.addInputPin("Backbuffer Width",[0],this),c=this.addInputPin("Backbuffer Height",[0],this),k=this.addInputPin("View",[],this,!0,VVVV.PinTypes.Transform),p=this.addOutputPin("Canvas Out",[],this),m,l,s,q=[0,0,0,1],n;this.getContext=function(){var e=this.invisiblePins["Descriptive Name"].getValue(0);if((e=$(e).get(0))&&"CANVAS"==e.nodeName)n=e;else{var k=parseInt(d.getValue(0)),b=parseInt(c.getValue(0));n=$('<canvas width="'+(0<k?k:512)+'" height="'+(0<b?b:512)+'" id="vvvv-js-generated-renderer-'+
(new Date).getTime()+'" class="vvvv-js-generated-renderer"></canvas>');e||(e="body");$(e).append(n);n=n.get(0)}l=n.width;s=n.height;n&&n.getContext&&(h(n),m=n.getContext("2d"),n.ctx=m)};this.evaluate=function(){this.invisiblePins["Descriptive Name"].pinIsChanged()&&($(n).hasClass("vvvv-js-generated-renderer")&&$(n).remove(),this.getContext());if(m){if(d.pinIsChanged()){var b=parseInt(d.getValue(0));0<b&&(l=b,$(n).attr("width",l))}c.pinIsChanged()&&(b=parseInt(c.getValue(0)),0<b&&(s=b,$(n).attr("height",
s)));e.pinIsChanged()&&(q=e.getValue(0).split(","),q[0]=parseInt(255*q[0]),q[1]=parseInt(255*q[1]),q[2]=parseInt(255*q[2]));defaultRenderState.apply(m);m.clearRect(0,0,l,s);m.save();m.translate(l/2,s/2);m.scale(l/2,-s/2);k.isConnected()&&(b=k.getValue(0),m.transform(b[0],b[1],b[4],b[5],b[12],b[13]));if(g.isConnected())for(b=0;b<g.values.length;b++)g.getValue(b).draw(m);m.restore();defaultRenderState.apply(m);m.globalCompositeOperation="destination-over";m.fillStyle="rgba("+q[0]+","+q[1]+","+q[2]+
","+q[3]+")";m.fillRect(0,0,l,s);p.setValue(0,n);n.loaded=!0}}};VVVV.Nodes.RendererCanvas.prototype=new VVVV.Core.Node;VVVV.PinTypes.Color={typeName:"Color",reset_on_disconnect:!1,defaultValue:function(){return"1.0, 1.0, 1.0, 1.0"},hsvToRgb:function(a,b,h){a*=360;var g=Math.floor(a/60),e=a/60-g;a=h*(1-b);var d=h*(1-b*e);b=h*(1-b*(1-e));switch(g){case 1:return[d,h,a];case 2:return[a,h,b];case 3:return[a,d,h];case 4:return[b,a,h];case 5:return[h,a,d];default:return[h,b,a]}},rgbToHsv:function(a,b,h){var g=Math.max(a,Math.max(b,h)),e=Math.min(a,Math.min(b,h)),d;g==e?d=0:g==a?d=60*(0+(b-h)/(g-e)):g==b?d=60*(2+(h-a)/(g-
e)):g==h&&(d=60*(4+(a-b)/(g-e)));0>d&&(d+=360);a=0;0!=g&&(a=(g-e)/g);return[d/360,a,g]}};
VVVV.Nodes.RGBJoin=function(a,b){this.constructor(a,"RGB (Color Join)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};var h=this.addInputPin("Red",[1],this),g=this.addInputPin("Green",[1],this),e=this.addInputPin("Blue",[1],this),d=this.addInputPin("Alpha",[1],this),c=this.addOutputPin("Output",["1.0,1.0,1.0,1.0"],this,VVVV.PinTypes.Color);this.evaluate=function(){if(h.pinIsChanged()||g.pinIsChanged||e.pinIsChanged()||d.pinIsChanged()){for(var b=
this.getMaxInputSliceCount(),a=0;a<b;a++){var m=h.getValue(a)||0,l=g.getValue(a)||0,s=e.getValue(a)||0,q=d.getValue(a)||0;c.setValue(a,m+","+l+","+s+","+q)}c.setSliceCount(b)}}};VVVV.Nodes.RGBJoin.prototype=new VVVV.Core.Node;
VVVV.Nodes.HSVJoin=function(a,b){this.constructor(a,"HSV (Color Join)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};var h=this.addInputPin("Hue",[0.33],this),g=this.addInputPin("Saturation",[0],this),e=this.addInputPin("Value",[1],this),d=this.addInputPin("Alpha",[1],this),c=this.addOutputPin("Output",["1.0,1.0,1.0,1.0"],this,VVVV.PinTypes.Color);this.evaluate=function(){for(var b=this.getMaxInputSliceCount(),a=0;a<b;a++){var m=h.getValue(a),
l=g.getValue(a),s=e.getValue(a),q=d.getValue(a),m=VVVV.PinTypes.Color.hsvToRgb(m,l,s);c.setValue(a,m[0]+","+m[1]+","+m[2]+","+q)}c.setSliceCount(b)}};VVVV.Nodes.HSVJoin.prototype=new VVVV.Core.Node;
VVVV.Nodes.IOBoxColor=function(a,b){this.constructor(a,"IOBox (Color)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};this.auto_evaluate=!1;var h=this.addInputPin("Color Input",["0.0, 1.0, 0.0, 1.0"],this,!1,VVVV.PinTypes.Color),g=this.addOutputPin("Color Output",["0.0, 1.0, 0.0, 1.0"],this,VVVV.PinTypes.Color);this.addInvisiblePin("Rows",[1],this);this.evaluate=function(){for(var e=this.getMaxInputSliceCount(),d=0;d<e;d++)g.setValue(d,
h.getValue(d));g.setSliceCount(e)}};VVVV.Nodes.IOBoxColor.prototype=new VVVV.Core.Node;
VVVV.Nodes.SetAlphaColor=function(a,b){this.constructor(a,"SetAlpha (Color)",b);this.meta={authors:["Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};this.auto_evaluate=!1;var h=this.addInputPin("Input",["0.0, 0.0, 0.0, 0.0"],this,!1,VVVV.PinTypes.Color),g=this.addInputPin("Alpha",[1],this),e=this.addOutputPin("Output",["0.0, 0.0, 0.0, 1.0"],this,VVVV.PinTypes.Color);this.evaluate=function(){for(var d=this.getMaxInputSliceCount(),c=0;c<d;c++){var b=h.getValue(c),a=g.getValue(c);
e.setValue(c,b.replace(/[^, ]+$/,a))}e.setSliceCount(d)}};VVVV.Nodes.SetAlphaColor.prototype=new VVVV.Core.Node;
VVVV.Nodes.SwitchColorInput=function(a,b){this.constructor(a,"Switch (Color Input)",b);this.meta={authors:["Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};this.auto_evaluate=!1;var h=this.addInputPin("Switch",[0],this),g=[];g[0]=this.addInputPin("Input 1",["1.0, 1.0, 1.0, 1.0"],this,!1,VVVV.PinTypes.Color);g[1]=this.addInputPin("Input 2",["1.0, 1.0, 1.0, 1.0"],this,!1,VVVV.PinTypes.Color);var e=this.addOutputPin("Output",["1.0, 1.0, 1.0, 1.0"],this,VVVV.PinTypes.Color);
this.addInvisiblePin("Input Count",[2],this);this.evaluate=function(){var d=this.getMaxInputSliceCount();if(this.hasNilInputs())e.setSliceCount(0);else{for(var c=0;c<d;c++)e.setValue(c,g[Math.round(Math.abs(h.getValue(c)))%g.length].getValue(c));e.setSliceCount(d)}}};VVVV.Nodes.SwitchColorInput.prototype=new VVVV.Core.Node;VVVV.Nodes.Abs=function(a,b){this.constructor(a,"Abs (Complex)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};var h=this.addInputPin("Input Real",[0],this),g=this.addInputPin("Input Imagiary",[0],this),e=this.addOutputPin("Output",[0.5],this);this.evaluate=function(){for(var d=this.getMaxInputSliceCount(),c=0;c<d;c++)e.setValue(c,Math.sqrt(Math.pow(parseFloat(h.getValue(c)),2)+Math.pow(parseFloat(g.getValue(c)),2)));e.setSliceCount(d)}};
VVVV.Nodes.Abs.prototype=new VVVV.Core.Node;VVVV.Nodes.String2Enum=function(a,b){this.constructor(a,"String2Enum (Enumerations)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:["Validation check does not work"]};var h=this.addInputPin("String Value",[],this),g=this.addOutputPin("Enum",[],this);this.evaluate=function(){for(var e=this.getMaxInputSliceCount(),d=0;d<e;d++)g.setValue(d,h.getValue(d));g.setSliceCount(e)}};VVVV.Nodes.String2Enum.prototype=new VVVV.Core.Node;VVVV.PinTypes.HTML5Texture={typeName:"HTML5Texture",reset_on_disconnect:!0,defaultValue:function(){return"Empty Texture"}};
VVVV.Nodes.FileTextureCanvas=function(a,b){this.constructor(a,"FileTexture (HTML5 VVVVjs)",b);this.meta={authors:["Matthias Zauner"],original_authors:[],credits:[],compatibility_issues:[]};this.auto_evaluate=!0;var h=this.addInputPin("Filename",[],this),g=this.addOutputPin("Texture Out",[],this,VVVV.PinTypes.HTML5Texture),e=this.addOutputPin("Width",[0],this),d=this.addOutputPin("Height",[0],this),c=this.addOutputPin("Up and Running",[0],this),k=[],p=!1;this.evaluate=function(){var b=this.getMaxInputSliceCount();
if(h.pinIsChanged()){for(var a=0;a<b;a++)if(void 0==k[a]||k[a].origSrc!=h.getValue(a))k[a]=new Image,k[a].loaded=!1,k[a].origSrc=h.getValue(a),k[a].onload=function(c){return function(){p=k[c].loaded=!0}}(a),k[a].src=h.getValue(a),c.setValue(a,0),g.setValue(a,k[a]);k.length=b;g.setSliceCount(b);e.setSliceCount(b);d.setSliceCount(b);c.setSliceCount(b)}if(p){for(a=0;a<b;a++)g.setValue(a,k[a]),e.setValue(a,k[a].width),d.setValue(a,k[a].height),c.setValue(a,k[a].loaded?1:0);p=!1}}};
VVVV.Nodes.FileTextureCanvas.prototype=new VVVV.Core.Node;
VVVV.Nodes.FileStreamCanvas=function(a,b){this.constructor(a,"FileStream (HTML5 VVVVjs)",b);this.meta={authors:["Matthias Zauner"],original_authors:[],credits:[],compatibility_issues:[]};this.auto_evaluate=!0;var h=["NETWORK_EMPTY","NETWORK_IDLE","NETWORK_LOADING","NETWORK_NO_SOURCE"],g=["HAVE_NOTHING","HAVE_METADATA","HAVE_FUTURE_DATA","HAVE_ENOUGH_DATA","HAVE_CURRENT_DATA"],e=this.addInputPin("Play",[1],this),d=this.addInputPin("Loop",[0],this),c=this.addInputPin("Start Time",[0],this),k=this.addInputPin("End Time",
[-1],this),p=this.addInputPin("Do Seek",[0],this),m=this.addInputPin("Seek Position",[0],this),l=this.addInputPin("Filename",["http://html5doctor.com/demos/video-canvas-magic/video.ogg"],this),s=this.addOutputPin("Video",[],this),q=this.addOutputPin("Audio",[],this),n=this.addOutputPin("Duration",[0],this),t=this.addOutputPin("Position",[0],this),v=this.addOutputPin("Video Width",[0],this),w=this.addOutputPin("Video Height",[0],this),y=this.addOutputPin("Network Status",[""],this),r=this.addOutputPin("Ready Status",
[""],this),u=[];this.evaluate=function(){var b=this.getMaxInputSliceCount();if(l.pinIsChanged())for(var a=0;a<b;a++){if(void 0==u[a]){var A=$('<video style="display:none"><source src="" type=video/ogg></video>');$("body").append(A);u[a]=A[0];u[a].volume=0;A=function(c){return function(){}}(a);u[a].onprogress=A;u[a].oncanplay=A;u[a].oncanplaythrough=A}l.getValue(a)!=u[a].currentSrc&&($(u[a]).find("source").first().attr("src",l.getValue(a)),u[a].load(),0.5<e.getValue(a)?u[a].play():u[a].pause(),u[a].loaded=
!0,s.setValue(a,u[a]),q.setValue(a,u[a]))}if(e.pinIsChanged())for(a=0;a<b;a++)0.5<e.getValue(a)?u[a].play():u[a].pause();if(p.pinIsChanged())for(a=0;a<b;a++)u[a%u.length].loaded&&0.5<=p.getValue(a)&&(u[a%u.length].currentTime=parseFloat(m.getValue(a)),0.5<e.getValue(a)&&u[a].play());for(a=0;a<b;a++){if(!u[a].paused){s.setValue(a,u[a]);q.setValue(a,u[a]);n.getValue(a)!=u[a].duration&&n.setValue(a,u[a].duration);t.setValue(a,u[a].currentTime);var A=parseFloat(k.getValue(a)),G=parseFloat(c.getValue(a));
u[a].currentTime<G&&(u[a].currentTime=G);if(u[a].currentTime>=u[a].duration||0<=A&&u[a].currentTime>=A)0.5<=d.getValue(a)?u[a].currentTime=G:u[a].pause()}if(u[a].videoWidth!=v.getValue(a)||u[a].videoHeight!=w.getValue(a))v.setValue(a,u[a].videoWidth),w.setValue(a,u[a].videoHeight);y.getValue(a)!=h[u[a].networkState]&&y.setValue(a,h[u[a].networkState]);r.getValue(a)!=g[u[a].readyState]&&r.setValue(a,g[u[a].readyState])}s.setSliceCount(b);q.setSliceCount(b)}};VVVV.Nodes.FileStreamCanvas.prototype=new VVVV.Core.Node;
VVVV.Nodes.AudioOutHTML5=function(a,b){this.constructor(a,"AudioOut (HTML5 VVVVjs)",b);this.meta={authors:["Matthias Zauner"],original_authors:[],credits:[],compatibility_issues:[]};var h=this.addInputPin("Audio",[],this),g=this.addInputPin("Volume",[0.5],this);this.evaluate=function(){var e=this.getMaxInputSliceCount();if(g.pinIsChanged())for(var d=0;d<e;d++)h.getValue(d).volume=Math.max(0,Math.min(1,parseFloat(g.getValue(d))))}};VVVV.Nodes.AudioOutHTML5.prototype=new VVVV.Core.Node;VVVV.Nodes.HTTPGet=function(a,b){this.constructor(a,"HTTP (Network Get)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:["Doesnt handle get variables yet","Doesnt support proxies","No header output pin yet"]};this.auto_evaluate=!0;var h=this.addInputPin("URL",["http://localhost"],this),g=this.addInputPin("Name",[""],this),e=this.addInputPin("Value",[""],this),d=this.addInputPin("Refresh",[0],this),c=this.addOutputPin("Status",[""],this),k=
this.addOutputPin("Body",[""],this),p=this.addOutputPin("Fail",[0],this),m=this.addOutputPin("Success",[0],this),l,s,q,n=!1;this.evaluate=function(){this.getMaxInputSliceCount();var a=h.pinIsChanged()||g.pinIsChanged()||e.pinIsChanged()||d.pinIsChanged()&&1==d.getValue(0);1==m.getValue(0)&&m.setValue(0,0);1==p.getValue(0)&&p.setValue(0,0);n&&(k.setValue(0,l),c.setValue(0,void 0),m.setValue(0,s),p.setValue(0,q),n=!1);a&&(void 0==h.getValue(0)?(k.setValue(0,""),c.setValue(0,"")):$.ajax({url:h.getValue(0),
type:"get",success:function(c,d,e){l=c;s=1;n=!0},error:function(c,d){l="";q=1;n=!0}}))}};VVVV.Nodes.HTTPGet.prototype=new VVVV.Core.Node;VVVV.PinTypes.Node={typeName:"Node"};
VVVV.Nodes.IOBoxNode=function(a,b){this.constructor(a,"IOBox (Node)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};this.auto_evaluate=!1;var h=this.addInputPin("Input Node",[],this,!0,VVVV.PinTypes.Node),g=this.addOutputPin("Output Node",[],this,VVVV.PinTypes.Node);this.initialize=function(){h.connectionChangedHandlers.nodepin=function(){if(this.isConnected()){var e;0<this.links.length?e=this.links[0].fromPin:this.masterPin&&(e=this.masterPin);
this.setType(VVVV.PinTypes[e.typeName]);g.setType(VVVV.PinTypes[e.typeName]);g.slavePin&&g.slavePin.setType(VVVV.PinTypes[e.typeName])}else g.isConnected()||(this.setType(VVVV.PinTypes.Node),g.setType(VVVV.PinTypes.Node),g.slavePin&&g.slavePin.setType(VVVV.PinTypes.Node))};g.connectionChangedHandlers.nodepin=function(){if(this.isConnected()){var e;0<this.links.length?e=this.links[0].toPin:this.slavePin&&(e=this.slavePin);this.setType(VVVV.PinTypes[e.typeName]);h.setType(VVVV.PinTypes[e.typeName]);
h.masterPin&&h.masterPin.setType(VVVV.PinTypes[e.typeName])}else h.isConnected()||(this.setType(VVVV.PinTypes.Node),h.setType(VVVV.PinTypes.Node),h.masterPin&&h.masterPin.setType(VVVV.PinTypes.Node))}};this.evaluate=function(){for(var e=this.getMaxInputSliceCount(),d=0;d<e;d++)g.setValue(d,h.getValue(d));g.setSliceCount(e)}};VVVV.Nodes.IOBoxNode.prototype=new VVVV.Core.Node;
VVVV.Nodes.SwitchNodeInput=function(a,b){this.constructor(a,"Switch (Node Input)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:["No dynamic pin count yet"]};var h=this.addInputPin("Switch",[0],this),g=this.addInvisiblePin("Input Count",[2],this),e=[],d=this.addOutputPin("Output",[0],this);this.initialize=function(){for(var c=g.getValue(0),d=e.length;d<c;d++)e[d]=this.addInputPin("Input "+(d+1),[],this,!0,VVVV.PinTypes.Node);e.length=c};
this.evaluate=function(){g.pinIsChanged()&&this.initialize();if(void 0==h.getValue(0))d.setValue(0,void 0);else{for(var c=e[Math.round(Math.abs(h.getValue(0)))%e.length],a=c.getSliceCount(),b=0;b<a;b++)d.setValue(b,c.getValue(b));d.setSliceCount(a)}}};VVVV.Nodes.SwitchNodeInput.prototype=new VVVV.Core.Node;VVVV.Nodes.BoundsSpectral=function(a,b){this.constructor(a,"Bounds (Spectral)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};this.auto_evaluate=!1;var h=this.addInputPin("Input",[0],this),g=this.addInputPin("Bin Size",[-1],this),e=this.addOutputPin("Center",[0],this),d=this.addOutputPin("Width",[0],this),c=this.addOutputPin("Minimum",[0],this),k=this.addOutputPin("Maximum",[0],this);this.evaluate=function(){for(var a=this.getMaxInputSliceCount(),
b=0,l=0,s,q,n,t=0;t<a||0<g.getValue(0)&&(0<l||0!=b%g.values.length);t++)s=h.getValue(t),0==l&&(center=q=n=s,width=0),q=Math.min(s,q),n=Math.max(s,n),l++,0<g.getValue(0)&&l>=g.getValue(b)&&(c.setValue(b,q),k.setValue(b,n),e.setValue(b,q+(n-q)/2),d.setValue(b,Math.abs(n-q)),b++,l=0);-1==g.getValue(0)&&(c.setValue(b,q),k.setValue(b,n),e.setValue(b,q+(n-q)/2),d.setValue(b,Math.abs(n-q)));e.setSliceCount(b+(0<l));d.setSliceCount(b+(0<l));c.setSliceCount(b+(0<l));k.setSliceCount(b+(0<l))}};
VVVV.Nodes.BoundsSpectral.prototype=new VVVV.Core.Node;VVVV.Nodes.GetSliceSpreads=function(a,b){this.constructor(a,"GetSlice (Spreads)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:["Bin Size not implemented"]};this.addInputPin("Input",[0],this);this.addInputPin("Bin Size",[1],this);this.addInputPin("Index",[0],this);this.addOutputPin("Output",[0],this);this.evaluate=function(){for(var a=this.inputPins.Index.values.length,b=0;b<a;b++)this.outputPins.Output.setValue(b,parseFloat(this.inputPins.Input.getValue(Math.round(this.inputPins.Index.getValue(b)))));
this.outputPins.Output.setSliceCount(a)}};VVVV.Nodes.GetSliceSpreads.prototype=new VVVV.Core.Node;
VVVV.Nodes.SetSliceSpreads=function(a,b){this.constructor(a,"SetSlice (Spreads)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};this.auto_evaluate=!1;var h=this.addInputPin("Spread",[0],this),g=this.addInputPin("Input",[0],this),e=this.addInputPin("Index",[0],this),d=this.addOutputPin("Output",[0],this);this.evaluate=function(){for(var c=h.getSliceCount(),a=0;a<c;a++)d.setValue(a,h.getValue(a));size=Math.max(g.getSliceCount(),e.getSliceCount());
for(a=0;a<size;a++)d.setValue(e.getValue(a)%c,g.getValue(a));d.setSliceCount(c)}};VVVV.Nodes.SetSliceSpreads.prototype=new VVVV.Core.Node;
VVVV.Nodes.RandomSpread=function(a,b){function h(a){var e=[],d=0,c=0;(function(c){for(var d=0;256>d;d++)e[d]=d;for(var a=0,d=0;256>d;d++){var a=(a+e[d]+c.charCodeAt(d%c.length))%256,b=e[d];e[d]=e[a];e[a]=b}})(a);this.getRandomNumber=function(){for(var a=0,b=1,g=0;8>g;g++){d=(d+1)%256;c=(c+e[d])%256;var h=e[d];e[d]=e[c];e[c]=h;a+=e[(e[d]+e[c])%256]*b;b*=256}return a/1.8446744073709552E19}}this.constructor(a,"RandomSpread (Spreads)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],
credits:["http://www.webdeveloper.com/forum/showthread.php?t=140572"],compatibility_issues:["Doesnt handle spreaded inputs","random result will differ from original vvvv node because of different algorithm"]};this.addInputPin("Input",[0],this);this.addInputPin("Width",[1],this);this.addInputPin("Random Seed",[0],this);this.addInputPin("Spread Count",[1],this);this.addOutputPin("Output",[0],this);this.evaluate=function(){var a=parseInt(this.inputPins["Spread Count"].getValue(0)),e=parseFloat(this.inputPins.Input.getValue(0)),
d=parseFloat(this.inputPins.Width.getValue(0)),c=parseInt(this.inputPins["Random Seed"].getValue(0));rng=new h(c.toString());this.outputPins.Output.setSliceCount(a);for(c=0;c<a;c++)this.outputPins.Output.setValue(c,rng.getRandomNumber()*d-d/2+e)}};VVVV.Nodes.RandomSpread.prototype=new VVVV.Core.Node;
VVVV.Nodes.SortSpreads=function(a,b){this.constructor(a,"Sort (Spreads)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};this.addInputPin("Input",[0],this);this.addOutputPin("Output",[0],this);this.addOutputPin("Former Index",[0],this);this.evaluate=function(){for(var a=_(this.inputPins.Input.values).map(function(e,d){return[e,d]}),a=_(a).sortBy(function(e){return e[0]}),b=0;b<a.length;b++)this.outputPins.Output.setValue(b,a[b][0]),this.outputPins["Former Index"].setValue(b,
a[b][1]);this.outputPins.Output.setSliceCount(a.length);this.outputPins["Former Index"].setSliceCount(a.length)}};VVVV.Nodes.SortSpreads.prototype=new VVVV.Core.Node;
VVVV.Nodes.LinearSpread=function(a,b){this.constructor(a,"LinearSpread (Spreads)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:["phase does not work with Block alignment"]};var h=this.addInputPin("Input",[0],this),g=this.addInputPin("Width",[1],this),e=this.addInputPin("Alignment",["Centered"],this,!0,VVVV.PinTypes.Enum);e.enumOptions=["Centered","Block","LeftJustified","RightJustified"];var d=this.addInputPin("Phase",[0],this),c=this.addInputPin("Spread Count",
[1],this),k=this.addOutputPin("Output",[0],this);this.evaluate=function(){var a=parseInt(c.getValue(0)),b=parseFloat(g.getValue(0)),l=parseFloat(d.getValue(0)),s=parseFloat(h.getValue(0)),q=e.getValue(0);""==q&&(q="Centered");var n=b/a;"Block"==q&&(n=b/(a-1));var t=n/2;if("Block"==q||"LeftJustified"==q)t=0;"RightJustified"==q&&(t=n);for(var v,w=0;w<a;w++)v=w*n+t,"Block"!=q&&0!=b&&(v=(v+l*b)%b),v=s-b/2+v,k.setValue(w,v.toFixed(4));k.setSliceCount(a)}};VVVV.Nodes.LinearSpread.prototype=new VVVV.Core.Node;
VVVV.Nodes.AvoidNil=function(a,b){this.constructor(a,"AvoidNIL (Spreads)",b);this.auto_nil=!1;this.meta={authors:["Matthias Zauner"],original_authors:["Kalle"],credits:[],compatibility_issues:[]};var h=this.addInputPin("Input",[0],this),g=this.addInputPin("Default",[0],this),e=this.addOutputPin("Output",[0],this);this.evaluate=function(){if(h.pinIsChanged()||g.pinIsChanged()){var d=h;void 0==h.values[0]&&(d=g);for(var c=0;c<d.values.length;c++)e.setValue(c,d.getValue(c));e.setSliceCount(d.getSliceCount())}}};
VVVV.Nodes.AvoidNil.prototype=new VVVV.Core.Node;
VVVV.Nodes.SwapDim=function(a,b){this.constructor(a,"SwapDim (Spreads)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:["BinSize not implemented"]};var h=this.addInputPin("Input",[0],this),g=this.addInputPin("Column Count",[0],this),e=this.addInputPin("Row Count",[0],this),d=this.addOutputPin("Output",[0],this);this.evaluate=function(){for(var c=parseInt(g.getValue(0)),a=parseInt(e.getValue(0)),b=c*a,m=0;m<b;m++)d.setValue(m%c*a+parseInt(m/
c),h.getValue(m));d.setSliceCount(b)}};VVVV.Nodes.SwapDim.prototype=new VVVV.Core.Node;
VVVV.Nodes.I=function(a,b){this.constructor(a,"I (Spreads)",b);this.meta={authors:["M\u00f3r\u00e1sz D\u00e1vid (micro.D)"],original_authors:["VVVV Group"],credits:["Matthias Zauner"],compatibility_issues:["This has no phase pin.",'Smaller "from" than "to" isn\'t working yet']};var h=this.addInputPin("[ From ..",[0],this),g=this.addInputPin(".. To [",[1],this),e=this.addOutputPin("Output",[0],this);this.evaluate=function(){var d=Math.round(h.getValue(0)),c=Math.round(g.getValue(0)),a=0;if(d<=c){for(var b=
d;b<c;b++,a++)e.setValue(a,b);e.setSliceCount(c-d)}else{for(b=d;b>c;b--,a++)e.setValue(a,b);e.setSliceCount(d-c)}}};VVVV.Nodes.I.prototype=new VVVV.Core.Node;
VVVV.Nodes.CircularSpread=function(a,b){this.constructor(a,"CircularSpread (Spreads)",b);this.meta={authors:["Matija Miloslavich"],original_authors:["VVVV Group"],credits:[],compatibility_issues:["only x and y inputs are spreadable"]};this.inpxin=this.addInputPin("Input X",[0],this);this.inpyin=this.addInputPin("Input Y",[0],this);this.widhin=this.addInputPin("Width",[1],this);this.heightin=this.addInputPin("Height",[1],this);this.factorin=this.addInputPin("Factor",[1],this);this.phasein=this.addInputPin("Phase",
[0],this);this.sprcntin=this.addInputPin("Spread Count",[1],this);this.xout=this.addOutputPin("Output X",[0],this);this.yout=this.addOutputPin("Output Y",[0],this);this.evaluate=function(){for(var a=0.5*parseFloat(this.widhin.getValue(0)),b=0.5*parseFloat(this.heightin.getValue(0)),e=parseFloat(this.factorin.getValue(0)),d=parseFloat(this.phasein.getValue(0)),c=parseInt(this.sprcntin.getValue(0)),k=2*Math.PI,d=k*d,p=0,m=Math.max(this.inpyin.getSliceCount(),this.inpxin.getSliceCount()),l=0;l<m*c;l++)for(var s=
parseFloat(this.inpxin.getValue(l)),q=parseFloat(this.inpyin.getValue(l)),n=0;n<c;n++){var t=d+k*(n/c)*e,v=s+Math.cos(t)*a,t=q+Math.sin(t)*b;this.xout.setValue(p,v);this.yout.setValue(p,t);p++}this.xout.setSliceCount(c*m);this.yout.setSliceCount(c*m)}};VVVV.Nodes.CircularSpread.prototype=new VVVV.Core.Node;
VVVV.Nodes.ReverseSpreads=function(a,b){this.constructor(a,"Reverse (Spreads)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};this.auto_evaluate=!1;var h=this.addInputPin("Input",[0],this),g=this.addOutputPin("Output",[0],this);this.evaluate=function(){for(var a=h.getSliceCount(),d=0;d<a;d++){var c=h.getValue(d);g.setValue(a-d-1,c)}g.setSliceCount(a)}};VVVV.Nodes.ReverseSpreads.prototype=new VVVV.Core.Node;
VVVV.Nodes.IntegralSpreads=function(a,b){this.constructor(a,"Integral (Spreads)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};this.auto_evaluate=!1;var h=this.addInputPin("Input",[0],this),g=this.addInputPin("Offset",[0],this),e=this.addOutputPin("Output",[0],this);this.evaluate=function(){var d=h.getSliceCount(),c=parseFloat(g.getValue(0));e.setValue(0,c);for(var a=0;a<d;a++){var b=parseFloat(h.getValue(a)),c=c+b;e.setValue(a+1,c)}e.setSliceCount(d+
1)}};VVVV.Nodes.IntegralSpreads.prototype=new VVVV.Core.Node;
VVVV.Nodes.ConsSpreads=function(a,b){this.constructor(a,"Cons (Spreads)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};this.auto_evaluate=!1;var h=[],g=this.addOutputPin("Output",[0],this),e=this.addInvisiblePin("Input Count",[2],this);this.initialize=function(){for(var d=e.getValue(0),c=h.length;c<d;c++)h[c]=this.addInputPin("Input "+(c+1),[0],this);h.length=d};this.evaluate=function(){e.pinIsChanged()&&this.initialize();for(var d=0,
c=0;c<h.length;c++)for(var a=0;a<h[c].getSliceCount();a++)g.setValue(d++,h[c].getValue(a));g.setSliceCount(d)}};VVVV.Nodes.ConsSpreads.prototype=new VVVV.Core.Node;
VVVV.Nodes.IntervalSpreads=function(a,b){this.constructor(a,"Interval (Spreads)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};this.auto_evaluate=!1;var h=this.addInputPin("Input",[0.5],this),g=this.addInputPin("Intervals",[0],this),e=this.addOutputPin("Index",[0],this),d=0;this.evaluate=function(){var c=h.getSliceCount(),a=g.getSliceCount();if(g.pinIsChanged()){d=void 0;for(var b=0;b<a;b++)if(g.getValue(b)<d||void 0==d)d=g.getValue(b)}for(b=
0;b<c;b++){var m=h.getValue(b);if(m<d)e.setValue(b,-1);else{for(var l=0;l<a-1&&!(m>=g.getValue(l)&&m<g.getValue(l+1));l++);e.setValue(b,l)}}e.setSliceCount(c)}};VVVV.Nodes.IntervalSpreads.prototype=new VVVV.Core.Node;
VVVV.Nodes.QueueSpreads=function(a,b){this.constructor(a,"Queue (Spreads)",b);this.meta={authors:["Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};this.auto_evaluate=!1;var h=this.addInputPin("Input",[0],this),g=this.addInputPin("Insert",[0],this),e=this.addInputPin("Frame Count",[1],this),d=this.addInputPin("Reset",[0],this),c=this.addOutputPin("Output",[],this),k=this.addOutputPin("Output Bin Size",[],this);this.evaluate=function(){var a=g.getValue(0),b=e.getValue(0),
l=d.getValue(0),s=!1;if(0.5<=a&&0.5>l){a=h.getSliceCount();for(s=a-1;0<=s;s--)c.values.unshift(h.getValue(s));k.values.unshift(a);s=!0}if(e.pinIsChanged()||s){for(s=currFrameCount=k.values.length;s>b;s--)c.values.splice(-k.values[s-1]);k.values.splice(b);s=!0}if(s){for(s=0;s<c.values.length;s++)c.setValue(s,c.values[s]);for(s=0;s<k.values.length;s++)k.setValue(s,k.values[s])}0.5<=l&&(c.setSliceCount(0),k.setSliceCount(0))}};VVVV.Nodes.QueueSpreads.prototype=new VVVV.Core.Node;VVVV.Nodes.IOBoxString=function(a,b){this.constructor(a,"IOBox (String)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};this.addInvisiblePin("Rows",[1],this);this.addInputPin("SliceOffset",[0],this);this.addInputPin("Input String",[""],this);this.addOutputPin("Output String",[""],this);this.evaluate=function(){this.outputPins["Output String"].setSliceCount(this.inputPins["Input String"].getSliceCount());for(var a=0;a<this.inputPins["Input String"].getSliceCount();a++)this.outputPins["Output String"].setValue(a,
this.inputPins["Input String"].values[a])}};VVVV.Nodes.IOBoxString.prototype=new VVVV.Core.Node;
VVVV.Nodes.SwitchStringInput=function(a,b){this.constructor(a,"Switch (String Input)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:["No dynamic pin count yet"]};var h=this.addInputPin("Switch",[0],this),g=[];g[0]=this.addInputPin("Input 1",["text"],this);g[1]=this.addInputPin("Input 2",["text"],this);var e=this.addOutputPin("Output",["text"],this);this.evaluate=function(){var d=this.getMaxInputSliceCount();if(void 0==h.getValue(0))e.setValue(0,
void 0);else{for(var c=0;c<d;c++)e.setValue(c,g[h.getValue(c)%g.length].getValue(c));e.setSliceCount(d)}}};VVVV.Nodes.SwitchStringInput.prototype=new VVVV.Core.Node;
VVVV.Nodes.AddString=function(a,b){this.constructor(a,"Add (String)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:["No dynamic pin count yet","Intersperse *Enum* not implemented"]};var h=[];h[0]=this.addInputPin("Input 1",["text"],this);h[1]=this.addInputPin("Input 2",["text"],this);var g=this.addInputPin("Intersperse String",[""],this),e=this.addOutputPin("Output",["texttext"],this);this.evaluate=function(){for(var d=this.getMaxInputSliceCount(),
c=0;c<d;c++){var a=[],b=g.getValue(c);void 0==b&&(b="");for(var m=0;m<h.length;m++)a.push(h[m].getValue(c));e.setValue(c,a.join(b))}e.setSliceCount(d)}};VVVV.Nodes.AddString.prototype=new VVVV.Core.Node;
VVVV.Nodes.GetSliceString=function(a,b){this.constructor(a,"GetSlice (String)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:["Bin Size not implemented"]};var h=this.addInputPin("Input",["text"],this);this.addInputPin("Bin Size",[1],this);var g=this.addInputPin("Index",[0],this),e=this.addOutputPin("Output",["text"],this);this.evaluate=function(){for(var d=0;d<g.values.length;d++)e.setValue(d,h.getValue(Math.round(g.getValue(d))));e.setSliceCount(g.getSliceCount())}};
VVVV.Nodes.GetSliceString.prototype=new VVVV.Core.Node;
VVVV.Nodes.AsValue=function(a,b){this.constructor(a,"AsValue (String)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};var h=this.addInputPin("Input",[],this),g=this.addInputPin("Default",[0],this),e=this.addOutputPin("Output",[0],this);this.evaluate=function(){for(var d=this.getMaxInputSliceCount(),c=0;c<d;c++){var a=h.getValue(c);/^\s*-?[0-9.e]+\s*$/.test(a)?e.setValue(c,parseFloat(a)):e.setValue(c,parseFloat(g.getValue(c)))}e.setSliceCount(d)}};
VVVV.Nodes.AsValue.prototype=new VVVV.Core.Node;
VVVV.Nodes.SortString=function(a,b){this.constructor(a,"Sort (String)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};this.auto_evaluate=!1;var h=this.addInputPin("Input",["text"],this);this.addInputPin("Reverse Sorting",[0],this);var g=this.addOutputPin("Output",["text"],this),e=this.addOutputPin("Former Index",[0],this);this.initialize=function(){};this.evaluate=function(){xxx=h.values;for(var d=_(h.values).map(function(c,d){return[c,
d]}),d=_(d).sortBy(function(c){return c[0]}),c=0;c<d.length;c++)g.setValue(c,d[c][0]),e.setValue(c,d[c][1]);g.setSliceCount(d.length);e.setSliceCount(d.length)}};VVVV.Nodes.SortString.prototype=new VVVV.Core.Node;
VVVV.Nodes.LengthString=function(a,b){this.constructor(a,"Length (String)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};this.auto_evaluate=!1;var h=this.addInputPin("Input",["text"],this),g=this.addOutputPin("Count",[0],this);this.evaluate=function(){for(var a=this.getMaxInputSliceCount(),d=0;d<a;d++){var c=h.getValue(d);g.setValue(d,c.length)}g.setSliceCount(a)}};VVVV.Nodes.LengthString.prototype=new VVVV.Core.Node;
VVVV.Nodes.SiftString=function(a,b){this.constructor(a,"Sift (String)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};this.auto_evaluate=!1;var h=this.addInputPin("Input",["text"],this),g=this.addInputPin("Filter",["text"],this),e=this.addInputPin("Comparison",["Matches"],this),d=this.addInputPin("Case Sensitive",[0],this),c=this.addOutputPin("Hits",[0],this),k=this.addOutputPin("Input Index",[0],this),p=this.addOutputPin("Filter Index",
[0],this),m=this.addOutputPin("Found At Position",[0],this);this.evaluate=function(){var a=this.getMaxInputSliceCount();c.setSliceCount(a);var b=e.getValue(0);d.getValue(0);for(var q=0,n=0;n<a;n++){var t=h.getValue(n),v=1;if("MatchesAny"==b||"ContainsAny"==b)v=g.getSliceCount();for(var w=0,y=0;y<v;y++){var r=g.getValue(y+n),u=[];if("Matches"==b||"MatchesAny"==b)r==t&&u.push(-1);else for(var r=RegExp(r,"gi"),z;z=r.exec(t);)u.push(z.index);for(r=0;r<u.length;r++)k.setValue(q,n%h.getSliceCount()),p.setValue(q,
(n+y)%g.getSliceCount()),m.setValue(q,u[r]+1),q++,w++}c.setValue(n,w)}k.setSliceCount(q);p.setSliceCount(q);m.setSliceCount(q)}};VVVV.Nodes.SiftString.prototype=new VVVV.Core.Node;
VVVV.Nodes.SeparateString=function(a,b){this.constructor(a,"Separate (String)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:["Quotes don't work"]};this.auto_evaluate=!1;var h=this.addInputPin("Input",["text"],this),g=this.addInputPin("Intersperse",["None"],this),e=this.addInputPin("Intersperse String",[""],this),d=this.addInputPin("Ignore between",["Double"],this),c=this.addInputPin("Keep Quotes",[0],this),k=this.addOutputPin("Output",["text"],
this),p=this.addOutputPin("Former Index",[0],this),m={None:"",Space:" ",Comma:",",CommaPlusSpace:", ",Semicolon:";",Colon:":",Pipe:"|",UnixPath:"/",DosPath:"\\",Dash:"-",NewLineAutoDetection:"\n",Dot:".",UnderScore:"_",Minus:"-"},l={Single:"'",Double:'"'};this.evaluate=function(){for(var a=this.getMaxInputSliceCount(),b=0,n=0;n<a;n++){var t=h.getValue(n),v=m[g.getValue(n)],w=e.getValue(n),y=l[d.getValue(n)],r=c.getValue(n);""==v&&(v=w);""==v&&(v=void 0);t=t.split(v);v=t.length;y=RegExp("[^"+y+"]*",
"g");for(w=0;w<v;w++)1==r?k.setValue(b,t[w]):k.setValue(b,t[w].match(y).join("")),p.setValue(b,n),b++}k.setSliceCount(b);p.setSliceCount(b)}};VVVV.Nodes.SeparateString.prototype=new VVVV.Core.Node;
VVVV.Nodes.EQString=function(a,b){this.constructor(a,"EQ (String)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};this.auto_evaluate=!1;var h=this.addInputPin("Input 1",[""],this),g=this.addInputPin("Input 2",[""],this),e=this.addInputPin("Case Sensitive",[1],this),d=this.addOutputPin("Output",[0],this),c=this.addOutputPin("Inverse Output",[0],this);this.evaluate=function(){for(var a=this.getMaxInputSliceCount(),b=0;b<a;b++){var m=h.getValue(b),
l=g.getValue(b),s=e.getValue(b),m=m==l||0==s&&m.toLowerCase()==l.toLowerCase()?1:0;d.setValue(b,m);c.setValue(b,1-m)}d.setSliceCount(a);c.setSliceCount(a)}};VVVV.Nodes.EQString.prototype=new VVVV.Core.Node;
VVVV.Nodes.SelectString=function(a,b){this.constructor(a,"Select (String)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};var h=this.addInputPin("Input",[""],this),g=this.addInputPin("Select",[1],this),e=this.addOutputPin("Output",[0],this),d=this.addOutputPin("Former Slice",[0],this);this.evaluate=function(){for(var c=this.getMaxInputSliceCount(),a=0,b=0;b<c;b++)for(var m=0;m<g.getValue(b);m++)e.setValue(a,h.getValue(b)),d.setValue(a,
b),a++;e.setSliceCount(a);d.setSliceCount(a)}};VVVV.Nodes.SelectString.prototype=new VVVV.Core.Node;
VVVV.Nodes.CountString=function(a,b){this.constructor(a,"Count (String)",b);this.auto_nil=!1;this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};this.addInputPin("Input",[""],this);this.addOutputPin("Count",[1],this);this.addOutputPin("High",[0],this);this.evaluate=function(){this.inputPins.Input.pinIsChanged()&&(this.outputPins.Count.setValue(0,this.inputPins.Input.values.length),this.outputPins.High.setValue(0,this.inputPins.Input.values.length-
1))}};VVVV.Nodes.CountString.prototype=new VVVV.Core.Node;VVVV.Nodes.CleanString=function(a,b){this.constructor(a,"Clean (String)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};this.auto_evaluate=!1;var h=this.addInputPin("Input",["text"],this),g=this.addOutputPin("Output",["text"],this);this.evaluate=function(){for(var a=this.getMaxInputSliceCount(),d=0;d<a;d++)h.getValue(d)?g.setValue(d,h.getValue(d).trim()):g.setValue(d,void 0);g.setSliceCount(a)}};
VVVV.Nodes.CleanString.prototype=new VVVV.Core.Node;
VVVV.Nodes.AvoidNilString=function(a,b){this.constructor(a,"AvoidNIL (String)",b);this.auto_nil=!1;this.meta={authors:["Matthias Zauner"],original_authors:["Kalle"],credits:[],compatibility_issues:[]};var h=this.addInputPin("Input",["text"],this),g=this.addInputPin("Default",["text"],this),e=this.addOutputPin("Output",["text"],this);this.evaluate=function(){if(h.pinIsChanged()||g.pinIsChanged()){var d=h;void 0==h.values[0]&&(d=g);for(var c=0;c<d.values.length;c++)e.setValue(c,d.getValue(c));e.setSliceCount(d.getSliceCount())}}};
VVVV.Nodes.AvoidNilString.prototype=new VVVV.Core.Node;
VVVV.Nodes.FormatValueString=function(a,b){this.constructor(a,"FormatValue (String)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:["pad function: http://stackoverflow.com/a/10073788","thousands separator regex: http://stackoverflow.com/a/2901298"],compatibility_issues:[]};this.auto_evaluate=!1;var h=this.addInputPin("Input",[0],this),g=this.addInputPin("Characters before Comma",[1],this),e=this.addInputPin("Characters after Comma",[0],this),d=this.addInputPin("Thousands Symbol",
["None"],this,!0,VVVV.PinTypes.Enum);d.enumOptions=["None","Dot","Comma","Space"];var c=this.addInputPin("Comma Symbol",["Dot"],this,!0,VVVV.PinTypes.Enum);c.enumOptions=["Dot","Comma"];var k=this.addInputPin("Leading Zeroes",[0],this),p=this.addOutputPin("Output",["0"],this),m={Dot:".",Comma:",",None:"",Space:" "};this.evaluate=function(){for(var a=this.getMaxInputSliceCount(),b=0;b<a;b++){var q=h.getValue(b),n=parseInt(g.getValue(b)),t=parseInt(e.getValue(b)),v=d.getValue(b),w=c.getValue(b),y=k.getValue(b),
n=n+t+(0<t),q=parseFloat(q).toFixed(t),y=y=0.5<=y?"0":" ",q=q+"",q=q.length>=n?q:Array(n-q.length+1).join(y)+q,q=q.replace(".",m[w]).replace(/\B(?=(\d{3})+(?!\d))/g,m[v]);p.setValue(b,q)}p.setSliceCount(a)}};VVVV.Nodes.FormatValueString.prototype=new VVVV.Core.Node;VVVV.Nodes.MouseGlobal=function(a,b){this.constructor(a,"Mouse (System Global)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:["Cyclic mode not supported","No Mouse Wheel pin","No Left Button Pin","No Right Button Pin","No Middle Button Pin"]};this.auto_evaluate=!0;var h=this.addOutputPin("X",[0],this),g=this.addOutputPin("Y",[0],this),e=this.addOutputPin("Mouse Wheel",[0],this),d=this.addOutputPin("Left Button",[0],this),c=this.addOutputPin("Middle Button",
[0],this),k=this.addOutputPin("Right Button",[0],this),p=0,m=0,l=0,s=0,q=0,n=0;$(document).mousemove(function(c){p=2*c.pageX/parseInt($("body").css("width"))-1;m=-(2*c.pageY/parseInt($("body").css("height"))-1)});$(document).bind("mousewheel",function(c){l+=c.originalEvent.wheelDelta/120});$(document).bind("DOMMouseScroll",function(c){l+=-c.originalEvent.detail/3});$(document).mousedown(function(c){switch(c.which){case 1:s=1;break;case 2:q=1;break;case 3:n=1}});$(document).mouseup(function(c){switch(c.which){case 1:s=
0;break;case 2:q=0;break;case 3:n=0}});this.evaluate=function(){h.getValue(0)!=p&&h.setValue(0,p);g.getValue(0)!=m&&g.setValue(0,m);e.getValue(0)!=l&&e.setValue(0,l);d.getValue(0)!=s&&d.setValue(0,s);c.getValue(0)!=q&&c.setValue(0,q);k.getValue(0)!=n&&k.setValue(0,n)}};VVVV.Nodes.MouseGlobal.prototype=new VVVV.Core.Node;
VVVV.Nodes.MouseWindow=function(a,b){this.constructor(a,"Mouse (System Window)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:["Cyclic mode not supported","No Mouse Wheel pin","No Left Button Pin","No Right Button Pin","No Middle Button Pin"]};this.auto_evaluate=!0;var h=this.addOutputPin("X",[0],this),g=this.addOutputPin("Y",[0],this),e=this.addOutputPin("Mouse Wheel",[0],this),d=this.addOutputPin("Left Button",[0],this),c=this.addOutputPin("Middle Button",
[0],this),k=this.addOutputPin("Right Button",[0],this);this.evaluate=function(){h.getValue(0)!=VVVV.MousePositions._all.x&&h.setValue(0,VVVV.MousePositions._all.x);g.getValue(0)!=VVVV.MousePositions._all.y&&g.setValue(0,VVVV.MousePositions._all.y);e.getValue(0)!=VVVV.MousePositions._all.wheel&&e.setValue(0,VVVV.MousePositions._all.wheel);d.getValue(0)!=VVVV.MousePositions._all.lb&&d.setValue(0,VVVV.MousePositions._all.lb);c.getValue(0)!=VVVV.MousePositions._all.mb&&c.setValue(0,VVVV.MousePositions._all.mb);
k.getValue(0)!=VVVV.MousePositions._all.rb&&k.setValue(0,VVVV.MousePositions._all.rb)}};VVVV.Nodes.MouseWindow.prototype=new VVVV.Core.Node;
VVVV.Nodes.ShellExecute=function(a,b){this.constructor(a,"ShellExecute (Windows)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:["This actually does something completely different from the original node: the origin node executes a shell command, this node evals javascript code"]};var h=this.addInputPin("File",[0],this),g=this.addInputPin("Do Execute",[0],this),e=this.addOutputPin("Result",[""],this);this.evaluate=function(){if(1<=Math.round(g.getValue(0))){var d=
eval(h.getValue(0));d instanceof Array||d instanceof Object||(d=[d]);if(void 0!=d)for(var c=0;c<d.length;c++)e.setValue(c,d[c])}}};VVVV.Nodes.ShellExecute.prototype=new VVVV.Core.Node;
VVVV.Nodes.ScreenInfo=function(a,b){this.constructor(a,"ScreenInfo (Windows)",b);this.meta={authors:["David M\u00f3r\u00e1sz (micro.D)"],original_authors:["VVVV Group"],credits:["Matthias Zauner"],compatibility_issues:["Outputs the window size (ResolutionXY) and the document size (Working AreaXY) only","no Bits per pixel"]};var h=this.addOutputPin("ResolutionXY",[0],this),g=this.addOutputPin("Working AreaXY",[0],this),e=0,d=0,c=0,k=0;$(document).ready(function(){d=$(window).height();e=$(window).width();
k=$(document).height();c=$(document).width()});$(window).resize(function(){d=$(window).height();e=$(window).width();k=$(document).height();c=$(document).width()});this.evaluate=function(){if(h.getValue(0)!=e||h.getValue(1)!=d)h.setValue(0,e),h.setValue(1,d);if(g.getValue(0)!=c||g.getValue(1)!=k)g.setValue(0,c),g.setValue(1,k)}};VVVV.Nodes.ScreenInfo.prototype=new VVVV.Core.Node;VVVV.PinTypes.Transform={typeName:"Transform",reset_on_disconnect:!0,defaultValue:function(){return mat4.identity(mat4.create())}};
VVVV.Nodes.Rotate=function(a,b){this.constructor(a,"Rotate (Transform)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};mat4.identity(mat4.create());this.trIn=this.addInputPin("Transform In",[],this,!0,VVVV.PinTypes.Transform);this.xIn=this.addInputPin("X",[0],this);this.yIn=this.addInputPin("Y",[0],this);this.zIn=this.addInputPin("Z",[0],this);this.trOut=this.addOutputPin("Transform Out",[],this,VVVV.PinTypes.Transform);this.evaluate=
function(){for(var a=this.trIn.isConnected()?this.getMaxInputSliceCount():Math.max(this.xIn.getSliceCount(),this.yIn.getSliceCount(),this.zIn.getSliceCount()),b=0;b<a;b++){var e=this.inputPins["Transform In"].getValue(b),d=parseFloat(this.inputPins.X.getValue(b)),c=parseFloat(this.inputPins.Y.getValue(b)),k=parseFloat(this.inputPins.Z.getValue(b)),p=mat4.create();mat4.identity(p);mat4.rotate(p,2*c*Math.PI,[0,1,0]);mat4.rotate(p,2*d*Math.PI,[1,0,0]);mat4.rotate(p,2*k*Math.PI,[0,0,1]);this.trIn.isConnected()&&
mat4.multiply(e,p,p);this.trOut.setValue(b,p)}this.trOut.setSliceCount(a)}};VVVV.Nodes.Rotate.prototype=new VVVV.Core.Node;
VVVV.Nodes.Translate=function(a,b){this.constructor(a,"Translate (Transform)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};mat4.identity(mat4.create());this.trIn=this.addInputPin("Transform In",[],this,!0,VVVV.PinTypes.Transform);this.xIn=this.addInputPin("X",[0],this);this.yIn=this.addInputPin("Y",[0],this);this.zIn=this.addInputPin("Z",[0],this);this.trOut=this.addOutputPin("Transform Out",[],this,VVVV.PinTypes.Transform);this.evaluate=
function(){for(var a=this.trIn.isConnected()?this.getMaxInputSliceCount():Math.max(this.xIn.getSliceCount(),this.yIn.getSliceCount(),this.zIn.getSliceCount()),b=0;b<a;b++){var e=parseFloat(this.xIn.getValue(b)),d=parseFloat(this.yIn.getValue(b)),c=parseFloat(this.zIn.getValue(b)),k=mat4.create();mat4.identity(k);mat4.translate(k,[e,d,c]);this.trIn.isConnected()&&(e=this.trIn.getValue(b),mat4.multiply(e,k,k));this.trOut.setValue(b,k)}this.trOut.setSliceCount(a)}};VVVV.Nodes.Translate.prototype=new VVVV.Core.Node;
VVVV.Nodes.Scale=function(a,b){this.constructor(a,"Scale (Transform)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};mat4.identity(mat4.create());this.trIn=this.addInputPin("Transform In",[],this,!0,VVVV.PinTypes.Transform);this.xIn=this.addInputPin("X",[1],this);this.yIn=this.addInputPin("Y",[1],this);this.zIn=this.addInputPin("Z",[1],this);this.trOut=this.addOutputPin("Transform Out",[],this,VVVV.PinTypes.Transform);this.evaluate=function(){for(var a=
this.trIn.isConnected()?this.getMaxInputSliceCount():Math.max(this.xIn.getSliceCount(),this.yIn.getSliceCount(),this.zIn.getSliceCount()),b=0;b<a;b++){var e=parseFloat(this.inputPins.X.getValue(b)),d=parseFloat(this.inputPins.Y.getValue(b)),c=parseFloat(this.inputPins.Z.getValue(b)),k=mat4.create();mat4.identity(k);mat4.scale(k,[e,d,c]);this.inputPins["Transform In"].isConnected()&&(e=this.inputPins["Transform In"].getValue(b),mat4.multiply(e,k,k));this.trOut.setValue(b,k)}this.trOut.setSliceCount(a)}};
VVVV.Nodes.Scale.prototype=new VVVV.Core.Node;
VVVV.Nodes.Perspective=function(a,b){this.constructor(a,"Perspective (Transform)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:["Not spreadable"]};mat4.identity(mat4.create());this.addInputPin("Transform In",[],this,!0,VVVV.PinTypes.Transform);this.addInputPin("FOV",[0.25],this);this.addInputPin("Near Plane",[0.05],this);this.addInputPin("Far Plane",[100],this);this.addOutputPin("Transform Out",[],this,VVVV.PinTypes.Transform);this.evaluate=
function(){var a=parseFloat(this.inputPins.FOV.getValue(0)),b=parseFloat(this.inputPins["Near Plane"].getValue(0)),e=parseFloat(this.inputPins["Far Plane"].getValue(0)),d=mat4.create();mat4.identity(d);mat4.perspective(360*a,1,b,e,d);this.inputPins["Transform In"].isConnected()&&(a=this.inputPins["Transform In"].getValue(i),mat4.multiply(a,d,d));this.outputPins["Transform Out"].setValue(0,d)}};VVVV.Nodes.Perspective.prototype=new VVVV.Core.Node;
VVVV.Nodes.InverseTransform=function(a,b){this.constructor(a,"Inverse (Transform)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};var h=this.addInputPin("Transform In",[],this,!0,VVVV.PinTypes.Transform),g=this.addInputPin("Source",[],this,!0,VVVV.PinTypes.Transform),e=this.addOutputPin("Transform Out",[],this,VVVV.PinTypes.Transform);this.evaluate=function(){for(var d=this.getMaxInputSliceCount(),c=0;c<d;c++){var a=mat4.create();mat4.set(g.getValue(c),
a);mat4.multiply(h.getValue(c),mat4.inverse(a,a),a);e.setValue(c,a)}e.setSliceCount(d)}};VVVV.Nodes.InverseTransform.prototype=new VVVV.Core.Node;VVVV.Nodes.AddValue=function(a,b){this.constructor(a,"Add (Value)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[""]};var h=this.addInvisiblePin("Input Count",[2],this),g=[],e;this.initialize=function(){e=this.addOutputPin("Output",[0],this);for(var d=h.getValue(0),c=0;c<d;c++){var a=this.addInputPin("Input "+(c+1),[0],this);g[c]=a}};this.evaluate=function(){var d=this.getMaxInputSliceCount();e.setSliceCount(d);for(var c=0;c<d;c++){for(var a=
parseFloat(g[0].getValue(c)),b=1;b<g.length;b++)a+=parseFloat(g[b].getValue(c));e.setValue(c,a)}}};VVVV.Nodes.AddValue.prototype=new VVVV.Core.Node;
VVVV.Nodes.SubtractValue=function(a,b){this.constructor(a,"Subtract (Value)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[""]};var h=this.addInvisiblePin("Input Count",[2],this),g=[],e;this.initialize=function(){e=this.addOutputPin("Output",[0],this);for(var d=h.getValue(0),c=0;c<d;c++){var a=this.addInputPin("Input "+(c+1),[0],this);g[c]=a}};this.evaluate=function(){var d=this.getMaxInputSliceCount();e.setSliceCount(d);for(var c=0;c<d;c++){for(var a=
parseFloat(g[0].getValue(c)),b=1;b<g.length;b++)a-=parseFloat(g[b].getValue(c));e.setValue(c,a)}}};VVVV.Nodes.SubtractValue.prototype=new VVVV.Core.Node;
VVVV.Nodes.EqValue=function(a,b){this.constructor(a,"EQ (Value)",b);this.meta={authors:["Matthias Zauner","Fibo"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};var h=this.addInputPin("Input 1",[0],this),g=this.addInputPin("Input 2",[0],this),e=this.addInputPin("Epsilon",[0],this),d=this.addOutputPin("Output",[0],this),c=this.addOutputPin("Inverse Output",[0],this);this.evaluate=function(){for(var a=this.getMaxInputSliceCount(),b=0;b<a;b++){var m=0;Math.abs(h.getValue(b)-g.getValue(b))<=
Math.abs(e.getValue(b))&&(m=1);d.setValue(b,m);c.setValue(b,1-m)}d.setSliceCount(a);c.setSliceCount(a)}};VVVV.Nodes.EqValue.prototype=new VVVV.Core.Node;
VVVV.Nodes.GtValue=function(a,b){this.constructor(a,"GT (Value)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:["No dynamic pin count yet"]};var h=this.addInputPin("Input 1",[0],this),g=this.addInputPin("Input 2",[0],this),e=this.addOutputPin("Output",[0],this);this.evaluate=function(){for(var d=this.getMaxInputSliceCount(),c=0;c<d;c++){var a=0;parseFloat(h.getValue(c))>parseFloat(g.getValue(c))&&(a=1);e.setValue(c,a)}e.setSliceCount(d)}};
VVVV.Nodes.GtValue.prototype=new VVVV.Core.Node;
VVVV.Nodes.LtValue=function(a,b){this.constructor(a,"LT (Value)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:["No dynamic pin count yet"]};var h=this.addInputPin("Input 1",[0],this),g=this.addInputPin("Input 2",[0],this),e=this.addOutputPin("Output",[0],this);this.evaluate=function(){for(var a=this.getMaxInputSliceCount(),c=0;c<a;c++){var b=0;parseFloat(h.getValue(c))<parseFloat(g.getValue(c))&&(b=1);e.setValue(c,b)}e.setSliceCount(a)}};
VVVV.Nodes.LtValue.prototype=new VVVV.Core.Node;
VVVV.Nodes.MultiplyValue=function(a,b){this.constructor(a,"Multiply (Value)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[""]};var h=this.addInvisiblePin("Input Count",[2],this),g=[],e;this.initialize=function(){e=this.addOutputPin("Output",[0],this);for(var a=h.getValue(0),c=0;c<a;c++){var b=this.addInputPin("Input "+(c+1),[0],this);g[c]=b}};this.evaluate=function(){var a=this.getMaxInputSliceCount();e.setSliceCount(a);for(var c=0;c<a;c++){for(var b=
parseFloat(g[0].getValue(c)),h=1;h<g.length;h++)b*=parseFloat(g[h].getValue(c));e.setValue(c,b)}}};VVVV.Nodes.MultiplyValue.prototype=new VVVV.Core.Node;
VVVV.Nodes.DivideValue=function(a,b){this.constructor(a,"Divide (Value)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};this.addInvisiblePin("Inputs Count",[2],this);var h=this.addInputPin("Input",[0],this),g=this.addInputPin("Input 2",[0],this),e=this.addOutputPin("Output",[0],this);this.initialize=function(){};this.evaluate=function(){for(var a=this.getMaxInputSliceCount(),c=0;c<a;c++)0==g.getValue(c)?e.setValue(c,1):e.setValue(c,h.getValue(c)/
g.getValue(c));e.setSliceCount(a)}};VVVV.Nodes.DivideValue.prototype=new VVVV.Core.Node;
VVVV.Nodes.IOBoxValueAdvanced=function(a,b){this.constructor(a,"IOBox (Value Advanced)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};this.addInputPin("Y Input Value",[0],this);this.addInvisiblePin("Rows",[1],this);this.addOutputPin("Y Output Value",[0],this);this.evaluate=function(){if(this.inputPins["Y Input Value"].pinIsChanged()){for(var a=0;a<this.inputPins["Y Input Value"].values.length;a++)this.outputPins["Y Output Value"].setValue(a,
parseFloat(this.inputPins["Y Input Value"].values[a]));this.outputPins["Y Output Value"].setSliceCount(this.inputPins["Y Input Value"].getSliceCount())}}};VVVV.Nodes.IOBoxValueAdvanced.prototype=new VVVV.Core.Node;
VVVV.Nodes.CountValue=function(a,b){this.constructor(a,"Count (Value)",b);this.auto_nil=!1;this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};this.addInputPin("Input",[0],this);this.addOutputPin("Count",[1],this);this.addOutputPin("High",[0],this);this.evaluate=function(){this.inputPins.Input.pinIsChanged()&&(this.outputPins.Count.setValue(0,this.inputPins.Input.values.length),this.outputPins.High.setValue(0,this.inputPins.Input.values.length-
1))}};VVVV.Nodes.CountValue.prototype=new VVVV.Core.Node;
VVVV.Nodes.SwitchValueInput=function(a,b){this.constructor(a,"Switch (Value Input)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:["No dynamic pin count yet"]};var h=this.addInputPin("Switch",[0],this),g=[];g[0]=this.addInputPin("Input 1",[0],this);g[1]=this.addInputPin("Input 2",[0],this);var e=this.addOutputPin("Output",[0],this);this.evaluate=function(){for(var a=this.getMaxInputSliceCount(),c=0;c<a;c++)e.setValue(c,g[Math.round(Math.abs(h.getValue(c)))%
g.length].getValue(c));e.setSliceCount(a)}};VVVV.Nodes.SwitchValueInput.prototype=new VVVV.Core.Node;
VVVV.Nodes.SelectValue=function(a,b){this.constructor(a,"Select (Value)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};var h=this.addInputPin("Input",[0],this),g=this.addInputPin("Select",[1],this),e=this.addOutputPin("Output",[0],this),d=this.addOutputPin("Former Slice",[0],this);this.evaluate=function(){for(var c=this.getMaxInputSliceCount(),a=0,b=0;b<c;b++)for(var m=0;m<g.getValue(b);m++)e.setValue(a,h.getValue(b)),d.setValue(a,b),
a++;e.setSliceCount(a);d.setSliceCount(a)}};VVVV.Nodes.SelectValue.prototype=new VVVV.Core.Node;
VVVV.Nodes.AsString=function(a,b){this.constructor(a,"AsString (Value)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:["SubType not implemented, always returns float formatting"]};var h=this.addInputPin("Input",[0],this),g=this.addInputPin("SubType",["Real (MinFloat .. MaxFloat)"],this),e=this.addOutputPin("Output",[0],this);this.evaluate=function(){for(var a=this.getMaxInputSliceCount(),c=0;c<a;c++){subtype=g.getValue(c).match(/^(.+) \(/)[1];
var b;switch(subtype){case "Real":b=parseFloat(h.getValue(c)).toFixed(4);break;case "Integer":b=parseInt(h.getValue(c)).toFixed(0)}e.setValue(c,b)}e.setSliceCount(a)}};VVVV.Nodes.AsString.prototype=new VVVV.Core.Node;
VVVV.Nodes.Frac=function(a,b){this.constructor(a,"Frac (Value)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};var h=this.addInputPin("Input",[0],this),g=this.addOutputPin("Whole Part",[0],this),e=this.addOutputPin("Real Part",[0.5],this);this.evaluate=function(){for(var a=this.getMaxInputSliceCount(),c=0;c<a;c++){var b=parseFloat(h.getValue(c));g.setValue(c,Math.floor(b));e.setValue(c,b-Math.floor(b))}g.setSliceCount(a);e.setSliceCount(a)}};
VVVV.Nodes.Frac.prototype=new VVVV.Core.Node;
VVVV.Nodes.AddValueSpectral=function(a,b){this.constructor(a,"Add (Value Spectral)",b);this.meta={authors:["David M\u00f3r\u00e1sz (micro.D)","Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};this.addInputPin("Input",[0],this);this.addInputPin("Bin Size",[-1],this);this.addOutputPin("Output",[0],this);this.evaluate=function(){for(var a=this.getMaxInputSliceCount(),b=0,e=0,d=0;d<a||0<this.inputPins["Bin Size"].getValue(0)&&(0<e||0!=b%this.inputPins["Bin Size"].values.length);d++){if(0==
e)var c=0;c+=parseFloat(this.inputPins.Input.getValue(d));e++;0<this.inputPins["Bin Size"].getValue(0)?e>=this.inputPins["Bin Size"].getValue(b)&&(this.outputPins.Output.setValue(b,c),b++,e=0):this.outputPins.Output.setValue(0,c)}this.outputPins.Output.setSliceCount(b+(0<e))}};VVVV.Nodes.AddValueSpectral.prototype=new VVVV.Core.Node;
VVVV.Nodes.WaveShaperValue=function(a,b){this.constructor(a,"WaveShaper (Value)",b);this.meta={authors:["sebl"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};this.auto_evaluate=!1;var h=this.addInputPin("Input",[0],this),g=this.addInputPin("Shape",["Linear"],this),e=this.addOutputPin("Output",[0],this);this.initialize=function(){};this.evaluate=function(){for(var a=this.getMaxInputSliceCount(),c=0;c<a;c++){var b=h.getValue(c);switch(g.getValue(c)){case "Linear":e.setValue(c,
b);break;case "Inverse":e.setValue(c,1-b);break;case "Triangle":0.5>b?e.setValue(c,2*b):e.setValue(c,2*(1-b));break;case "Sine":inp=6.28318530717959*((b+0.25)%1);e.setValue(c,Math.sin(inp)/2+0.5);break;case "Rectangle":0.5>b?e.setValue(c,0):e.setValue(c,1)}}e.setSliceCount(a)}};VVVV.Nodes.WaveShaperValue.prototype=new VVVV.Core.Node;
VVVV.Nodes.MapValue=function(a,b){this.constructor(a,"Map (Value)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:["Mirror Mapping Mode not implemented"]};this.auto_evaluate=!1;var h=this.addInputPin("Input",[0.5],this),g=this.addInputPin("Source Minimum",[0],this),e=this.addInputPin("Source Maximum",[1],this),d=this.addInputPin("Destination Minimum",[0],this),c=this.addInputPin("Destination Maximum",[1],this),k=this.addInputPin("Mapping",
["Float"],this),p=this.addOutputPin("Output",[0.5],this);this.evaluate=function(){for(var a=this.getMaxInputSliceCount(),b=0;b<a;b++){var s=parseFloat(h.getValue(b)),q=parseFloat(g.getValue(b)),n=parseFloat(e.getValue(b)),t=parseFloat(d.getValue(b)),v=parseFloat(c.getValue(b)),w=k.getValue(b);if(n==q)p.setValue(b,t);else{s-=q;n-=q;switch(w){case "Clamp":s=Math.max(0,Math.min(n,s));break;case "Wrap":s=(n+s%n)%n}p.setValue(b,s*((v-t)/n)+t)}}p.setSliceCount(a)}};VVVV.Nodes.MapValue.prototype=new VVVV.Core.Node;
VVVV.Nodes.MinValue=function(a,b){this.constructor(a,"Min (Value)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};this.auto_evaluate=!1;var h=this.addOutputPin("Output",[0],this),g=this.addInvisiblePin("Input Count",[0],this),e=[];this.initialize=function(){for(var a=Math.max(2,g.getValue(0)),c=e.length;c<a;c++)e[c]=this.addInputPin("Input "+(c+1),[0],this);e.length=a};this.evaluate=function(){g.pinIsChanged()&&this.initialize();for(var a=
this.getMaxInputSliceCount(),c=0;c<a;c++){for(var b=void 0,p=0;p<e.length;p++)if(void 0==b||e[p].getValue(c)<b)b=e[p].getValue(c);h.setValue(c,b)}h.setSliceCount(a)}};VVVV.Nodes.MinValue.prototype=new VVVV.Core.Node;
VVVV.Nodes.MaxValue=function(a,b){this.constructor(a,"Max (Value)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};this.auto_evaluate=!1;var h=this.addOutputPin("Output",[0],this),g=this.addInvisiblePin("Input Count",[0],this),e=[];this.initialize=function(){for(var a=Math.max(2,g.getValue(0)),c=e.length;c<a;c++)e[c]=this.addInputPin("Input "+(c+1),[0],this);e.length=a};this.evaluate=function(){g.pinIsChanged()&&this.initialize();for(var a=
this.getMaxInputSliceCount(),c=0;c<a;c++){for(var b=void 0,p=0;p<e.length;p++)if(void 0==b||e[p].getValue(c)>b)b=e[p].getValue(c);h.setValue(c,b)}h.setSliceCount(a)}};VVVV.Nodes.MaxValue.prototype=new VVVV.Core.Node;
VVVV.Nodes.ModValue=function(a,b){this.constructor(a,"Mod (Value)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};this.auto_evaluate=!1;var h=this.addOutputPin("Output",[0],this),g=this.addInvisiblePin("Input Count",[0],this),e=[];this.initialize=function(){for(var a=Math.max(2,g.getValue(0)),c=e.length;c<a;c++)e[c]=this.addInputPin("Input "+(c+1),[0],this);e.length=a};this.evaluate=function(){g.pinIsChanged()&&this.initialize();for(var a=
this.getMaxInputSliceCount(),c=0;c<a;c++){for(var b=e[0].getValue(c),p=1;p<e.length;p++)b=0==e[p].getValue(c)?0:b%e[p].getValue(c);h.setValue(c,b)}h.setSliceCount(a)}};VVVV.Nodes.ModValue.prototype=new VVVV.Core.Node;
VVVV.Nodes.PowerValue=function(a,b){this.constructor(a,"Power (Value)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};this.auto_evaluate=!1;var h=this.addOutputPin("Output",[0],this),g=this.addInvisiblePin("Input Count",[0],this),e=[];this.initialize=function(){for(var a=Math.max(2,g.getValue(0)),c=e.length;c<a;c++)e[c]=this.addInputPin("Input "+(c+1),[1],this);e.length=a};this.evaluate=function(){g.pinIsChanged()&&this.initialize();for(var a=
this.getMaxInputSliceCount(),c=0;c<a;c++){for(var b=e[0].getValue(c),p=1;p<e.length;p++)b=Math.pow(b,e[p].getValue(c));h.setValue(c,b)}h.setSliceCount(a)}};VVVV.Nodes.PowerValue.prototype=new VVVV.Core.Node;
VVVV.Nodes.RandomValue=function(a,b){this.constructor(a,"Random (Value)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};this.auto_evaluate=!0;var h=this.addInputPin("Enabled",[1],this),g=this.addInputPin("Is Integer",[0],this),e=this.addInputPin("Scale",[1],this),d=this.addInputPin("Prevent from doubles",[1],this),c=this.addOutputPin("Output",[0],this);this.evaluate=function(){for(var a=this.getMaxInputSliceCount(),b=0;b<a;b++){var m=
h.getValue(b),l=g.getValue(b),s=e.getValue(b),q=d.getValue(b),n=c.values[b];void 0==n&&c.setValue(b,0);if(0.5<=m){n=c.values[b];do m=Math.random()*s,0.5<=l&&(m=Math.round(m));while(0.5<=q&&m==n);c.setValue(b,m)}}c.setSliceCount(a)}};VVVV.Nodes.RandomValue.prototype=new VVVV.Core.Node;
VVVV.Nodes.SignValue=function(a,b){this.constructor(a,"Sign (Value)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};this.auto_evaluate=!1;var h=this.addInputPin("Input",[0],this),g=this.addOutputPin("Sign Part",[0],this),e=this.addOutputPin("Absolute Part",[0],this);this.evaluate=function(){for(var a=this.getMaxInputSliceCount(),c=0;c<a;c++){var b=h.getValue(c);g.setValue(c,0==b?0:b/Math.abs(b));e.setValue(c,Math.abs(b))}e.setSliceCount(a)}};
VVVV.Nodes.SignValue.prototype=new VVVV.Core.Node;
VVVV.Nodes.InputMorphValue=function(a,b){this.constructor(a,"InputMorph (Value)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};this.auto_evaluate=!1;var h=this.addInputPin("Switch",[0],this),g=this.addOutputPin("Output",[0],this),e=this.addInvisiblePin("Input Count",[0],this),d=[];this.initialize=function(){for(var c=Math.max(2,e.getValue(0)),a=d.length;a<c;a++)d[a]=this.addInputPin("Input "+(a+1),[0],this);d.length=c};this.evaluate=
function(){e.pinIsChanged()&&this.initialize();for(var c=this.getMaxInputSliceCount(),a,b,m,l=0;l<c;l++)a=h.getValue(l),b=((Math.floor(a)+d.length)%d.length+d.length)%d.length,m=((Math.ceil(a)+d.length)%d.length+d.length)%d.length,a-=Math.floor(a),g.setValue(l,(1-a)*d[b].getValue(l)+a*d[m].getValue(l));g.setSliceCount(c)}};VVVV.Nodes.InputMorphValue.prototype=new VVVV.Core.Node;
VVVV.Nodes.Sift=function(a,b){this.constructor(a,"Sift (Value)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};this.auto_evaluate=!1;var h=this.addInputPin("Input",[0],this),g=this.addInputPin("Filter",[0],this),e=this.addInputPin("Epsilon",[0],this),d=this.addInputPin("Find",["First"],this),c=this.addOutputPin("Hits",[0],this),k=this.addOutputPin("Input Index",[0],this),p=this.addOutputPin("Filter Index",[0],this);this.evaluate=function(){this.getMaxInputSliceCount();
var a=h.getSliceCount(),b=g.getSliceCount();c.setSliceCount(a);e.getValue(0);for(var s=d.getValue(0),q={},n=0,t=0;t<a;t++){var v=t;"Last"==s&&(v=a-t-1);var w=h.getValue(v);if("All"!=s){if(q[w]){c.setValue(v,0);continue}q[w]=!0}for(var y=0,r=0;r<b;r++)if(filter=g.getValue(r),filter==w){k.setValue(n,v);p.setValue(n,r);n++;y++;break}c.setValue(v,y)}k.setSliceCount(n);p.setSliceCount(n)}};VVVV.Nodes.Sift.prototype=new VVVV.Core.Node;VVVV.Nodes.Join2dVector=function(a,b){this.constructor(a,"Vector (2d Join)",b);this.meta={authors:["Julien Vulliet"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[""]};var h=this.addInputPin("X",[0],this),g=this.addInputPin("Y",[0],this),e=this.addOutputPin("XY",[0,0],this);this.evaluate=function(){var a=this.getMaxInputSliceCount();e.setSliceCount(2*a);for(var c=0;c<a;c++)e.setValue(2*c,h.getValue(c)),e.setValue(2*c+1,g.getValue(c))}};VVVV.Nodes.Join2dVector.prototype=new VVVV.Core.Node;
VVVV.Nodes.Join3dVector=function(a,b){this.constructor(a,"Vector (3d Join)",b);this.meta={authors:["Julien Vulliet"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[""]};var h=this.addInputPin("X",[0],this),g=this.addInputPin("Y",[0],this),e=this.addInputPin("Z",[0],this),d=this.addOutputPin("XYZ",[0,0,0],this);this.evaluate=function(){var c=this.getMaxInputSliceCount();d.setSliceCount(3*c);for(var a=0;a<c;a++)d.setValue(3*a,h.getValue(a)),d.setValue(3*a+1,g.getValue(a)),d.setValue(3*
a+2,e.getValue(a))}};VVVV.Nodes.Join3dVector.prototype=new VVVV.Core.Node;
VVVV.Nodes.Join4dVector=function(a,b){this.constructor(a,"Vector (4d Join)",b);this.meta={authors:["Julien Vulliet"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[""]};var h=this.addInputPin("X",[0],this),g=this.addInputPin("Y",[0],this),e=this.addInputPin("Z",[0],this),d=this.addInputPin("W",[0],this),c=this.addOutputPin("XYZW",[0,0,0,1],this);this.evaluate=function(){var a=this.getMaxInputSliceCount();c.setSliceCount(4*a);for(var b=0;b<a;b++)c.setValue(4*b,h.getValue(b)),c.setValue(4*
b+1,g.getValue(b)),c.setValue(4*b+2,e.getValue(b)),c.setValue(4*b+3,d.getValue(b))}};VVVV.Nodes.Join4dVector.prototype=new VVVV.Core.Node;
VVVV.Nodes.Split2dVector=function(a,b){this.constructor(a,"Vector (2d Split)",b);this.meta={authors:["Julien Vulliet"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[""]};var h=this.addInputPin("XY",[0],this),g=this.addOutputPin("X",[0],this),e=this.addOutputPin("Y",[0],this);this.evaluate=function(){for(var a=this.getMaxInputSliceCount(),c=0,b=0;b<a;b+=2)g.setValue(c,h.getValue(b)),e.setValue(c,h.getValue(b+1)),c++;g.setSliceCount(c);e.setSliceCount(c)}};
VVVV.Nodes.Split2dVector.prototype=new VVVV.Core.Node;
VVVV.Nodes.Split3dVector=function(a,b){this.constructor(a,"Vector (3d Split)",b);this.meta={authors:["Julien Vulliet"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[""]};var h=this.addInputPin("XYZ",[0],this),g=this.addOutputPin("X",[0],this),e=this.addOutputPin("Y",[0],this),d=this.addOutputPin("Z",[0],this);this.evaluate=function(){for(var c=this.getMaxInputSliceCount(),a=0,b=0;b<c;b+=3)g.setValue(a,h.getValue(b)),e.setValue(a,h.getValue(b+1)),d.setValue(a,h.getValue(b+2)),a++;
g.setSliceCount(a);e.setSliceCount(a);d.setSliceCount(a)}};VVVV.Nodes.Split3dVector.prototype=new VVVV.Core.Node;
VVVV.Nodes.Split4dVector=function(a,b){this.constructor(a,"Vector (4d Split)",b);this.meta={authors:["Julien Vulliet"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[""]};var h=this.addInputPin("XYZW",[0,0,0,1],this),g=this.addOutputPin("X",[0],this),e=this.addOutputPin("Y",[0],this),d=this.addOutputPin("Z",[0],this),c=this.addOutputPin("W",[0],this);this.evaluate=function(){for(var a=this.getMaxInputSliceCount(),b=0,m=0;m<a;m+=4)g.setValue(b,h.getValue(m)),e.setValue(b,h.getValue(m+
1)),d.setValue(b,h.getValue(m+2)),c.setValue(b,h.getValue(m+3)),b++;g.setSliceCount(b);e.setSliceCount(b);d.setSliceCount(b);c.setSliceCount(b)}};VVVV.Nodes.Split4dVector.prototype=new VVVV.Core.Node;VVVV.ShaderCodeResources={};VVVV.Types.ShaderCodeResource=function(){var a="";this.relatedNodes=[];this.definingNode=void 0;this.setSourceCode=function(b){a=b;for(b=0;b<this.relatedNodes.length;b++)this.relatedNodes[b].shaderSourceUpdated(a)};this.addRelatedNode=function(b){this.relatedNodes.push(b);""!=a&&b.shaderSourceUpdated(a)}};var identity=mat4.identity(mat4.create());
VVVV.Types.WebGlRenderState=function(){this.alphaBlending=!0;this.srcBlendMode="SRC_ALPHA";this.destBlendMode="ONE_MINUS_SRC_ALPHA";this.enableZWrite=!0;this.depthFunc="LEQUAL";this.depthOffset=0;this.polygonDrawMode="TRIANGLES";this.copy_attributes=function(a){this.alphaBlending=a.alphaBlending;this.alphaFunc=a.alphaFunc;this.srcBlendMode=a.srcBlendMode;this.destBlendMode=a.destBlendMode;this.enableZwrite=a.enableZWrite;this.depthFunc=a.depthFunc;this.depthOffset=a.depthOffset;this.polygonDrawMode=
a.polygonDrawMode};this.apply=function(a){this.alphaBlending?a.enable(a.BLEND):a.disable(a.BLEND);a.blendFunc(a[this.srcBlendMode],a[this.destBlendMode]);a.depthMask(this.enableZWrite)}};
VVVV.Types.VertexBuffer=function(a,b){this.vbo=void 0;this.subBuffers={};this.length=0;this.setSubBuffer=function(a,b,e){this.subBuffers[a]={usage:a,data:new Float32Array(e),size:b,offset:this.length};this.length+=this.subBuffers[a].data.byteLength};this.setSubBuffer("POSITION",3,b);this.create=function(){this.vbo=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this.vbo);a.bufferData(a.ARRAY_BUFFER,this.length,a.STATIC_DRAW);_(this.subBuffers).each(function(b){a.bufferSubData(a.ARRAY_BUFFER,b.offset,
b.data)})}};VVVV.Types.Mesh=function(a,b,h){this.vertexBuffer=b;this.indexBuffer=a.createBuffer();a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint16Array(h),a.STATIC_DRAW);this.numIndices=h.length};VVVV.Types.Layer=function(){this.mesh=null;this.textures=[];this.shader=null;this.uniforms={};this.uniformNames=[];this.renderState=defaultWebGlRenderState;this.toString=function(){return"Layer"}};
VVVV.PinTypes.WebGlResource={typeName:"WebGlResource",reset_on_disconnect:!0,connectionChangedHandlers:{webglresource:function(){function a(a){return"WebGlResource"==a||"WebGlTexture"==a}if(this.direction!=PinDirection.Input){var b=this.node,h=b.findDownstreamNodes("Renderer (EX9)");b.renderContexts||(b.renderContexts=[]);void 0==b.contextChanged&&(b.contextChanged=!1);for(var g=0;g<h.length;g++)b.contextChanged|=!b.renderContexts[g]||b.renderContexts[g].canvas.id!=h[g].ctxt.id,b.renderContexts[g]=
h[g].ctxt,b.dirty=!0;b.renderContexts.length!=h.length&&(b.renderContexts.length=h.length,b.contextChanged=!0,b.dirty=!0);b.isSubpatch||_(b.inputPins).each(function(e){var d;e.markPinAsChanged();"Renderer (EX9)"!=b.nodename&&e.isConnected()&&(0<e.links.length?d=e.links[0].fromPin:0<e.masterPin.links[0].fromPin.links.length&&(d=e.masterPin.links[0].fromPin),d&&a(d.typeName)&&d.connectionChanged())});this.masterPin&&a(this.masterPin.typeName)&&this.masterPin.connectionChanged()}}},defaultValue:function(){return new VVVV.Types.Layer}};
VVVV.PinTypes.WebGlTexture={typeName:"WebGlTexture",reset_on_disconnect:!0,connectionChangedHandlers:{webglresource:VVVV.PinTypes.WebGlResource.connectionChangedHandlers.webglresource},defaultValue:function(){return VVVV.DefaultTexture}};var defaultWebGlRenderState=new VVVV.Types.WebGlRenderState;VVVV.PinTypes.WebGlRenderState={typeName:"WebGlRenderState",reset_on_disconnect:!0,defaultValue:function(){return defaultWebGlRenderState}};VVVV.DefaultTexture="Empty Texture";
VVVV.Types.ShaderProgram=function(){this.uniformSpecs={};this.attributeSpecs={};this.attribSemanticMap={};this.uniformSemanticMap={};var a="",b="",h,g;this.isSetup=!1;this.shaderProgram=void 0;this.log="";var e=this;this.extractSemantics=function(a){e.attributeSpecs={};e.attribSemanticMap={};e.uniformSpecs={};e.uniformSemanticMap={};for(var c=/(uniform|attribute) ([a-zA-Z]+)([0-9xD]*) ([a-zA-Z0-9_]+)( : ([A-Z0-9]+))?( = \{?([^;\}]+)\}?)?;/g,b;b=c.exec(a);)"attribute"!=b[1]||e.attributeSpecs[b[4]]?
"uniform"!=b[1]||e.uniformSpecs[b[4]]||(e.uniformSpecs[b[4]]={varname:b[4],semantic:b[6],position:0,type:b[2],defaultValue:b[8],dimension:""==b[3]?1:b[3]},void 0!=b[6]&&(e.uniformSemanticMap[b[6]]=b[4])):(e.attributeSpecs[b[4]]={varname:b[4],semantic:b[6],position:0},void 0!=b[6]&&(e.attribSemanticMap[b[6]]=b[4]))};this.setVertexShader=function(b){a=b};this.setFragmentShader=function(a){b=a};this.setup=function(d){this.log="";h=d.createShader(d.VERTEX_SHADER);d.shaderSource(h,a.replace(/((uniform|attribute) [a-zA-Z0-9]+ [a-zA-Z0-9_]+)[^;]*/g,
"$1"));d.compileShader(h);d.getShaderParameter(h,d.COMPILE_STATUS)||(this.log=d.getShaderInfoLog(h),console.log(this.log));g=d.createShader(d.FRAGMENT_SHADER);d.shaderSource(g,b.replace(/((uniform|attribute) [a-zA-Z0-9]+ [a-zA-Z0-9_]+)[^;]*/g,"$1"));d.compileShader(g);d.getShaderParameter(g,d.COMPILE_STATUS)||(this.log=d.getShaderInfoLog(g),console.log(this.log));this.shaderProgram=d.createProgram();d.attachShader(this.shaderProgram,h);d.attachShader(this.shaderProgram,g);d.linkProgram(this.shaderProgram);
d.getProgramParameter(this.shaderProgram,d.LINK_STATUS)||console.log("Could not initialise shaders");_(this.attributeSpecs).each(function(c){c.position=d.getAttribLocation(e.shaderProgram,c.varname)});_(this.uniformSpecs).each(function(c){c.position=d.getUniformLocation(e.shaderProgram,c.varname)});this.isSetup=!0;return""==this.log}};
VVVV.Nodes.FileTexture=function(a,b){this.constructor(a,"FileTexture (EX9.Texture)",b);this.auto_nil=!1;this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:["Always loads in background","No reload pin","No preload pin (preloading handled by browser)","No up and running pin","No texture info outputs"]};this.auto_evaluate=!1;var h=this.addInputPin("Filename",[""],this),g=this.addOutputPin("Texture Out",[],this,VVVV.PinTypes.WebGlTexture),e=[];this.evaluate=
function(){if(this.renderContexts){var a=this.renderContexts[0];if(a){if(h.pinIsChanged()||this.contextChanged){for(var c=this.getMaxInputSliceCount(),b=0;b<c;b++){var p=h.getValue(b);0===p.indexOf("http://")&&void 0!==VVVV.ImageProxyPrefix&&(p=VVVV.ImageProxyPrefix+encodeURI(p));e[b]=a.createTexture();e[b].image=new Image;e[b].image.onload=function(c){return function(){a.bindTexture(a.TEXTURE_2D,e[c]);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,e[c].image);a.texParameteri(a.TEXTURE_2D,
a.TEXTURE_MAG_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST);a.bindTexture(a.TEXTURE_2D,null);g.markPinAsChanged()}}(b);e[b].image.src=p;g.setValue(b,e[b])}g.setSliceCount(c)}this.contextChanged=!1}}}};VVVV.Nodes.FileTexture.prototype=new VVVV.Core.Node;
VVVV.Nodes.DX9Texture=function(a,b){this.constructor(a,"DX9Texture (EX9.Texture)",b);this.auto_nil=!1;this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:["Using WebGL renderer as source doesnt work correctly in Chrome."]};var h=this.addInputPin("Source",[],this,!0,VVVV.PinTypes.WebGlResource),g=this.addOutputPin("Texture Out",[],this,VVVV.PinTypes.WebGlTexture),e;this.evaluate=function(){if(this.renderContexts){var a=this.renderContexts[0];if(a)if(h.isConnected()){var c=
h.getValue(0);c&&(0==(c.width&c.width-1)&&0==(c.height&c.height-1)||console.log("Warning: Source renderer's width/height is not a power of 2. DX9Texture will most likely not work."),c instanceof WebGLTexture?g.setValue(0,c):(void 0==e&&(e=a.createTexture()),a.bindTexture(a.TEXTURE_2D,e),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,c),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.bindTexture(a.TEXTURE_2D,null),
g.setValue(0,e)))}else delete e,a.deleteTexture(e),g.setValue(0,void 0)}}};VVVV.Nodes.DX9Texture.prototype=new VVVV.Core.Node;
VVVV.Nodes.VideoTexture=function(a,b){this.constructor(a,"VideoTexture (EX9.Texture VMR9)",b);this.auto_nil=!1;this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:["Only supports power-of-2 sized videos","Has no output pins for meta data"]};var h=this.addInputPin("Video",[],this,!0),g=this.addOutputPin("Texture Out",[],this,VVVV.PinTypes.WebGlTexture),e;this.evaluate=function(){if(this.renderContexts){var a=this.renderContexts[0];if(a)if(h.isConnected()){var c=
h.getValue(0);0==(c.videoWidth&c.videoWidth-1)&&0==(c.videoHeight&c.videoHeight-1)||console.log("Warning: Video width/height is not a power of 2. VideoTexture will most likely not work.");if(void 0==e||this.contextChanged)e=a.createTexture();a.bindTexture(a.TEXTURE_2D,e);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,c);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST);a.bindTexture(a.TEXTURE_2D,null);g.setValue(0,
e);this.contextChanged=!1}else delete e,a.deleteTexture(e),g.setValue(0,void 0)}}};VVVV.Nodes.VideoTexture.prototype=new VVVV.Core.Node;
VVVV.Nodes.VertexBufferJoin=function(a,b){this.constructor(a,"VertexBuffer (EX9.Geometry Join)",b);this.auto_nil=!1;this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};var h=this.addInputPin("Position XYZ",[0,0,0],this),g=this.addInputPin("Normal XYZ",[0,0,0],this),e=this.addInputPin("Texture Coordinate 0 XY",[0,0],this),d=this.addInputPin("Apply",[1],this),c=this.addOutputPin("Vertex Buffer",[],this,VVVV.PinTypes.WebGlResource),k=null;this.evaluate=
function(){var a=this.renderContexts[0];if(a&&0.5<=d.getValue(0)){for(var b=[],l=[],s=[],q=0;q<this.getMaxInputSliceCount();q++)b[q]=parseFloat(h.getValue(q)),l[q]=parseFloat(e.getValue(q)),s[q]=parseFloat(g.getValue(q));k=new VVVV.Types.VertexBuffer(a,b);k.setSubBuffer("TEXCOORD0",2,l);k.setSubBuffer("NORMAL",3,s);k.create();c.setValue(0,k)}}};VVVV.Nodes.VertexBufferJoin.prototype=new VVVV.Core.Node;
VVVV.Nodes.MeshJoin=function(a,b){this.constructor(a,"Mesh (EX9.Geometry Join)",b);this.auto_nil=!1;this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};var h=this.addInputPin("Vertex Buffer",[],this),g=this.addInputPin("Indices",[0],this),e=this.addInputPin("Apply",[1],this),d=this.addOutputPin("Mesh",[],this,VVVV.PinTypes.WebGlResource),c=null;this.evaluate=function(){var a=this.renderContexts[0];a&&0.5<=e.getValue(0)&&(h.isConnected()?(c=new VVVV.Types.Mesh(a,
h.getValue(0),g.values),d.setValue(0,c)):(d.setValue(0,void 0),delete c))}};VVVV.Nodes.MeshJoin.prototype=new VVVV.Core.Node;
VVVV.Nodes.Grid=function(a,b){this.constructor(a,"Grid (EX9.Geometry)",b);this.auto_nil=!1;this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};var h=this.addInputPin("Resolution X",[2],this),g=this.addInputPin("Resolution Y",[2],this),e=this.addOutputPin("Mesh",[],this,VVVV.PinTypes.WebGlResource),d=null;this.evaluate=function(){if(this.renderContexts){var c=this.renderContexts[0];if(c){for(var a=parseInt(h.getValue(0)),b=parseInt(g.getValue(0)),
m=[],l=[],s=[],q=0,n=0;n<b;n++)for(var t=0;t<a;t++)m.push(parseFloat(t)/(a-1)-0.5),m.push(0.5-parseFloat(n)/(b-1)),m.push(0),q++,l.push(0),l.push(0),l.push(1),s.push(parseFloat(t)/(a-1)),s.push(parseFloat(n)/(b-1));m=new VVVV.Types.VertexBuffer(c,m);m.setSubBuffer("TEXCOORD0",2,s);m.setSubBuffer("NORMAL",3,l);m.create();l=[];for(n=0;n<b-1;n++)for(t=0;t<a-1;t++)s=t+a*n,l.push(s),l.push(s+1),l.push(s+a+1),l.push(s+a+1),l.push(s+a),l.push(s);d=new VVVV.Types.Mesh(c,m,l);e.setValue(0,d)}}}};
VVVV.Nodes.Grid.prototype=new VVVV.Core.Node;
VVVV.Nodes.Sphere=function(a,b){this.constructor(a,"Sphere (EX9.Geometry)",b);this.auto_nil=!1;this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};var h=this.addInputPin("Radius",[0.5],this),g=this.addInputPin("Resolution X",[15],this),e=this.addInputPin("Resolution Y",[15],this),d=this.addOutputPin("Mesh",[],this,VVVV.PinTypes.WebGlResource),c=null;this.evaluate=function(){if(this.renderContexts){var a=this.renderContexts[0];if(a){for(var b=
parseInt(g.getValue(0)),m=parseInt(e.getValue(0)),l=parseFloat(h.getValue(0)),s=[],q=[],n=[],t=0;t<m+1;t++)for(var v=Math.cos(-parseFloat(t)/m*Math.PI),w=0;w<b;w++){var y=Math.cos(2*(parseFloat(w)/b)*Math.PI)*Math.cos(Math.asin(v)),r=Math.sin(2*(parseFloat(w)/b)*Math.PI)*Math.cos(Math.asin(v));s.push(y*l);s.push(v*l);s.push(r*l);q.push(y);q.push(v);q.push(r);n.push(parseFloat(w)/b);n.push(parseFloat(t)/m)}l=new VVVV.Types.VertexBuffer(a,s);l.setSubBuffer("TEXCOORD0",2,n);l.setSubBuffer("NORMAL",3,
q);l.create();q=[];for(t=0;t<m;t++)for(w=0;w<b;w++)n=b*t,s=w+n,q.push(s),q.push((s+1)%b+n),q.push((s+1)%b+b+n),q.push((s+1)%b+b+n),q.push(s+b),q.push(s);c=new VVVV.Types.Mesh(a,l,q);d.setValue(0,c)}}}};VVVV.Nodes.Sphere.prototype=new VVVV.Core.Node;
VVVV.Nodes.Cylinder=function(a,b){this.constructor(a,"Cylinder (EX9.Geometry)",b);this.auto_nil=!1;this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};var h=this.addInputPin("Radius 1",[0.5],this),g=this.addInputPin("Radius 2",[0.5],this),e=this.addInputPin("Length",[1],this),d=this.addInputPin("Cycles",[1],this),c=this.addInputPin("Caps",[1],this),k=this.addInputPin("Resolution X",[15],this),p=this.addInputPin("Resolution Y",[1],this),m=this.addOutputPin("Mesh",
[],this,VVVV.PinTypes.WebGlResource),l=null;this.evaluate=function(){if(this.renderContexts){var a=this.renderContexts[0];if(a){var b=parseInt(k.getValue(0)),n=parseInt(p.getValue(0)),t=parseFloat(h.getValue(0)),v=parseFloat(g.getValue(0)),w=parseFloat(e.getValue(0)),y=parseFloat(d.getValue(0)),r=[],u=[],z=[];r.push(0);r.push(w/2);r.push(0);u.push(0);u.push(1);u.push(0);z.push(0);z.push(0);r.push(0);r.push(-w/2);r.push(0);u.push(0);u.push(-1);u.push(0);z.push(0);z.push(0);for(var D=0;D<n+1;D++)for(var A=
parseFloat(D)/n,G=(A-0.5)*-w,C=0;C<b+1;C++){var J=Math.cos(2*(parseFloat(C)/b)*Math.PI*y-Math.PI*y-Math.PI/2),E=Math.sin(2*(parseFloat(C)/b)*Math.PI*y-Math.PI*y-Math.PI/2),F=A*v+(1-A)*t;r.push(J*F);r.push(G);r.push(E*F);u.push(J);u.push(0);u.push(E);z.push(parseFloat(C)/b);z.push(parseFloat(D)/n)}t=new VVVV.Types.VertexBuffer(a,r);t.setSubBuffer("TEXCOORD0",2,z);t.setSubBuffer("NORMAL",3,u);t.create();u=[];if(0.5<c.getValue(0))for(A=0;2>A;A++)for(C=0;C<b;C++)u.push(A),u.push(2+C+A+A*n*(b+1)),u.push(2+
C+(1-A)+A*n*(b+1));for(D=0;D<n;D++)for(C=0;C<b;C++)A=C+b*D+2,u.push(A),u.push(A+1),u.push(A+b+2),u.push(A+b+2),u.push(A+b+1),u.push(A);l=new VVVV.Types.Mesh(a,t,u);m.setValue(0,l)}}}};VVVV.Nodes.Cylinder.prototype=new VVVV.Core.Node;
VVVV.Nodes.BlendWebGLAdvanced=function(a,b){function h(c){switch(c){case "One":return"ONE";case "Zero":return"ZERO";case "SrcAlpha":return"SRC_ALPHA";case "InvSrcAlpha":return"ONE_MINUS_SRC_ALPHA";case "DestAlpha":return"DST_ALPHA";case "InvDestAlpha":return"ONE_MINUS_DST_ALPHA";case "SrcColor":return"SRC_COLOR";case "InvSrcColor":return"ONE_MINUS_SRC_COLOR";case "DestColor":return"DST_COLOR";case "InvDestColor":return"ONE_MINUS_DST_COLOR"}return null}this.constructor(a,"Blend (EX9.RenderState Advanced)",
b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};var g=this.addInputPin("Render State In",[],this,!0,VVVV.PinTypes.WebGlRenderState),e=this.addInputPin("Alpha Blending",[1],this),d=this.addInputPin("Source Blend Mode",["SrcAlpha"],this,!0,VVVV.PinTypes.Enum),c=this.addInputPin("Destination Blend Mode",["SrcAlpha"],this,!0,VVVV.PinTypes.Enum);d.enumOptions=c.enumOptions="One Zero SrcAlpha InvSrcAlpha DestAlpha InvDestAlpha SrcColor InvSrcColor DestColor InvDestColor".split(" ");
var k=this.addOutputPin("Render State Out",[],this,VVVV.PinTypes.WebGlRenderState),p=[];this.evaluate=function(){for(var a=this.getMaxInputSliceCount(),b=0;b<a;b++)void 0==p[b]&&(p[b]=new VVVV.Types.WebGlRenderState),p[b].copy_attributes(g.getValue(b)),p[b].alphaBlending=0.5<parseFloat(e.getValue(b)),p[b].srcBlendMode=h(d.getValue(b)),p[b].destBlendMode=h(c.getValue(b)),k.setValue(b,p[b]);k.setSliceCount(a)}};VVVV.Nodes.BlendWebGLAdvanced.prototype=new VVVV.Core.Node;
VVVV.Nodes.BlendWebGL=function(a,b){this.constructor(a,"Blend (EX9.RenderState)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:["results differ from VVVV","Multiply mode not supported"]};var h=this.addInputPin("Render State In",[],this,!0,VVVV.PinTypes.WebGlRenderState),g=this.addInputPin("Draw Mode",["Blend"],this,!0,VVVV.PinTypes.Enum);g.enumOptions=["Add","Multiply","Blend","ColorAsAlphaAdd","ColorAsAlphaBlend"];var e=this.addOutputPin("Render State Out",
[],this,VVVV.PinTypes.WebGlRenderState),d=[];this.evaluate=function(){for(var c=this.getMaxInputSliceCount(),a=0;a<c;a++){void 0==d[a]&&(d[a]=new VVVV.Types.WebGlRenderState);d[a].copy_attributes(h.getValue(a));switch(g.getValue(a)){case "Add":d[a].srcBlendMode="SRC_ALPHA";d[a].destBlendMode="ONE";break;case "Multiply":console.log("Multiply Blend Mode not supported (or we just missed it)");case "Blend":d[a].srcBlendMode="SRC_ALPHA";d[a].destBlendMode="ONE_MINUS_SRC_ALPHA";break;case "ColorAsAlphaAdd":d[a].srcBlendMode=
"SRC_COLOR";d[a].destBlendMode="ONE";break;case "ColorAsAlphaBlend":d[a].srcBlendMode="SRC_COLOR",d[a].destBlendMode="ONE_MINUS_SRC_COLOR"}e.setValue(a,d[a])}e.setSliceCount(c)}};VVVV.Nodes.BlendWebGL.prototype=new VVVV.Core.Node;
VVVV.Nodes.FillWebGL=function(a,b){this.constructor(a,"Fill (EX9.RenderState)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:["does not actually draw wireframe, because this is not supported in WebGL, but makes renderer use gl.LINE instead of gl.TRIANGLES when drawing"]};var h=this.addInputPin("Render State In",[],this,!0,VVVV.PinTypes.WebGlRenderState),g=this.addInputPin("Fill Mode",["Solid"],this,!0,VVVV.PinTypes.Enum);g.enumOptions=["Point",
"Solid","WireFrame"];var e=this.addOutputPin("Render State Out",[],this,VVVV.PinTypes.WebGlRenderState),d=[];this.evaluate=function(){for(var a=this.getMaxInputSliceCount(),b=0;b<a;b++){void 0==d[b]&&(d[b]=new VVVV.Types.WebGlRenderState);d[b].copy_attributes(h.getValue(b));switch(g.getValue(b)){case "Point":d[b].polygonDrawMode="POINTS";break;case "Solid":d[b].polygonDrawMode="TRIANGLES";break;case "WireFrame":d[b].polygonDrawMode="LINES"}e.setValue(b,d[b])}e.setSliceCount(a)}};
VVVV.Nodes.FillWebGL.prototype=new VVVV.Core.Node;
VVVV.Nodes.ZWriteEnableWebGL=function(a,b){function h(a){switch(a){case "Never":return"NEVER";case "Less":return"LESS";case "LessEqual":return"LEQUAL";case "Equal":return"EQUAL";case "NotEqual":return"NOTEQUAL";case "Greater":return"GREATER";case "GreaterEqual":return"GEQUAL";case "Always":return"ALWAYS"}return null}this.constructor(a,"ZWriteEnable (EX9.RenderState)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};var g=this.addInputPin("Render State In",
[],this,!0,VVVV.PinTypes.WebGlRenderState),e=this.addInputPin("ZWrite Enable",[1],this),d=this.addInputPin("Compare Function",["Always"],this),c=this.addInputPin("Depth Bias",[0],this),k=this.addOutputPin("Render State Out",[],this,VVVV.PinTypes.WebGlRenderState),p=[];this.evaluate=function(){for(var a=this.getMaxInputSliceCount(),b=0;b<a;b++)void 0==p[b]&&(p[b]=new VVVV.Types.WebGlRenderState),p[b].copy_attributes(g.getValue(b)),p[b].enableZWrite=0.5<parseFloat(e.getValue(b)),p[b].depthFunc=h(d.getValue(b)),
p[b].depthOffset=parseFloat(c.getValue(0)),k.setValue(b,p[b]);k.setSliceCount(a)}};VVVV.Nodes.ZWriteEnableWebGL.prototype=new VVVV.Core.Node;
VVVV.Nodes.GenericShader=function(a,b){this.constructor(a,"GenericShader (EX9.Effect)",b);this.auto_nil=!1;this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};this.shaderFile="";var h=this.addInputPin("Render State",[],this,!0,VVVV.PinTypes.WebGlRenderState),g=this.addInputPin("Mesh",[],this,!0,VVVV.PinTypes.WebGlResource),e=this.addInputPin("Transform",[],this,!0,VVVV.PinTypes.Transform),d=this.addInputPin("Technique",[""],this,!0,VVVV.PinTypes.Enum);
d.enumOptions=[""];this.addOutputPin("Layer",[],this,VVVV.PinTypes.WebGlResource);var c=[],k=null,p,m=!1,l=[],s=this;this.initialize=function(){var a=["Render State","Mesh","Transform","Technique"];_(s.inputPins).each(function(c){0>a.indexOf(c.pinname)&&(c.unvalidated=!0,l.push(c))});void 0==VVVV.ShaderCodeResources[s.shaderFile]?(VVVV.ShaderCodeResources[s.shaderFile]=new VVVV.Types.ShaderCodeResource,VVVV.ShaderCodeResources[s.shaderFile].addRelatedNode(s),$.ajax({url:s.shaderFile.replace("%VVVV%",
VVVV.Root),async:!1,dataType:"text",success:function(a){VVVV.ShaderCodeResources[s.shaderFile].setSourceCode(a)},error:function(){console.log("ERROR: Could not load shader file "+s.shaderFile.replace("%VVVV%",VVVV.Root));VVVV.onNotImplemented("Could not load shader file "+s.shaderFile.replace("%VVVV%",VVVV.Root))}})):VVVV.ShaderCodeResources[s.shaderFile].addRelatedNode(s)};this.shaderSourceUpdated=function(a){p=a;k||(k=new VVVV.Types.ShaderProgram);s.addUniformPins();s.setupShader();_(s.inputPins).each(function(a){a.markPinAsChanged()});
m=!0;this.parentPatch.afterUpdate()};this.addUniformPins=function(){k.extractSemantics(p);for(var a=[],c=0;c<l.length;c++)k.uniformSpecs[l[c].pinname.replace(/ /g,"_")]||(s.removeInputPin(l[c].pinname),a.push(c));for(c=0;c<a.length;c++)l.splice(a[c],1);_(k.uniformSpecs).each(function(a){if("VIEW"!=a.semantic&&"PROJECTION"!=a.semantic&&"WORLD"!=a.semantic){var c=!1,b=VVVV.PinTypes.Generic,e=[];switch(a.type){case "mat":b=VVVV.PinTypes.Transform;c=!0;break;case "sampler":b=VVVV.PinTypes.WebGlTexture;
c=!0;break;default:"COLOR"==a.semantic?(b=VVVV.PinTypes.Color,e=["1.0, 1.0, 1.0, 1.0"]):e=[0],a.defaultValue&&(e="COLOR"!=a.semantic?_(a.defaultValue.split(",")).map(function(a){return parseFloat(a)}):[a.defaultValue])}for(var d=0;d<l.length;d++)if(l[d].pinname==a.varname.replace(/_/g," ")){l[d].dimensions=a.dimension;l[d].typeName!=b.typeName&&(c=l[d].values.slice(),l[d].setType(b),l[d].unvalidated&&("mat"!=a.type&&"sampler"!=a.type||l[d].isConnected())&&(l[d].values=c),l[d].isConnected()&&!l[d].unvalidated&&
(l[d].connectionChanged(),l[d].links[0].destroy()),l[d].unvalidated=!1);return}b=s.addInputPin(a.varname.replace(/_/g," "),e,s,c,b);b.dimensions=a.dimension;l.push(b)}})};this.setupShader=function(){var a=d.getValue(0),a=a.replace(/^\s*/,"").replace(/\s*$/,""),c=RegExp(/(vertex_shader|fragment_shader)\{([^\}]+)\}/g);d.enumOptions=[];for(var b;null!=(b=c.exec(p));)d.enumOptions=d.enumOptions.concat(b[2].replace(/\s/g,"").split(","));d.enumOptions=d.enumOptions.filter(function(a,c,b){return b.indexOf(a)===
c});0==d.enumOptions.length&&d.enumOptions.push("");if(""==a||0>d.enumOptions.indexOf(a))a=d.enumOptions[0],d.setValue(0,a);var e=RegExp("vertex_shader(\\{([a-zA-Z0-9]+,\\s*)*"+a+"(,\\s*[a-zA-Z0-9]+)*\\})?:([\\s\\S]*?)(vertex_shader|fragment_shader)"),c=RegExp("fragment_shader(\\{([a-zA-Z0-9]+,\\s*)*"+a+"(,\\s*[a-zA-Z0-9]+)*\\})?:([\\s\\S]*?)(vertex_shader|fragment_shader)");b=/STARTOFSTRING((\r?\n|.)*?)(vertex_shader|fragment_shader)/.exec("STARTOFSTRING"+p);var g=b[1];void 0==(b=e.exec(p+"\nfragment_shader"))?
console.log("ERROR: No vertex shader code for technique "+a+" found"):(e=b[4],void 0==(b=c.exec(p+"\nfragment_shader"))?console.log("ERROR: No fragment shader code for technique "+a+" found"):(k.setFragmentShader(g+b[4]),k.setVertexShader(g+e)))};this.evaluate=function(){if(this.renderContexts){var a=this.renderContexts[0];if(a&&k){if(!k.isSetup||this.contextChanged||d.pinIsChanged())this.setupShader(),k.setup(a)?VVVV.ShaderCodeResources[s.shaderFile].definingNode&&VVVV.ShaderCodeResources[s.shaderFile].definingNode.showStatus("success",
"Successfully compiled"):VVVV.ShaderCodeResources[s.shaderFile].definingNode&&VVVV.ShaderCodeResources[s.shaderFile].definingNode.showStatus("error",k.log);var b=0;_(this.inputPins).each(function(a){var c=a.getSliceCount();a=a.pinname.replace(/ /g,"_");k.uniformSpecs[a]&&("vec"==k.uniformSpecs[a].type&&"COLOR"!=k.uniformSpecs[a].semantic)&&(c=parseInt(c/k.uniformSpecs[a].dimension));c>b&&(b=c)});g.isConnected()&&void 0!=g.getValue(0)||(b=0);var p=c.length;if(this.contextChanged||m)p=0;b<p&&c.splice(b,
p-b);for(var v=p;v<b;v++)c[v]=new VVVV.Types.Layer,c[v].mesh=g.getValue(0),c[v].shader=k,_(k.uniformSpecs).each(function(a){c[v].uniformNames.push(a.varname);c[v].uniforms[a.varname]={uniformSpec:a,value:void 0}});if(g.pinIsChanged())for(v=0;v<b;v++)c[v].mesh=g.getValue(0);for(v=0;v<b;v++)c[v].shader=k;for(a=0;a<l.length;a++){var w=l[a].pinname.replace(/ /g,"_");if(l[a].pinIsChanged()||p<b)for(v=0;v<b;v++)if("vec"==k.uniformSpecs[w].type){var y="COLOR"==k.uniformSpecs[w].semantic?_(l[a].getValue(v).split(",")).map(function(a){return parseFloat(a)}):
l[a].getValue(v,l[a].dimensions);c[v].uniforms[w].value=new Float32Array(y)}else y=l[a].getValue(v),c[v].uniforms[w].value=y}if(h.pinIsChanged()||p<b)for(a=0;a<b;a++)h.isConnected()?c[a].renderState=h.getValue(a):c[a].renderState=VVVV.DefaultRenderState;if(e.pinIsChanged()||p<b)for(a=0;a<b;a++)p=this.inputPins.Transform.getValue(a),c[a].uniforms[c[a].shader.uniformSemanticMap.WORLD].value=p;this.outputPins.Layer.setSliceCount(b);for(a=0;a<b;a++)this.outputPins.Layer.setValue(a,c[a]);m=this.contextChanged=
!1}}};this.openUIWindow=function(){VVVV.ShaderCodeResources[s.shaderFile].definingNode&&VVVV.ShaderCodeResources[s.shaderFile].definingNode.openUIWindow()}};VVVV.Nodes.GenericShader.prototype=new VVVV.Core.Node;
VVVV.Nodes.Quad=function(a,b){this.constructor(a,"Quad (DX9)",b);this.auto_nil=!1;this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:["No Sampler States","No texture coord mapping","No enable pin","Transprent pixels are discarded by default"]};this.auto_evaluate=!1;var h=this.addInputPin("Render State",[],this,!0,VVVV.PinTypes.WebGlRenderState);this.addInputPin("Transform",[],this,!0,VVVV.PinTypes.Transform);this.addInputPin("Texture",[],this,!0,
VVVV.PinTypes.WebGlTexture);this.addInputPin("Texture Transform",[],this,!0,VVVV.PinTypes.Transform);this.addInputPin("Color",["1.0, 1.0, 1.0, 1.0"],this,!0,VVVV.PinTypes.Color);this.addOutputPin("Layer",[],this,VVVV.PinTypes.WebGlResource);var g=[],e=null,d=null;this.evaluate=function(){if(this.renderContexts){var a=this.renderContexts[0];if(a){if(this.contextChanged){var b=new VVVV.Types.VertexBuffer(a,[0.5,0.5,0,-0.5,0.5,0,0.5,-0.5,0,-0.5,-0.5,0]);b.setSubBuffer("TEXCOORD0",2,[1,0,0,0,1,1,0,1]);
b.create();e=new VVVV.Types.Mesh(a,b,[0,1,2,1,3,2]);b="#ifdef GL_ES\nprecision highp float;\n#endif\n";b+="uniform vec4 col : COLOR = {1.0, 1.0, 1.0, 1.0}; varying vec2 vs2psTexCd; uniform sampler2D Samp0; void main(void) { gl_FragColor = col*texture2D(Samp0, vs2psTexCd); if (gl_FragColor.a==0.0) discard;  }";d=new VVVV.Types.ShaderProgram;d.extractSemantics(b+"attribute vec3 PosO : POSITION; attribute vec2 TexCd : TEXCOORD0; uniform mat4 tW : WORLD; uniform mat4 tV : VIEW; uniform mat4 tP : PROJECTION; uniform mat4 tTex; varying vec2 vs2psTexCd; void main(void) { gl_Position = tP * tV * tW * vec4(PosO, 1.0); vs2psTexCd = (tTex * vec4(TexCd.xy-.5, 0.0, 1.0)).xy+.5; }");
d.setFragmentShader(b);d.setVertexShader("attribute vec3 PosO : POSITION; attribute vec2 TexCd : TEXCOORD0; uniform mat4 tW : WORLD; uniform mat4 tV : VIEW; uniform mat4 tP : PROJECTION; uniform mat4 tTex; varying vec2 vs2psTexCd; void main(void) { gl_Position = tP * tV * tW * vec4(PosO, 1.0); vs2psTexCd = (tTex * vec4(TexCd.xy-.5, 0.0, 1.0)).xy+.5; }");d.setup(a)}a=this.getMaxInputSliceCount();b=g.length;this.contextChanged&&(b=0);a<b&&g.splice(a,b-a);for(var p=b;p<a;p++)g[p]=new VVVV.Types.Layer,
g[p].mesh=e,g[p].shader=d,_(d.uniformSpecs).each(function(a){g[p].uniformNames.push(a.varname);g[p].uniforms[a.varname]={uniformSpec:a,value:void 0}});var m=this.inputPins.Color.pinIsChanged(),l=this.inputPins.Transform.pinIsChanged(),s=this.inputPins.Texture.pinIsChanged(),q=this.inputPins["Texture Transform"].pinIsChanged();if(m||b<a)for(m=0;m<a;m++){var n=this.inputPins.Color.getValue(m),n=_(n.split(",")).map(function(a){return parseFloat(a)});g[m].uniforms.col.value=new Float32Array(n)}if(h.pinIsChanged()||
b<a)for(m=0;m<a;m++)h.isConnected()?g[m].renderState=h.getValue(m):g[m].renderState=VVVV.DefaultRenderState;if(l||b<a)for(m=0;m<a;m++)l=this.inputPins.Transform.getValue(m),g[m].uniforms[g[m].shader.uniformSemanticMap.WORLD].value=l;if(s||b<a)for(m=0;m<a;m++)g[m].uniforms.Samp0.value=this.inputPins.Texture.getValue(m);if(q||b<a)for(m=0;m<a;m++)l=this.inputPins["Texture Transform"].getValue(m),g[m].uniforms.tTex.value=l;this.outputPins.Layer.setSliceCount(a);for(m=0;m<a;m++)this.outputPins.Layer.setValue(m,
g[m]);this.contextChanged=!1}}}};VVVV.Nodes.Quad.prototype=new VVVV.Core.Node;
VVVV.Nodes.Group=function(a,b){this.constructor(a,"Group (EX9)",b);this.auto_nil=!1;this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:[]};var h=[],g=this.addInputPin("Enabled",[1],this),e=this.addInvisiblePin("Layer Template Count",[2],this),d=this.addOutputPin("Layer",[],this,VVVV.PinTypes.WebGlResource);this.initialize=function(){for(var a=e.getValue(0),d=h.length;d<a;d++)h[d]=this.addInputPin("Layer "+(d+1),[],this,!0,VVVV.PinTypes.WebGlResource);
for(d=a;d<h.length;d++)this.removeInputPin(h[d].pinname);h.length=a;b.afterUpdate()};this.evaluate=function(){e.pinIsChanged()&&this.initialize();var a=0;if(0.5<g.getValue(0))for(var b=0;b<h.length;b++)for(var p=0;p<h[b].getSliceCount();p++)d.setValue(a++,h[b].getValue(p));d.setSliceCount(a)}};VVVV.Nodes.Group.prototype=new VVVV.Core.Node;
VVVV.Nodes.RendererWebGL=function(a,b){function h(a){$(a).detach("mousemove");$(a).detach("mousedown");$(a).detach("mouseup");VVVV.MousePositions[a.id]={x:0,y:0,wheel:0,lb:0,mb:0,rb:0};$(a).mousemove(function(b){var c=2*(b.pageX-$(this).offset().left)/$(this).width()-1;b=-(2*(b.pageY-$(this).offset().top)/$(this).height()-1);VVVV.MousePositions._all.x=c;VVVV.MousePositions._all.y=b;VVVV.MousePositions[a.id].x=c;VVVV.MousePositions[a.id].y=b});$(a).bind("mousewheel",function(b){b=b.originalEvent.wheelDelta/
120;VVVV.MousePositions[a.id].wheel+=b;VVVV.MousePositions._all.wheel+=b});$(a).bind("DOMMouseScroll",function(b){b=-b.originalEvent.detail/3;VVVV.MousePositions[a.id].wheel+=b;VVVV.MousePositions._all.wheel+=b});$(a).mousedown(function(b){switch(b.which){case 1:VVVV.MousePositions._all.lb=1;VVVV.MousePositions[a.id].lb=1;break;case 2:VVVV.MousePositions._all.mb=1;VVVV.MousePositions[a.id].mb=1;break;case 3:VVVV.MousePositions._all.rb=1,VVVV.MousePositions[a.id].rb=1}});$(a).mouseup(function(b){switch(b.which){case 1:VVVV.MousePositions._all.lb=
0;VVVV.MousePositions[a.id].lb=0;break;case 2:VVVV.MousePositions._all.mb=0;VVVV.MousePositions[a.id].mb=0;break;case 3:VVVV.MousePositions._all.rb=0,VVVV.MousePositions[a.id].rb=0}})}this.constructor(a,"Renderer (EX9)",b);this.auto_nil=!1;this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:"Disabling Clear doesn't work in Chrome;Backbuffer width and height defined by canvas size;No Fullscreen;No Enable Pin;No Aspect Ration and Viewport transform;No mouse output;No backbuffer dimesions output;No WebGL (EX9) Output Pin".split(";")};
this.addInputPin("Layers",[],this,!0,VVVV.PinTypes.WebGlResource);var g=this.addInputPin("Clear",[1],this),e=this.addInputPin("Background Color",["0.0, 0.0, 0.0, 1.0"],this,!0,VVVV.PinTypes.Color),d=this.addInputPin("Backbuffer Width",[0],this),c=this.addInputPin("Backbuffer Height",[0],this),k=this.addInputPin("View",[],this,!0,VVVV.PinTypes.Transform),p=this.addInputPin("Projection",[],this,!0,VVVV.PinTypes.Transform),m=this.addInvisiblePin("Windowed Depthbuffer Format",["NONE"],this,VVVV.PinTypes.Enum);
m.enumOptions=["NONE","DX16"];var l=this.addOutputPin("Actual Backbuffer Width",[0],this),s=this.addOutputPin("Actual Backbuffer Height",[0],this),q=this.addOutputPin("EX9 Out",[],this,VVVV.PinTypes.WebGlResource),n=0,t=0,v,w,y=this.ctxt=void 0,r,u,z;this.getContexts=function(){if(this.invisiblePins["Descriptive Name"]){var a=this.invisiblePins["Descriptive Name"].getValue(0),a=$(a).get(0),b;if(a&&"CANVAS"==a.nodeName)b=$(a);else{b=parseInt(d.getValue(0));var l=parseInt(c.getValue(0));b=$('<canvas width="'+
(0<b?b:512)+'" height="'+(0<l?l:512)+'" id="vvvv-js-generated-renderer-'+(new Date).getTime()+'" class="vvvv-js-generated-renderer"></canvas>');a||(a="body");$(a).append(b)}if(b){h(b);try{y=b.get(0).getContext("experimental-webgl",{preserveDrawingBuffer:!0}),y.viewportWidth=parseInt(b.get(0).width),y.viewportHeight=parseInt(b.get(0).height)}catch(m){console.log(m)}this.ctxt=y;q.isConnected()&&this.renderContexts&&this.renderContexts[0]?(r=this.ctxt=this.renderContexts[0],u=r.createFramebuffer(),r.bindFramebuffer(r.FRAMEBUFFER,
u),u.width=b.get(0).width,u.height=b.get(0).height,z=r.createTexture(),r.bindTexture(r.TEXTURE_2D,z),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!0),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR_MIPMAP_NEAREST),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,u.width,u.height,0,r.RGBA,r.UNSIGNED_BYTE,null),r.generateMipmap(r.TEXTURE_2D),a=r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,a),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,
u.width,u.height),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,z,0),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,a),r.bindTexture(r.TEXTURE_2D,null),r.bindRenderbuffer(r.RENDERBUFFER,null),r.bindFramebuffer(r.FRAMEBUFFER,null)):this.renderContexts&&this.renderContexts[0]&&(this.renderContexts[0].deleteTexture(z),z=void 0);this.ctxt&&(n=parseInt(b.get(0).width),t=parseInt(b.get(0).height),r=this.ctxt,a=new Uint8Array([255,255,255]),r.DefaultTexture=
r.createTexture(),r.bindTexture(r.TEXTURE_2D,r.DefaultTexture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.pixelStorei(r.UNPACK_ALIGNMENT,1),r.texImage2D(r.TEXTURE_2D,0,r.RGB,1,1,0,r.RGB,r.UNSIGNED_BYTE,a),r.bindTexture(r.TEXTURE_2D,null),this.inputPins.Layers.markPinAsChanged(),g.markPinAsChanged(),
e.markPinAsChanged(),k.markPinAsChanged(),p.markPinAsChanged())}}};var D=!1;this.evaluate=function(){r=this.ctxt;if(this.invisiblePins["Descriptive Name"].pinIsChanged()||this.contextChanged)y&&$(y.canvas).hasClass("vvvv-js-generated-renderer")&&$(y.canvas).remove(),this.getContexts(),this.inputPins.Layers.isConnected()&&this.inputPins.Layers.links[0].fromPin.connectionChanged();D||(l.setValue(0,n),s.setValue(0,t),D=!0);if(void 0!=r){if(d.pinIsChanged()&&(!this.renderContexts||!this.renderContexts[0])){var a=
parseInt(d.getValue(0));0<a&&(n=a,$(y.canvas).attr("width",n),l.setValue(0,n))}!c.pinIsChanged()||this.renderContexts&&this.renderContexts[0]||(a=parseInt(c.getValue(0)),0<a&&(t=a,$(y.canvas).attr("height",t),s.setValue(0,t)));this.renderContexts&&this.renderContexts[0]&&r==this.renderContexts[0]?r.bindFramebuffer(r.FRAMEBUFFER,u):r.bindFramebuffer(r.FRAMEBUFFER,null);a=_(e.getValue(0).split(",")).map(function(a){return parseFloat(a)});r.clearColor(a[0],a[1],a[2],a[3]);r.clear(r.COLOR_BUFFER_BIT|
r.DEPTH_BUFFER_BIT);"NONE"==m.getValue(0)?r.disable(r.DEPTH_TEST):r.enable(r.DEPTH_TEST);p.pinIsChanged()&&(p.isConnected()?(v=mat4.create(),mat4.set(p.getValue(0),v)):(v=mat4.create(),mat4.ortho(-1,1,-1,1,-100,100,v)),mat4.scale(v,[1,1,-1]),this.renderContexts&&this.renderContexts[0]&&mat4.scale(v,[1,-1,1]));k.pinIsChanged()&&(w=k.getValue(0));if(this.contextChanged)this.contextChanged=!1;else{r.viewport(0,0,n,t);var b=a=null,g=null;if(this.inputPins.Layers.isConnected())for(var h=this.inputPins.Layers.values,
E=0;E<h.length;E++)if(layer=h[E],void 0!=layer.shader){a!=layer.shader.shaderProgram&&(r.useProgram(layer.shader.shaderProgram),r.uniformMatrix4fv(layer.shader.uniformSpecs[layer.shader.uniformSemanticMap.PROJECTION].position,!1,v),r.uniformMatrix4fv(layer.shader.uniformSpecs[layer.shader.uniformSemanticMap.VIEW].position,!1,w));var F=layer.renderState;F||(F=defaultWebGlRenderState);F!=b&&F.apply(r);if(layer.mesh!=g||layer.shader.shaderProgram!=a)r.bindBuffer(r.ARRAY_BUFFER,layer.mesh.vertexBuffer.vbo),
_(layer.mesh.vertexBuffer.subBuffers).each(function(a){layer.shader.attributeSpecs[layer.shader.attribSemanticMap[a.usage]]&&(r.enableVertexAttribArray(layer.shader.attributeSpecs[layer.shader.attribSemanticMap[a.usage]].position),r.vertexAttribPointer(layer.shader.attributeSpecs[layer.shader.attribSemanticMap[a.usage]].position,a.size,r.FLOAT,!1,0,a.offset))}),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,layer.mesh.indexBuffer);for(var b=layer.uniformNames.length,H=g=0;H<b;H++){var B=layer.uniforms[layer.uniformNames[H]];
if(void 0!=B.value&&!(0<E&&layer.shader.shaderProgram==a&&h[E-1].uniforms[layer.uniformNames[H]]&&B.value==h[E-1].uniforms[layer.uniformNames[H]].value)){start=(new Date).getTime();switch(B.uniformSpec.type){case "mat":r["uniformMatrix"+B.uniformSpec.dimension+"fv"](B.uniformSpec.position,!1,B.value);break;case "vec":r["uniform"+B.uniformSpec.dimension+"fv"](B.uniformSpec.position,B.value);break;case "int":r["uniform"+B.uniformSpec.dimension+"i"](B.uniformSpec.position,B.value);break;case "float":r["uniform"+
B.uniformSpec.dimension+"f"](B.uniformSpec.position,B.value);break;case "sampler":var I=B.value;I==VVVV.DefaultTexture&&(I=r.DefaultTexture);r.activeTexture(r["TEXTURE"+g]);r.bindTexture(r["TEXTURE_"+B.uniformSpec.dimension],I);r.uniform1i(B.uniformSpec.position,g);g++}loopstart=(new Date).getTime()}}r.drawElements(r[F.polygonDrawMode],layer.mesh.numIndices,r.UNSIGNED_SHORT,0);a=layer.shader.shaderProgram;b=F;g=layer.mesh}this.renderContexts&&this.renderContexts[0]&&(r.bindTexture(r.TEXTURE_2D,z),
r.generateMipmap(r.TEXTURE_2D),r.bindTexture(this.renderContexts[0].TEXTURE_2D,null));q.setValue(0,z)}}}};VVVV.Nodes.RendererWebGL.prototype=new VVVV.Core.Node;
VVVV.Nodes.DefineEffect=function(a,b){this.constructor(a,"DefineEffect (DX9)",b);this.auto_nil=!1;this.meta={authors:["Matthias Zauner"],original_authors:["Matthias Zauner"],credits:[],compatibility_issues:["Not available in classic VVVV"]};this.auto_evaluate=!1;var h=this.addInputPin("Effect Descriptor",[""],this),g=this.addInvisiblePin("Source Code",["#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 tW : WORLD;\nuniform mat4 tV : VIEW;\nuniform mat4 tP : PROJECTION;\n\nuniform vec4 Color : COLOR = {1.0, 1.0, 1.0, 1.0};\nuniform sampler2D Texture;\nuniform mat4 Texture_Transform;\nuniform float Alpha = 1.0;\n\nvarying vec2 vs2psTexCd;\n\nvertex_shader:\n\nattribute vec3 PosO : POSITION;\nattribute vec2 TexCd : TEXCOORD0;\n\nvoid main(void) {\n  gl_Position = tP * tV * tW * vec4(PosO, 1.0);\n  vs2psTexCd = (Texture_Transform * vec4(TexCd, 0, 1)).xy;\n}\n\n\nfragment_shader:\n\nvoid main(void) {\n  gl_FragColor = Color * texture2D(Texture, vs2psTexCd) * vec4(1.0, 1.0, 1.0, Alpha);\n}"],
this),e="",d;this.evaluate=function(){if(""!=h.getValue(0)){if(h.pinIsChanged()){var a=h.getValue(0);if(""==a)return;""==e?void 0==VVVV.ShaderCodeResources["./"+a+".vvvvjs.fx"]&&(VVVV.ShaderCodeResources["./"+a+".vvvvjs.fx"]=new VVVV.Types.ShaderCodeResource):VVVV.ShaderCodeResources["./"+a+".vvvvjs.fx"]=VVVV.ShaderCodeResources[e];e="./"+a+".vvvvjs.fx";VVVV.ShaderCodeResources[e].definingNode=this;VVVV.ShaderCodeResources[e].setSourceCode(g.getValue(0));d&&$("#path",d.document).text((this.parentPatch.nodename||
"root")+" / "+(""!=e?e:"Untitled"))}g.pinIsChanged()&&VVVV.ShaderCodeResources[e]&&VVVV.ShaderCodeResources[e].setSourceCode(g.getValue(0))}};this.openUIWindow=function(){d=window.open("code_editor.html",e+" / VVVV.js Effect Editor","location=no, width=800, height=800, toolbar=no");var a=this;window.setTimeout(function(){d.document.title=e+" / VVVV.js Effect Editor";var b=a.parentPatch.nodename||"root",h=""!=e?e:"Untitled";$("#path",d.document).text(b+" / "+h);$("textarea",d.document).text(g.getValue(0));
$("#compile_button",d.document).click(function(){""==e?a.showStatus("error","Please provide a name for this shader first"):(g.setValue(0,$("textarea",d.document).val()),0<VVVV.ShaderCodeResources[e].relatedNodes.length?a.showStatus("notice","Compiling ..."):a.showStatus("notice","No instance of this shader found. Create a node (./"+e+") and connect it to a Renderer (EX9) to compile."))});d.focus()},500)};this.showStatus=function(a,b){d&&($("#status",d.document).text(b),$("#status",d.document).attr("class",
a))}};VVVV.Nodes.DefineEffect.prototype=new VVVV.Core.Node;VVVV.Nodes.XPathXML=function(a,b){this.constructor(a,"XPath (XML)",b);this.meta={authors:["Matthias Zauner"],original_authors:["VVVV Group"],credits:[],compatibility_issues:["XML Index Output Pin not implemented","Query Index Output Pin not implemented"]};this.auto_evaluate=!1;var h=this.addInputPin("XML Input",["text"],this),g=this.addInputPin("XPath Query",["text"],this),e=this.addInputPin("Base Element",["text"],this),d=this.addOutputPin("Output",["text"],this),c=this.addOutputPin("XML Index",
[0],this),k=this.addOutputPin("Query Index",[0],this),p;this.evaluate=function(){var a=h.getValue(0),b=g.getValue(0);e.getValue(0);h.pinIsChanged()&&(p=(new DOMParser).parseFromString(a,"text/xml"));for(var a=p.evaluate(b,p,null,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null),b=0,s;s=a.iterateNext();)s.value?d.setValue(b,s.value):s.data?d.setValue(b,s.data):d.setValue(b,""),b++;c.setValue(b,0);k.setValue(b,0);d.setSliceCount(b);c.setSliceCount(1);k.setSliceCount(1)}};VVVV.Nodes.XPathXML.prototype=new VVVV.Core.Node;var UIState={Idle:0,Connecting:1,Moving:2,Creating:3,Changing:4,AreaSelecting:5};VVVV.PinTypes.Generic.makeLabel=function(a,b){var h=b.IOBoxRows();b.IOBoxInputPin().getSliceCount();d3.select(a).selectAll(".vvvv-node-label").remove();for(var g=0;g<h;g++)d3.select(a).append("svg:text").text(b.IOBoxInputPin().getValue(g)).attr("class","vvvv-node-label").attr("shape-rendering","crispEdges").attr("dy",function(a){return 12*g+12}).attr("dx",4).attr("font-size",10).attr("font-family","Lucida Sans Unicode")};
VVVV.PinTypes.Generic.openInputBox=function(a,b,h,g){$inputbox=$("<input type='text' value='"+h.getValue(g)+"' class='pininputbox value resettable'/>");$inputbox.css("position",b.css("position"));$inputbox.css("width",b.css("width"));$inputbox.css("height",b.css("height"));$inputbox.css("left",b.css("left"));$inputbox.css("top",b.css("top"));b.replaceWith($inputbox);$inputbox.get(0).select();$inputbox.change(function(){h.setValue(g,$(this).val());h.node.parentPatch.editor.update(h.node.parentPatch.nodename,
"<PATCH><NODE id='"+h.node.id+"'><PIN pinname='"+h.pinname+"' values='"+_(h.values).map(function(a){return"|"+a+"|"}).join(",")+"'/></NODE>")});$inputbox.keydown(function(a){13==a.which&&($(this).change(),$(this).remove())});$inputbox.bind("mousewheel",function(a){var b=a.originalEvent.wheelDelta/120,c=$(this).val()%1;if(!isNaN(c)){var g;g=1;if(a.altKey||0!==c)g=0.01;b=(0<b?1:-1)*g;$(this).val(parseFloat($(this).val())+b);$(this).change()}a.preventDefault();return!1});$inputbox.bind("DOMMouseScroll",
function(a){var b=-a.originalEvent.detail/3,c=$(this).val()%1;isNaN(c)||(b=0<b?1:-1,0!==c&&(b/=100),$(this).val(parseFloat($(this).val())+b),$(this).change());a.preventDefault();return!1});$inputbox.bind("paste",function(a){a.stopPropagation()});$inputbox.bind("copy",function(a){a.stopPropagation()})};
VVVV.PinTypes.Enum.openInputBox=function(a,b,h,g){$inputbox=$("<select class='pininputbox value resettable'>");for(a=0;a<h.enumOptions.length;a++)$opt=$('<option value="'+h.enumOptions[a]+'">'+h.enumOptions[a]+"</option>"),h.getValue(g)==h.enumOptions[a]&&$opt.attr("selected",!0),$inputbox.append($opt);$inputbox.css("position",b.css("position"));$inputbox.css("width",b.css("width"));$inputbox.css("height",b.css("height"));$inputbox.css("left",b.css("left"));$inputbox.css("top",b.css("top"));b.replaceWith($inputbox);
$inputbox.change(function(){h.setValue(g,$(this).val());h.node.parentPatch.editor.update(h.node.parentPatch.nodename,"<PATCH><NODE id='"+h.node.id+"'><PIN pinname='"+h.pinname+"' values='"+_(h.values).map(function(a){return"|"+a+"|"}).join(",")+"'/></NODE>")})};
VVVV.PinTypes.Color.makeLabel=function(a,b){var h=b.IOBoxRows();b.IOBoxInputPin().getSliceCount();d3.select(a).selectAll(".vvvv-node-label").remove();for(var g=0;g<h;g++)d3.select(a).append("svg:rect").attr("class","vvvv-node-label").attr("height",b.getHeight()/h-8).attr("width",b.getWidth()).attr("y",12*g+4).attr("fill",function(a){a=b.IOBoxInputPin().getValue(g).split(",");for(var d=0;d<a.length;d++)a[d]=parseInt(256*a[d]);return"rgba("+a.join(",")+")"})};
VVVV.PinTypes.Color.openInputBox=function(a,b,h,g){function e(a){d=a.altKey&&a.shiftKey?3:a.altKey?1:a.shiftKey?2:0}var d=0;$(a.window.document).keydown(e).keyup(e);$inputbox=$('<div class="pininputbox color resettable"></div>');$inputbox.css("position",b.css("position"));$inputbox.css("width",b.css("width"));$inputbox.css("height",b.css("height"));$inputbox.css("left",b.css("left"));$inputbox.css("top",b.offset().top-8+"px");a=h.getValue(g).split(",");for(var c=0;c<a.length;c++)a[c]=parseInt(256*
a[c]);$inputbox.css("background-color","rgba("+a.join(",")+")");b.replaceWith($inputbox);$inputbox.on("mousewheel",function(a){var b=a.originalEvent.wheelDelta/120,c=h.getValue(g).split(","),e=VVVV.PinTypes.Color.rgbToHsv(c[0],c[1],c[2]);e[3]=parseFloat(c[3]);c=0.01;0>b&&(c=-0.01);e[d]+=c;0!=d&&(e[d]=Math.min(1,Math.max(0,e[d])));c=VVVV.PinTypes.Color.hsvToRgb(e[0],e[1],e[2]);c[3]=e[3];$inputbox.css("background-color","rgba("+_(c).map(function(a){return parseInt(255*a)}).join(",")+")");ibx=$inputbox;
c.join(",");h.setValue(g,c.join(","));h.node.parentPatch.editor.update(h.node.parentPatch.nodename,"<PATCH><NODE id='"+h.node.id+"'><PIN pinname='"+h.pinname+"' values='"+_(h.values).map(function(a){return"|"+a+"|"}).join(",")+"'/></NODE>");a.preventDefault();return!1})};VVVV.Editors.BrowserEditor={};
VVVV.Editors.BrowserEditor.PatchWindow=function(a,b){var h;function g(){c.selectAll(".vvvv-node.selected").attr("class",function(a){return a.isIOBox?"vvvv-node vvvv-iobox":"vvvv-node"});q=[]}this.state=UIState.Idle;var e=0,d=0,c,k,p,m,l,s=void 0,q=[],n=a,t=0,v=VVVV.Root+"/patch.html";h=!1;var w=0,y=0,r=0,u=0;a.isSubpatch&&(v="patch.html");this.window=window.open(v,a.nodename,"location=no, width="+a.width+", height="+a.height+", toolbar=no");var z=this;window.setTimeout(function(){function l(a){h=
a.shiftKey}for(var m=0;m<n.nodeList.length;m++)t=Math.max(t,n.nodeList[m].id);z.window.document.title=a.nodename;root=d3.select(z.window.document.body);$("body",z.window.document).on("copy",function(a){for(var b=$("<PATCH>"),c=[],d=_(q).map(function(a){return a.id}),e=0;e<q.length;e++)b.append(q[e].serialize()),_(q[e].inputPins).each(function(a){for(var b=0;b<a.links.length;b++)0<=d.indexOf(a.links[b].fromPin.node.id)&&c.push(a.links[b])});for(e=0;e<c.length;e++)b.append(c[e].serialize());b='<!DOCTYPE PATCH  SYSTEM "http://vvvv.org/versions/vvvv45beta28.1.dtd" >\r\n'+
b.wrapAll("<d></d>").parent().html();b=b.replace(/<patch/g,"<PATCH");b=b.replace(/<\/patch>/g,"\n  </PATCH>");b=b.replace(/<node/g,"\n  <NODE");b=b.replace(/<\/node>/g,"\n  </NODE>");b=b.replace(/<bounds/g,"\n  <BOUNDS");b=b.replace(/<\/bounds>/g,"\n  </BOUNDS>");b=b.replace(/<pin/g,"\n  <PIN");b=b.replace(/<\/pin>/g,"\n  </PIN>");b=b.replace(/<lonk/g,"\n  <LINK");b=b.replace(/<\/lonk>/g,"\n  </LINK>");a.originalEvent.clipboardData.setData("text/plain",b);a.preventDefault();return!1});var p=0,v=0;
$("body",z.window.document).mousemove(function(a){p=a.pageX;v=a.pageY});$("body",z.window.document).on("paste",function(a){a=a.originalEvent.clipboardData.getData("text/plain");if(!a.match(/^<!DOCTYPE PATCH/))return!1;$patch=$(a);var d=void 0,e=void 0;$patch.find("node bounds").each(function(){var a=parseInt($(this).attr("left")),b=parseInt($(this).attr("top"));if(!d||a<d)d=a;if(!e||b<e)e=b});var h={};$patch.find("node").each(function(){t++;h[$(this).attr("id")]=t;$(this).attr("createme","pronto");
$(this).attr("id",t);var a=parseInt($(this).find("bounds").attr("left"))-d+15*p,b=parseInt($(this).find("bounds").attr("top"))-e+15*v;$(this).find("bounds").attr("left",a);$(this).find("bounds").attr("top",b)});$patch.find("link").each(function(){$(this).attr("createme","pronto");var a=$(this).attr("srcnodeid"),b=$(this).attr("dstnodeid");$(this).attr("srcnodeid",h[a]);$(this).attr("dstnodeid",h[b])});a=$patch.wrapAll("<d></d>").parent().html();b.update(n.nodename,a);g();var k=_(h).map(function(a){return a});
c.selectAll(".vvvv-node").each(function(a){0<=k.indexOf(parseInt(a.id))&&(q.push(a),d3.select(this).attr("class","vvvv-node selected"))})});c=root.append("svg:svg").attr("class","chart").attr("width",Math.max(n.width,n.boundingBox.width)).attr("height",Math.max(n.height,n.boundingBox.height)).on("mousemove",function(){if(z.state==UIState.Connecting)c.select(".vvvv-link.current-link").attr("x2",function(a){return d3.event.pageX+(d3.select(this).attr("x1")<d3.event.pageX?-1:1)}).attr("y2",function(a){return d3.event.pageY+
(d3.select(this).attr("y1")<d3.event.pageY?-1:1)});else if(z.state==UIState.Moving){var a=d3.event.pageX-e,b=d3.event.pageY-d;c.selectAll(".vvvv-node.selected").attr("transform",function(c){return"translate("+(c.x+a)+","+(c.y+b)+")"});for(var h=0;h<q.length;h++){var k=q[h];c.selectAll(".vvvv-link line").filter(function(a){return a.fromPin.node.id==k.id}).attr("x1",function(b){return b.fromPin.x+b.fromPin.node.x+a}).attr("y1",function(a){return a.fromPin.y+a.fromPin.node.y+b});c.selectAll(".vvvv-link line").filter(function(a){return a.toPin.node.id==
k.id}).attr("x2",function(b){return b.toPin.x+b.toPin.node.x+a}).attr("y2",function(a){return a.toPin.y+a.toPin.node.y+b})}}else z.state==UIState.AreaSelecting&&(r=d3.event.x,u=d3.event.y,c.select(".selection-area").attr("transform","translate("+Math.min(w,r)+", "+Math.min(y,u)+")").attr("width",Math.abs(r-w)).attr("height",Math.abs(u-y)),g(),c.selectAll(".vvvv-node").each(function(a){for(var b=[a.x,a.x+a.getWidth()],c=[a.y,a.y+a.getHeight()],d=!1,e=0;2>e;e++)for(var g=0;2>g;g++)b[e]>=Math.min(w,
r)&&(b[e]<=Math.max(w,r)&&c[g]>=Math.min(y,u)&&c[g]<=Math.max(y,u))&&(d=!0);d&&(d3.select(this).attr("class","vvvv-node selected"),q.push(a))}))}).on("contextmenu",function(){z.state==UIState.Connecting&&(c.select(".vvvv-link.current-link").remove(),z.state=UIState.Idle);d3.event.stopPropagation();d3.event.preventDefault();return!1}).on("mouseup",function(){if(z.state==UIState.Moving){z.state=UIState.Idle;for(var a=d3.event.pageX-e,g=d3.event.pageY-d,h="<PATCH>",k=0;k<q.length;k++)var l=q[k],h=h+
("<NODE componentmode='Node' id='"+l.id+"'><BOUNDS type='Node' left='"+15*(a+l.x)+"' top='"+15*(g+l.y)+"' width='"+l.width+"' height='"+l.height+"'/></NODE>");b.update(n.nodename,h+"</PATCH>")}z.state==UIState.AreaSelecting&&(c.select(".selection-area").remove(),z.state=UIState.Idle)}).on("dblclick",function(){function a(b){h.empty();var c=g.find("#node_filter").val().toLowerCase();b=VVVV.NodeNames.concat(_(VVVV.ShaderCodeResources).map(function(a,b){return b.replace("%VVVV%/effects/","")}));b=_(_(b).filter(function(a){return 0<=
VVVV.translateOperators(a).toLowerCase().indexOf(c)})).sortBy(function(a){return a.toLowerCase().indexOf(c)});for(var d=0;d<b.length;d++)h.append($("<option>"+b[d]+"</option>"));h.find("option").first().attr("selected",!0)}function c(){var a=g.find("#node_filter").val(),h=g.find("#new_node option:selected").val(),k="";h||!a.match(/\.fx$/)&&!a.match(/\.v4p$/)||(h=a);h?((a=h.match(/^(.*\/([^\.]+))(\.vvvvjs)?\.fx$/))?(h=a[2]+" (EX9.Effect)",k=a[1]+".fx"):(a=h.match("([^.]+)(.vvvvjs)?.fx$"))?(h=a[1]+
" (EX9.Effect)",k="%VVVV%/effects/"+a[1]+".fx"):h.match("[^/].v4p$")&&(k=h=f),t++,h="<PATCH>"+("<NODE componentmode='Hidden' id='"+t+"' nodename='"+h+"' systemname='"+h+"' "+(""!=k?"filename='"+k+"'":"")+">"),h+="<BOUNDS type='Node' left='"+15*d+"' top='"+15*e+"' width='100' height='100'/>"):(t++,h="<PATCH>"+("<NODE componentmode='Hidden' id='"+t+"' nodename='IOBox (String)' systemname='IOBox (String)'>"),h+="<BOUNDS type='Node' left='"+15*d+"' top='"+15*e+"' width='100' height='100'/>",h+="<PIN pinname='Input String' values='|"+
a+"|'/>");b.update(n.nodename,h+"</NODE>");g.remove()}$("#node_selection",z.window.document).remove();var d=d3.event.pageX,e=d3.event.pageY,g=$('<div id="node_selection"><input type="text" id="node_filter"/></div>'),h=$('<select id="new_node" size="8">');g.append(h);g.css("left",d);g.css("top",e);$("body",z.window.document).append(g);g.find("input").bind("paste",function(a){a.stopPropagation()});g.find("#node_filter").get(0).focus();a();g.find("#node_filter").keyup(function(b){if(13==b.which)c();
else{if(40==b.which)return h.find("option:selected").first().next().attr("selected",!0),!1;if(38==b.which)return h.find("option:selected").first().prev().attr("selected",!0),!1;a()}});g.find("#new_node").click(c)}).on("mousedown",function(){z.state==UIState.Idle&&(z.state=UIState.AreaSelecting,w=r=d3.event.x+1,y=u=d3.event.y+1,c.append("svg:rect").attr("class","selection-area").attr("stroke","#000").attr("stroke-dasharray","2,2").attr("stroke-width",1).attr("fill","rgba(0,0,0,0)").attr("transform",
"translate("+w+", "+y+")").attr("width",0).attr("height",0),g())});c.append("svg:rect").attr("class","background").attr("width",Math.max(n.width,n.boundingBox.width)).attr("height",Math.max(n.height,n.boundingBox.height)).on("click",function(){z.state=UIState.Idle;$(".resettable",z.window.document).remove();$("#node_selection",z.window.document).remove();g();s=void 0});$(z.window.document).keydown(l);$(z.window.document).keyup(l);$(z.window.document).keydown(function(a){if(46==a.which&&0<q.length){var d=
"<PATCH>";for(a=0;a<q.length;a++){var e=q[a],d=d+("<NODE id='"+q[a].id+"' deleteme='pronto'/>");_(e.inputPins).each(function(a){_(a.links).each(function(a){d+="<LINK deleteme='pronto' srcnodeid='"+a.fromPin.node.id+"' srcpinname='"+a.fromPin.pinname+"' dstnodeid='"+a.toPin.node.id+"' dstpinname='"+a.toPin.pinname+"'/>"})});_(e.outputPins).each(function(a){_(a.links).each(function(a){d+="<LINK deleteme='pronto' srcnodeid='"+a.fromPin.node.id+"' srcpinname='"+a.fromPin.pinname+"' dstnodeid='"+a.toPin.node.id+
"' dstpinname='"+a.toPin.pinname+"'/>"})})}d+="</PATCH>";b.update(n.nodename,d);q=[]}else if(115!=a.which&&83!=a.which||!a.ctrlKey){if(73==a.which&&a.ctrlKey)return b.inspector?b.inspector.win.focus():b.openInspector("."),a.preventDefault(),!1;if(65==a.which&&a.ctrlKey)return g(),c.selectAll(".vvvv-node").each(function(a){q.push(a);d3.select(this).attr("class","vvvv-node selected")}),a.preventDefault(),!1}else return b.save(n.nodename,n.toXML()),a.preventDefault(),!1});$(z.window).resize(function(){n.width=
$(this).width();n.height=$(this).height();n.boundingBox.width=Math.max(n.width,n.boundingBox.width);n.boundingBox.height=Math.max(n.height,n.boundingBox.height);n.afterUpdate()});z.drawComplete();n.afterUpdate=function(){z.drawComplete();b.inspector&&window.setTimeout(b.inspector.update,100)};n.afterEvaluate=function(){k.filter(function(a){return a.isIOBox&&VVVV.PinTypes[a.IOBoxInputPin().typeName].makeLabel}).each(function(a){VVVV.PinTypes[a.IOBoxInputPin().typeName].makeLabel(this,a)})}},1E3);this.close=
function(){this.window.close()};this.drawComplete=function(){k&&k.remove();l&&l.remove();n.width==$(z.window).width()&&n.height==$(z.window).height()||z.window.resizeTo(n.width,n.height);c.attr("width",Math.max(n.width,n.boundingBox.width)).attr("height",Math.max(n.height,n.boundingBox.height));c.selectAll(".background").attr("width",Math.max(n.width,n.boundingBox.width)).attr("height",Math.max(n.height,n.boundingBox.height));var a=c.append("svg:g").attr("class","link-group");k=c.selectAll("g.vvvv-node").data(n.nodeList).enter().append("svg:g").attr("class",
function(a){var b="vvvv-node";a.isIOBox&&(b+=" vvvv-iobox");0<=q.indexOf(a)&&(b+=" selected");return b}).attr("id",function(a){return"vvvv-node-"+a.id}).attr("transform",function(a){return"translate("+a.x+","+a.y+")"});k.append("svg:rect").attr("class","vvvv-node-background").attr("height",function(a){return a.getHeight()}).attr("width",function(a){return a.getWidth()}).attr("fill",function(a){return a.isComment()?"rgba(0,0,0,0)":a.not_implemented?"rgba(255,0,0,1)":"#cdcdcd"});k.append("svg:rect").attr("class",
"vvvv-node-pinbar").attr("height",function(a){return a.isIOBox?2:4}).attr("fill",function(a){return a.isIOBox?"#dddddd":"#9a9a9a"}).attr("width",function(a){return a.getWidth()});k.append("svg:rect").attr("class","vvvv-node-pinbar").attr("y",function(a){return a.isIOBox?a.getHeight()-2:a.getHeight()-4}).attr("height",function(a){return a.isIOBox?2:4}).attr("fill",function(a){return a.isIOBox?"#dddddd":"#9a9a9a"}).attr("width",function(a){return a.getWidth()});k.append("svg:text").text(function(a){return a.invisiblePins["Descriptive Name"]?
a.invisiblePins["Descriptive Name"].getValue(0):null}).attr("class","vvvv-node-descriptive-name").attr("shape-rendering","crispEdges").attr("dy",function(a){return a.getHeight()+12}).attr("font-size",10).attr("font-family","Lucida Sans Unicode");k.each(function(a){if(a.isIOBox&&VVVV.PinTypes[a.IOBoxInputPin().typeName].makeLabel){VVVV.PinTypes[a.IOBoxInputPin().typeName].makeLabel(this,a);for(var b=a.IOBoxRows(),c=a.IOBoxInputPin().getSliceCount(),d=this,e=0;e<b;e++)(function(e){d3.select(d).append("svg:rect").attr("width",
a.getWidth()+2).attr("height",a.getHeight()/b-4).attr("y",12*e+2).attr("fill","rgba(0,0,0,0)").on("contextmenu",function(a){if(void 0!=a.IOBoxInputPin().getValue(0)){$(".resettable",z.window.document).remove();var d=$("<input type='text'/>");$("body",z.window.document).append(d);d.css("position","absolute");d.css("left",$(this).offset().left);d.css("top",$(this).offset().top+2);d.css("width",a.getWidth());d.css("height",a.getHeight()/b-4);VVVV.PinTypes[a.IOBoxInputPin().typeName].openInputBox(z.window,
d,a.IOBoxInputPin(),e%c)}d3.event.stopPropagation();d3.event.preventDefault();return!1})})(e)}else d3.select(this).append("svg:text").text(function(a){return a.label()}).attr("class","vvvv-node-label").attr("shape-rendering","crispEdges").attr("dy",function(a,b){return 12*b+12}).attr("dx",4).attr("font-size",10).attr("font-family","Lucida Sans Unicode")});p=k.selectAll("g.vvvv-input-pin").data(function(a){return a.isSubpatch?_(a.inputPins).sortBy(function(a){return a.slavePin?a.slavePin.node.x:1}).map(function(a,
b){return a}):_(a.inputPins).map(function(a,b){return a})}).enter().append("svg:g").attr("class","vvvv-input-pin").attr("transform",function(a,b){pinOffset=0;1<_(a.node.inputPins).size()&&(pinOffset=(a.node.getWidth()-4)/(_(a.node.inputPins).size()-1));a.y=0;a.x=b*pinOffset;return"translate("+a.x+", 0)"});p.append("svg:rect").attr("width",4).attr("height",4).attr("fill",function(a){return a.node.isComment()?"rgba(0,0,0,0)":"#666666"}).on("mouseover",function(a,b){c.selectAll("#vvvv-node-"+a.node.id+
" g.vvvv-input-pin").filter(function(a,c){return c==b}).each(function(){d3.select(this).append("svg:rect").attr("class","vvvv-input-pin-highlight").attr("width",4).attr("height",4).attr("fill","rgba(0,0,0,1)").attr("y",-4);d3.select(this).append("svg:text").text(function(a){return 1<a.getSliceCount()?a.pinname+"("+a.getSliceCount()+"): "+a.getValue(0):a.pinname+": "+a.getValue(0)}).attr("dy",30).attr("font-size",10).attr("font-family","Lucida Sans Unicode").attr("fill","rgba(0,0,0,1)")})}).on("mouseout",
function(a,b){c.selectAll("#vvvv-node-"+a.node.id+" g.vvvv-input-pin text").remove();c.selectAll("#vvvv-node-"+a.node.id+" g.vvvv-input-pin rect.vvvv-input-pin-highlight").remove()});m=k.selectAll("g.vvvv-output-pin").data(function(a){return _(a.outputPins).map(function(a,b){return a})}).enter().append("svg:g").attr("class","vvvv-output-pin").attr("transform",function(a,b){pinOffset=0;1<_(a.node.outputPins).size()&&(pinOffset=(a.node.getWidth()-4)/(_(a.node.outputPins).size()-1));a.y=a.node.getHeight()-
4;a.x=b*pinOffset;return"translate("+a.x+", "+a.y+")"});m.append("svg:rect").attr("width",4).attr("height",4).attr("fill",function(a){return a.node.isComment()?"rgba(0,0,0,0)":"#666666"}).on("mouseover",function(a,b){c.selectAll("#vvvv-node-"+a.node.id+" g.vvvv-output-pin").filter(function(a,c){return c==b}).each(function(){d3.select(this).append("svg:rect").attr("class","vvvv-output-pin-highlight").attr("width",4).attr("height",4).attr("fill","rgba(0,0,0,1)").attr("y",-4);d3.select(this).append("svg:text").text(function(a){return 1<
a.getSliceCount()?a.pinname+"("+a.getSliceCount()+"): "+a.getValue(0):a.pinname+": "+a.getValue(0)}).attr("dy",30).attr("font-size",10).attr("font-family","Lucida Sans Unicode").attr("fill","rgba(0,0,0,1)")})}).on("mouseout",function(a,b){c.selectAll("#vvvv-node-"+a.node.id+" g.vvvv-output-pin text").remove();c.selectAll("#vvvv-node-"+a.node.id+" g.vvvv-output-pin rect.vvvv-output-pin-highlight").remove()});l=a.selectAll("g.vvvv-link").data(n.linkList).enter().append("svg:g").attr("class","vvvv-link");
l.append("svg:line").attr("stroke","rgba(0, 0, 0, 0)").attr("stroke-width",4).attr("x1",function(a){return a.fromPin.x+a.fromPin.node.x+2+0.5}).attr("y1",function(a){return a.fromPin.y+a.fromPin.node.y+4+0.5}).attr("x2",function(a){return a.toPin.x+a.toPin.node.x+2+0.5}).attr("y2",function(a){return a.toPin.y+a.toPin.node.y+0.5});l.append("svg:line").attr("stroke","#000").attr("stroke-width",1).attr("x1",function(a){return a.fromPin.x+a.fromPin.node.x+2+0.5}).attr("y1",function(a){return a.fromPin.y+
a.fromPin.node.y+4+0.5}).attr("x2",function(a){return a.toPin.x+a.toPin.node.x+2+0.5}).attr("y2",function(a){return a.toPin.y+a.toPin.node.y+0.5});c.selectAll("g.vvvv-input-pin").on("contextmenu",function(a,b){if(VVVV.PinTypes[a.typeName].openInputBox&&void 0!=a.getValue(0)){$(".resettable",z.window.document).remove();var c=$("<input type='text'/>");$("body",z.window.document).append(c);c.css("position","absolute");c.css("left",$(this).offset().left);c.css("top",$(this).offset().top-3);c.css("width",
50);c.css("height",14);VVVV.PinTypes[a.typeName].openInputBox(z,c,a,0)}d3.event.stopPropagation();d3.event.preventDefault();return!1});var r=["Generic","Color","Enum"];c.selectAll("g.vvvv-input-pin, g.vvvv-output-pin").on("click",function(a,d){if(z.state!=UIState.Connecting){s=a;z.state=UIState.Connecting;c.append("svg:line").attr("class","vvvv-link current-link resettable").attr("stroke","#000").attr("stroke-width",1).attr("x1",a.x+a.node.x+2+0.5).attr("y1",a.y+a.node.y+2+0.5).attr("x2",a.x+a.node.x+
2+0.5).attr("y2",a.y+a.node.y+2+0.5);var e=s.direction==PinDirection.Output?"input":"output",g=s.node.getUpstreamNodes();c.selectAll("g.vvvv-"+e+"-pin").filter(function(a){return a.typeName!=s.typeName&&("Node"!=s.typeName||0<=r.indexOf(a.typeName))&&("Node"!=a.typeName||0<=r.indexOf(s.typeName))||0<=g.indexOf(a.node)||a.node==s.node?!1:!0}).append("svg:rect").attr("class","vvvv-connection-highlight").attr("width",4).attr("height",3).attr("fill","rgba(0,0,0,1)").attr("y",function(a){return a.direction==
PinDirection.Input?-3:3})}else{if(s.direction==PinDirection.Input)var e=a,h=s;else e=s,h=a;if(e.typeName==h.typeName||"Node"==e.typeName&&0>r.indexOf(h.typeName)||"Node"==h.typeName&&0>r.indexOf(e.typeName)){var k="<PATCH>";_(h.links).each(function(a){k+="<LINK deleteme='pronto' srcnodeid='"+a.fromPin.node.id+"' srcpinname='"+a.fromPin.pinname+"' dstnodeid='"+a.toPin.node.id+"' dstpinname='"+a.toPin.pinname+"'/>"});k+="<LINK createme='pronto' srcnodeid='"+e.node.id+"' srcpinname='"+e.pinname+"' dstnodeid='"+
h.node.id+"' dstpinname='"+h.pinname+"'/>";k+="</PATCH>";b.update(n.nodename,k);c.select(".vvvv-link.current-link").remove();c.select(".vvvv-connection-highlight").remove();z.state=UIState.Idle}n.afterUpdate()}d3.event.stopPropagation()}).on("mousedown",function(){d3.event.stopPropagation()});c.selectAll("g.vvvv-link").on("contextmenu",function(a){b.update(n.nodename,"<PATCH><LINK deleteme='pronto' srcnodeid='"+a.fromPin.node.id+"' srcpinname='"+a.fromPin.pinname+"' dstnodeid='"+a.toPin.node.id+"' dstpinname='"+
a.toPin.pinname+"'/></PATCH>");d3.event.preventDefault()});k.on("mousedown",function(a){$(".resettable",z.window.document).remove();z.state=UIState.Moving;0>q.indexOf(a)&&(h||g(),d3.select(this).attr("class","vvvv-node selected"),q.push(a));e=d3.event.pageX;d=d3.event.pageY;b.inspector&&b.inspector.setNode(a);d3.event.preventDefault();d3.event.stopPropagation();return!1}).on("contextmenu",function(a){a.isSubpatch?b.openPatch(a):a.openUIWindow&&a.openUIWindow();d3.event.preventDefault();d3.event.stopPropagation();
return!1})}};
VVVV.Editors.BrowserEditor.Inspector=function(a){function b(){d=void 0;$(c.win.document).find("#pins, #values").empty();$(c.win.document).find("#pins").append('<div class="row heading">Configuration</div>');$(c.win.document).find("#values").append('<div class="row heading"></div>');_(e.invisiblePins).each(function(a){h(a)});$(c.win.document).find("#pins").append('<div class="row heading">Input Pins</div>');$(c.win.document).find("#values").append('<div class="row heading"></div>');_(e.inputPins).each(function(a){h(a)});$(c.win.document).find("#pins").append('<div class="row heading">Output Pins</div>');
$(c.win.document).find("#values").append('<div class="row heading"></div>');_(e.outputPins).each(function(a){h(a)})}function h(a){var b=$('<a class="row pin" href="#">'+a.pinname+"</a>");$(c.win.document).find("#pins").append(b);b.click(function(b){$(c.win.document).find("a.pin.active").removeClass("active");$(this).addClass("active");VVVV.PinTypes[a.typeName].openInputBox&&g(a);b.preventDefault();return!1});VVVV.PinTypes[a.typeName].openInputBox&&a.direction!=PinDirection.Output&&!a.isConnected()&&
void 0!=a.getValue(0)?(b=$('<div class="row value"><div style="height:100%">'+a.getValue(0)+"</div></div>"),b.find("div").click(function(){VVVV.PinTypes[a.typeName].openInputBox(c.win,$(this),a,0)})):b=$('<div class="row value readonlyvalue"><div style="height:100%">'+a.getValue(0)+"</div></div>");"Color"==a.typeName&&b.find("div").css("background-color","rgba("+_(a.getValue(0).split(",")).map(function(a){return parseInt(255*a)}).join(",")+")");$(c.win.document).find("#values").append(b)}function g(a){var b=
d!=a;d=a;var e=a.getSliceCount(),g=$('<div class="row heading"><input type="text" value="'+e+'"/ size="3"/> Slices</div>');a.direction!=PinDirection.Input&&g.find("input").attr("disabled",!0);var h=$(c.win.document).find("#values .row").first();0<h.length?h.replaceWith(g):$(c.win.document).find("#values").append(g);g.find("input").change(function(a){for(var b=Math.max(1,parseInt($(this).val())),c=d.getSliceCount();c<b;c++)d.setValue(c,VVVV.PinTypes[d.typeName].defaultValue());d.setSliceCount(b);d.node.parentPatch.afterUpdate();
a.preventDefault();return!1});for(g=g=0;g<e;g++)if(h=$(c.win.document).find("#values .row").eq(g+1),b||!h.children().first().hasClass("pininputbox")){if(VVVV.PinTypes[a.typeName].openInputBox&&a.direction!=PinDirection.Output&&!a.isConnected()&&void 0!=a.getValue(0)){var q=$('<div class="row value"><div style="height:100%">'+a.getValue(g)+"</div></div>");(function(b){q.find("div").click(function(){VVVV.PinTypes[a.typeName].openInputBox(c.win,$(this),a,b)})})(g)}else q=$('<div class="row value readonlyvalue"><div style="height:100%">'+
a.getValue(g)+"</div></div>");0<h.length?h.replaceWith(q):$(c.win.document).find("#values").append(q);"Color"==a.typeName&&q.find("div").css("background-color","rgba("+_(a.getValue(g).split(",")).map(function(a){return parseInt(255*a)}).join(",")+")")}g++;for(h=$(c.win.document).find("#values .row");g<h.length;g++)h.eq(g).remove()}this.win=window.open(a+"/inspektor.html","inspektor","location=no, width=250, height=600, toolbar=no");var e,d;insw=this.win;var c=this;this.update=function(){e&&(d?g(d):
b())};this.setNode=function(a){e=a;b()};this.close=function(){this.win.close()}};
VVVV.Editors.BrowserEditor.Interface=function(){function a(){return"Are you sure you want to leave? Unsaved changes in your patches will be lost."}var b=[],h={};this.inspector=void 0;this.enable=function(e,d){this.addPatch(e);this.openPatch(e);var c=this;$(window).bind("beforeunload",a);$(window).unload(function(){c.disable()});this.openInspector(VVVV.Root);b[0].window?d&&d.success&&d.success():d&&d.error&&d.error()};this.openInspector=function(a,b){if(!this.inspector){this.inspector=new VVVV.Editors.BrowserEditor.Inspector(a);
var c=this;$(this.inspector.win).bind("beforeunload",function(){console.log("closing inspektor");c.inspector=void 0})}};var g=[];this.addPatch=function(a){for(var b=a.id,c=a;void 0!=(c=c.parentPatch);)b+="-"+c.id;if(!(0<=g.indexOf(b)))for(g.push(b),a.editor=this,void 0==h[a.nodename]&&(h[a.nodename]=[]),h[a.nodename].push(a),a=a.getSubPatches(),b=0;b<a.length;b++)this.addPatch(a[b])};this.openPatch=function(a){b.push(new VVVV.Editors.BrowserEditor.PatchWindow(a,this))};this.update=function(a,b){for(var c=
h[a].length,g=0;g<c;g++)console.log("updating patch "+a+" / "+h[a][g].id),h[a][g].doLoad(b),h[a][g].afterUpdate()};this.disable=function(){for(var e=0;e<b.length;e++)b[e].close();this.inspector&&this.inspector.close();$(window).unbind("beforeunload",a)};this.save=function(a,b){var c=$("<a>save</a>");$("body").append(c);c.attr("href","data:application/octet-stream;charset=utf-8,"+encodeURIComponent(b));c.attr("download",a);c[0].click();c.remove()};this.sendUndo=function(){}};VVVV.Editors.edit=new VVVV.Editors.BrowserEditor.Interface;
